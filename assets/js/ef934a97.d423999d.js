"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[41435],{28453(n,e,s){s.d(e,{R:()=>o,x:()=>d});var a=s(96540);const i={},t=a.createContext(i);function o(n){const e=a.useContext(t);return a.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:o(n.components),a.createElement(t.Provider,{value:e},n.children)}},34069(n,e,s){s.r(e),s.d(e,{assets:()=>r,contentTitle:()=>d,default:()=>c,frontMatter:()=>o,metadata:()=>a,toc:()=>l});const a=JSON.parse('{"id":"tutorials/gemini_realtime_with_audio","title":"\u4f7f\u7528\u97f3\u9891\u8f93\u5165/\u8f93\u51fa\u8c03\u7528 Gemini \u5b9e\u65f6 API","description":"\u9700\u8981 LiteLLM \u4ee3\u7406 v1.70.1+","source":"@site/docs/tutorials/gemini_realtime_with_audio.md","sourceDirName":"tutorials","slug":"/tutorials/gemini_realtime_with_audio","permalink":"/docs/tutorials/gemini_realtime_with_audio","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u4f7f\u7528 LiteLLM \u5c06\u65e5\u5fd7\u53d1\u9001\u5230 Elasticsearch","permalink":"/docs/tutorials/elasticsearch_logging"},"next":{"title":"Claude Code","permalink":"/docs/tutorials/claude_responses_api"}}');var i=s(74848),t=s(28453);const o={},d="\u4f7f\u7528\u97f3\u9891\u8f93\u5165/\u8f93\u51fa\u8c03\u7528 Gemini \u5b9e\u65f6 API",r={},l=[];function _(n){const e={admonition:"admonition",code:"code",h1:"h1",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"\u4f7f\u7528\u97f3\u9891\u8f93\u5165\u8f93\u51fa\u8c03\u7528-gemini-\u5b9e\u65f6-api",children:"\u4f7f\u7528\u97f3\u9891\u8f93\u5165/\u8f93\u51fa\u8c03\u7528 Gemini \u5b9e\u65f6 API"})}),"\n",(0,i.jsx)(e.admonition,{type:"info",children:(0,i.jsx)(e.p,{children:"\u9700\u8981 LiteLLM \u4ee3\u7406 v1.70.1+"})}),"\n",(0,i.jsxs)(e.ol,{children:["\n",(0,i.jsx)(e.li,{children:"\u914d\u7f6e LiteLLM \u4ee3\u7406\u7684 config.yaml"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-yaml",children:'model_list:\n  - model_name: "gemini-2.0-flash"\n    litellm_params:\n      model: gemini/gemini-2.0-flash-live-001\n    model_info:\n      mode: realtime\n'})}),"\n",(0,i.jsxs)(e.ol,{start:"2",children:["\n",(0,i.jsx)(e.li,{children:"\u542f\u52a8 LiteLLM \u4ee3\u7406"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-bash",children:"litellm-proxy start\n"})}),"\n",(0,i.jsxs)(e.ol,{start:"3",children:["\n",(0,i.jsx)(e.li,{children:"\u8fd0\u884c\u6d4b\u8bd5\u811a\u672c"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-python",children:'import asyncio\nimport websockets\nimport json\nimport base64\nfrom dotenv import load_dotenv\nimport wave\nimport base64\nimport soundfile as sf\nimport sounddevice as sd\nimport io\nimport numpy as np\n\n# \u52a0\u8f7d\u73af\u5883\u53d8\u91cf\n\nOPENAI_API_KEY = "sk-1234"  # \u66ff\u6362\u4e3a\u60a8\u7684 LiteLLM API \u5bc6\u94a5\nOPENAI_API_URL = \'ws://{PROXY_URL}/v1/realtime?model=gemini-2.0-flash\'  # \u66ff\u6362\u4e3a `wss://{PROXY_URL}/v1/realtime?model=gemini-2.0-flash` \u4ee5\u542f\u7528\u5b89\u5168\u8fde\u63a5\nWAV_FILE_PATH = "/path/to/audio.wav"  # \u66ff\u6362\u4e3a\u60a8\u81ea\u5df1\u7684 .wav \u6587\u4ef6\u8def\u5f84\n\nasync def send_session_update(ws):\n    session_update = {\n        "type": "session.update",\n        "session": {\n            "conversation_id": "123456",\n            "language": "en-US",\n            "transcription_mode": "fast",\n            "modalities": ["text"]\n        }\n    }\n    await ws.send(json.dumps(session_update))\n\nasync def send_audio_file(ws, file_path):\n    with wave.open(file_path, \'rb\') as wav_file:\n        chunk_size = 1024  # \u8c03\u6574\u5927\u5c0f\n        while True:\n            chunk = wav_file.readframes(chunk_size)\n            if not chunk:\n                break\n            base64_audio = base64.b64encode(chunk).decode(\'utf-8\')\n            audio_message = {\n                "type": "input_audio_buffer.append",\n                "audio": base64_audio\n            }\n            await ws.send(json.dumps(audio_message))\n            await asyncio.sleep(0.1)  # \u6dfb\u52a0\u4e00\u4e2a\u5c0f\u5ef6\u8fdf\u4ee5\u6a21\u62df\u5b9e\u65f6\u6d41\u5f0f\u4f20\u8f93\n\n    # \u53d1\u9001\u97f3\u9891\u6d41\u7ed3\u675f\u6d88\u606f\n    await ws.send(json.dumps({"type": "input_audio_buffer.end"}))\n\ndef play_base64_audio(base64_string, sample_rate=24000, channels=1):\n    # \u89e3\u7801 base64 \u5b57\u7b26\u4e32\n    audio_data = base64.b64decode(base64_string)\n\n    # \u8f6c\u6362\u4e3a numpy \u6570\u7ec4\n    audio_np = np.frombuffer(audio_data, dtype=np.int16)\n\n    # \u5982\u679c\u662f\u7acb\u4f53\u58f0\uff0c\u91cd\u5851\u6570\u7ec4\n    if channels == 2:\n        audio_np = audio_np.reshape(-1, 2)\n\n    # \u5f52\u4e00\u5316\n    audio_float = audio_np.astype(np.float32) / 32768.0\n\n    # \u64ad\u653e\u97f3\u9891\n    sd.play(audio_float, sample_rate)\n    sd.wait()\n\n\ndef combine_base64_audio(base64_strings):\n    # \u7b2c\u4e00\u6b65\uff1a\u5c06 base64 \u5b57\u7b26\u4e32\u89e3\u7801\u4e3a\u4e8c\u8fdb\u5236\u6570\u636e\n    binary_data = [base64.b64decode(s) for s in base64_strings]\n    \n    # \u7b2c\u4e8c\u6b65\uff1a\u62fc\u63a5\u4e8c\u8fdb\u5236\u6570\u636e\n    combined_binary = b\'\'.join(binary_data)\n    \n    # \u7b2c\u4e09\u6b65\uff1a\u5c06\u7ec4\u5408\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u91cd\u65b0\u7f16\u7801\u4e3a base64\n    combined_base64 = base64.b64encode(combined_binary).decode(\'utf-8\')\n    \n    return combined_base64\n\nasync def listen_in_background(ws):\n    combined_b64_audio_str = []\n    try: \n        while True:\n            response = await ws.recv()\n            message_json = json.loads(response)\n            print(f"message_json: {message_json}")\n\n            if message_json[\'type\'] == \'response.audio.delta\' and message_json.get(\'delta\'):\n                play_base64_audio(message_json["delta"])\n    except Exception: \n        print("END OF STREAM")\n\nasync def main():\n    async with websockets.connect(\n        OPENAI_API_URL,\n        additional_headers={\n            "Authorization": f"Bearer {OPENAI_API_KEY}",\n            "OpenAI-Beta": "realtime=v1"\n        }\n    ) as ws:\n        asyncio.create_task(listen_in_background(ws=ws))\n        await send_session_update(ws)\n        await send_audio_file(ws, WAV_FILE_PATH)\n\n        \n\nif __name__ == "__main__":\n    asyncio.run(main())\n'})})]})}function c(n={}){const{wrapper:e}={...(0,t.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(_,{...n})}):_(n)}}}]);