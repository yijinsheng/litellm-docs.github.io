"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[27891],{24444(e,n,r){r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"proxy/dynamic_rate_limit","title":"\u52a8\u6001TPM/RPM\u5206\u914d","description":"\u9632\u6b62\u9879\u76ee\u6d88\u8017\u8fc7\u591a\u7684tpm/rpm\u3002","source":"@site/docs/proxy/dynamic_rate_limit.md","sourceDirName":"proxy","slug":"/proxy/dynamic_rate_limit","permalink":"/docs/proxy/dynamic_rate_limit","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u5ba2\u6237\u4f7f\u7528\u60c5\u51b5","permalink":"/docs/proxy/customer_usage"},"next":{"title":"\u2728 \u9884\u7b97 / \u901f\u7387\u9650\u5236\u5c42\u7ea7","permalink":"/docs/proxy/rate_limit_tiers"}}');var i=r(74848),l=r(28453);const t={},o="\u52a8\u6001TPM/RPM\u5206\u914d",a={},c=[{value:"\u5feb\u901f\u4f7f\u7528\u6307\u5357",id:"\u5feb\u901f\u4f7f\u7528\u6307\u5357",level:2},{value:"[\u6d4b\u8bd5\u7248] \u8bbe\u7f6e\u4f18\u5148\u7ea7/\u9884\u7559\u914d\u989d",id:"\u6d4b\u8bd5\u7248-\u8bbe\u7f6e\u4f18\u5148\u7ea7\u9884\u7559\u914d\u989d",level:2},{value:"\u4f18\u5148\u7ea7\u9884\u7559\u7684\u5de5\u4f5c\u539f\u7406",id:"\u4f18\u5148\u7ea7\u9884\u7559\u7684\u5de5\u4f5c\u539f\u7406",level:3},{value:"\u914d\u7f6e",id:"\u914d\u7f6e",level:3},{value:"1. \u914d\u7f6e<code>config.yaml</code>",id:"1-\u914d\u7f6econfigyaml",level:4},{value:"\u5728\u56e2\u961f\u6216\u5bc6\u94a5\u7ea7\u522b\u8bbe\u7f6e\u4f18\u5148\u7ea7",id:"\u5728\u56e2\u961f\u6216\u5bc6\u94a5\u7ea7\u522b\u8bbe\u7f6e\u4f18\u5148\u7ea7",level:3},{value:"3. \u6d4b\u8bd5\u4f18\u5148\u7ea7\u5206\u914d",id:"3-\u6d4b\u8bd5\u4f18\u5148\u7ea7\u5206\u914d",level:4},{value:"\u9884\u671f\u884c\u4e3a",id:"\u9884\u671f\u884c\u4e3a",level:3},{value:"\u6f14\u793a\u89c6\u9891",id:"\u6f14\u793a\u89c6\u9891",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"\u52a8\u6001tpmrpm\u5206\u914d",children:"\u52a8\u6001TPM/RPM\u5206\u914d"})}),"\n",(0,i.jsx)(n.p,{children:"\u9632\u6b62\u9879\u76ee\u6d88\u8017\u8fc7\u591a\u7684tpm/rpm\u3002"}),"\n",(0,i.jsxs)(n.p,{children:["\u57fa\u4e8e\u8be5\u5206\u949f\u5185\u6d3b\u8dc3\u7684API\u5bc6\u94a5\uff0c\u52a8\u6001\u5206\u914dTPM/RPM\u914d\u989d\u3002",(0,i.jsx)(n.a,{href:"https://github.com/BerriAI/litellm/blob/9bffa9a48e610cc6886fc2dce5c1815aeae2ad46/litellm/proxy/hooks/dynamic_rate_limiter.py#L125",children:(0,i.jsx)(n.strong,{children:"\u67e5\u770b\u4ee3\u7801"})})]}),"\n",(0,i.jsx)(n.h2,{id:"\u5feb\u901f\u4f7f\u7528\u6307\u5357",children:"\u5feb\u901f\u4f7f\u7528\u6307\u5357"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u914d\u7f6e",(0,i.jsx)(n.code,{children:"config.yaml"})]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'showLineNumbers title="config.yaml"',children:'model_list: \n  - model_name: my-fake-model\n    litellm_params:\n      model: gpt-3.5-turbo\n      api_key: my-fake-key\n      mock_response: hello-world\n      tpm: 60\n\nlitellm_settings: \n  callbacks: ["dynamic_rate_limiter_v3"]\n\ngeneral_settings:\n  master_key: sk-1234 # \u6216\u8005\u5728.env\u6587\u4ef6\u4e2d\u8bbe\u7f6e`LITELLM_MASTER_KEY=".."`\n  database_url: postgres://.. # \u6216\u8005\u5728.env\u6587\u4ef6\u4e2d\u8bbe\u7f6e`DATABASE_URL=".."`\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"\u542f\u52a8\u4ee3\u7406"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"litellm --config /path/to/config.yaml\n"})}),"\n",(0,i.jsxs)(n.ol,{start:"3",children:["\n",(0,i.jsx)(n.li,{children:"\u6d4b\u8bd5\u5b83\uff01"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'showLineNumbers title="test.py"',children:'"""\n- \u5e76\u53d1\u8fd0\u884c\u4e24\u4e2a\u56e2\u961f\u540c\u65f6\u8c03\u7528\u540c\u4e00\u6a21\u578b\n- \u6a21\u578b\u670960\u4e2aTPM\n- \u6a21\u62df\u54cd\u5e94\u8fd4\u56de\u6bcf\u8bf7\u6c4230\u4e2a\u603b\u4ee4\u724c\n- \u6bcf\u4e2a\u56e2\u961f\u53ea\u80fd\u6bcf\u5206\u949f\u53d1\u9001\u4e00\u6b21\u8bf7\u6c42\n"""\n\nimport requests\nfrom openai import OpenAI, RateLimitError\n\ndef create_key(api_key: str, base_url: str): \n    response = requests.post(\n        url="{}/key/generate".format(base_url), \n        json={},\n        headers={\n            "Authorization": "Bearer {}".format(api_key)\n        }\n    )\n\n    _response = response.json()\n\n    return _response["key"]\n\nkey_1 = create_key(api_key="sk-1234", base_url="http://0.0.0.0:4000")\nkey_2 = create_key(api_key="sk-1234", base_url="http://0.0.0.0:4000")\n\n# \u4f7f\u7528\u5bc6\u94a51\u8c03\u7528\u4ee3\u7406 - \u6210\u529f\nopenai_client_1 = OpenAI(api_key=key_1, base_url="http://0.0.0.0:4000")\n\nresponse = openai_client_1.chat.completions.with_raw_response.create(\n    model="my-fake-model", messages=[{"role": "user", "content": "Hello world!"}],\n)\n\nprint("Call 1\u7684Headers - {}".format(response.headers))\n_response = response.parse()\nprint("Call 1\u7684\u603b\u4ee4\u724c\u6570 - {}".format(_response.usage.total_tokens))\n\n\n# \u4f7f\u7528\u5bc6\u94a52\u8c03\u7528\u4ee3\u7406 - \u6210\u529f\nopenai_client_2 = OpenAI(api_key=key_2, base_url="http://0.0.0.0:4000")\n\nresponse = openai_client_2.chat.completions.with_raw_response.create(\n    model="my-fake-model", messages=[{"role": "user", "content": "Hello world!"}],\n)\n\nprint("Call 2\u7684Headers - {}".format(response.headers))\n_response = response.parse()\nprint("Call 2\u7684\u603b\u4ee4\u724c\u6570 - {}".format(_response.usage.total_tokens))\n\n# \u4f7f\u7528\u5bc6\u94a52\u8c03\u7528\u4ee3\u7406 - \u5931\u8d25\ntry:  \n    openai_client_2.chat.completions.with_raw_response.create(model="my-fake-model", messages=[{"role": "user", "content": "Hey, how\'s it going?"}])\n    raise Exception("\u8fd9\u5e94\u8be5\u4f1a\u5931\u8d25\uff01")\nexcept RateLimitError as e: \n    print("\u56e0 - {} \u800c\u88ab\u9650\u6d41".format(str(e)))\n\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u9884\u671f\u54cd\u5e94"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u56e0 - 429\u9519\u8bef\u7801 - {'error': {'message': {'error': 'Key=<hashed_token> over available TPM=0. Model TPM=0, Active keys=2'}, 'type': 'None', 'param': 'None', 'code': 429}}\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6d4b\u8bd5\u7248-\u8bbe\u7f6e\u4f18\u5148\u7ea7\u9884\u7559\u914d\u989d",children:"[\u6d4b\u8bd5\u7248] \u8bbe\u7f6e\u4f18\u5148\u7ea7/\u9884\u7559\u914d\u989d"}),"\n",(0,i.jsx)(n.p,{children:"\u4e3a\u4e0d\u540c\u7684\u73af\u5883\u6216\u4f7f\u7528\u573a\u666f\u9884\u7559TPM/RPM\u5bb9\u91cf\u3002\u8fd9\u786e\u4fdd\u4e86\u5173\u952e\u7684\u751f\u4ea7\u5de5\u4f5c\u8d1f\u8f7d\u59cb\u7ec8\u5177\u6709\u4fdd\u8bc1\u7684\u5bb9\u91cf\uff0c\u800c\u5f00\u53d1\u6216\u5176\u4ed6\u4f4e\u4f18\u5148\u7ea7\u4efb\u52a1\u5219\u4f7f\u7528\u5269\u4f59\u7684\u914d\u989d\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4f7f\u7528\u6848\u4f8b\uff1a"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u751f\u4ea7\u73af\u5883 vs \u5f00\u53d1\u73af\u5883"}),"\n",(0,i.jsx)(n.li,{children:"\u5b9e\u65f6\u5e94\u7528 vs \u6279\u91cf\u5904\u7406"}),"\n",(0,i.jsx)(n.li,{children:"\u5173\u952e\u670d\u52a1 vs \u5b9e\u9a8c\u6027\u529f\u80fd"}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["\u57fa\u4e8e\u4f18\u5148\u7ea7\u9884\u7559TPM/RPM\u662f\u4e00\u4e2a\u9ad8\u7ea7\u7279\u6027\u3002\u8bf7",(0,i.jsx)(n.a,{href:"/docs/proxy/enterprise",children:"\u83b7\u53d6\u4f01\u4e1a\u8bb8\u53ef\u8bc1"}),"\u4ee5\u4f7f\u7528\u6b64\u529f\u80fd\u3002"]})}),"\n",(0,i.jsx)(n.h3,{id:"\u4f18\u5148\u7ea7\u9884\u7559\u7684\u5de5\u4f5c\u539f\u7406",children:"\u4f18\u5148\u7ea7\u9884\u7559\u7684\u5de5\u4f5c\u539f\u7406"}),"\n",(0,i.jsx)(n.p,{children:"\u4f18\u5148\u7ea7\u9884\u7559\u5c06\u6a21\u578b\u7684\u603bTPM/RPM\u5206\u914d\u7ed9\u7279\u5b9a\u7684\u4f18\u5148\u7ea7\u7ea7\u522b\u3002\u5177\u6709\u66f4\u9ad8\u4f18\u5148\u7ea7\u7684\u5bc6\u94a5\u4f1a\u9996\u5148\u83b7\u5f97\u5176\u9884\u7559\u914d\u989d\u7684\u4fdd\u8bc1\u8bbf\u95ee\u6743\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u793a\u4f8b\u573a\u666f\uff1a"})}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6a21\u578b\u603b\u5bb9\u91cf\u4e3a10\u4e2aRPM"}),"\n",(0,i.jsxs)(n.li,{children:["\u4f18\u5148\u7ea7\u9884\u7559: ",(0,i.jsx)(n.code,{children:'{"prod": 0.9, "dev": 0.1}'})]}),"\n",(0,i.jsx)(n.li,{children:"\u7ed3\u679c\uff1a\u751f\u4ea7\u5bc6\u94a5\u83b7\u5f979\u4e2aRPM\u7684\u4fdd\u8bc1\uff0c\u5f00\u53d1\u5bc6\u94a5\u83b7\u5f971\u4e2aRPM\u7684\u4fdd\u8bc1"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u914d\u7f6e",children:"\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.h4,{id:"1-\u914d\u7f6econfigyaml",children:["1. \u914d\u7f6e",(0,i.jsx)(n.code,{children:"config.yaml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",metastring:'showLineNumbers title="config.yaml"',children:'model_list:\n  - model_name: gpt-3.5-turbo             \n    litellm_params:\n      model: "gpt-3.5-turbo"       \n      api_key: os.environ/OPENAI_API_KEY \n      rpm: 10   # \u6a21\u578b\u603b\u5bb9\u91cf\n\nlitellm_settings:\n  callbacks: ["dynamic_rate_limiter_v3"]\n  priority_reservation:\n    "prod": 0.9 # \u4e3a\u751f\u4ea7\u9884\u755990%\u7684\u914d\u989d (9 RPM)\n    "dev": 0.1 # \u4e3a\u5f00\u53d1\u9884\u755910%\u7684\u914d\u989d (1 RPM)\n    # \u53e6\u4e00\u79cd\u683c\u5f0f\uff1a\n    # "prod":\n    #   type: "rpm"    # \u57fa\u4e8e\u6bcf\u5206\u949f\u8bf7\u6c42\u6570\u91cf\u9884\u7559\n    #   value: 9       # 9 RPM = 90% \u7684\u603b\u5bb9\u91cf\n    # "dev":\n    #   type: "tpm"    # \u57fa\u4e8e\u6bcf\u5206\u949f\u4ee4\u724c\u6570\u9884\u7559\n    #   value: 100     # 100 TPM\n  priority_reservation_settings:\n    default_priority: 0  # \u6ca1\u6709\u663e\u5f0f\u4f18\u5148\u7ea7\u5143\u6570\u636e\u7684\u5bc6\u94a5\u5206\u914d\u6743\u91cd (0%)\n    saturation_threshold: 0.50 # \u5f53\u6a21\u578b\u8fbe\u5230\u5176RPM\u9650\u5236\u768450%\u65f6\u89c6\u4e3a\u9971\u548c\n    saturation_check_cache_ttl: 60 # \u672c\u5730\u7f13\u5b58\u9971\u548c\u503c\u7684\u65f6\u95f4\uff08\u79d2\uff09\n\ngeneral_settings:\n  master_key: sk-1234 # \u6216\u8005\u5728.env\u6587\u4ef6\u4e2d\u8bbe\u7f6e`LITELLM_MASTER_KEY=".."`\n  database_url: postgres://.. # \u6216\u8005\u5728.env\u6587\u4ef6\u4e2d\u8bbe\u7f6e`DATABASE_URL=".."`\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u914d\u7f6e\u8be6\u60c5\uff1a"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"priority_reservation"}),": Dict[str, Union[float, PriorityReservationDict]]"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u952e (str)"}),': \u4f18\u5148\u7ea7\u7ea7\u522b\u540d\u79f0\uff08\u53ef\u4ee5\u662f\u4efb\u4f55\u5b57\u7b26\u4e32\uff0c\u5982"prod", "dev", "critical"\u7b49\uff09']}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u503c"}),": \u6d6e\u70b9\u6570(0.0-1.0) \u6216\u8005\u5305\u542b ",(0,i.jsx)(n.code,{children:"type"})," \u548c ",(0,i.jsx)(n.code,{children:"value"})," \u7684\u5b57\u5178","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6d6e\u70b9\u6570: ",(0,i.jsx)(n.code,{children:"0.9"})," = 90%\u7684\u5bb9\u91cf"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5b57\u5178\u578b: ",(0,i.jsx)(n.code,{children:'{"type": "rpm", "value": 9}'})," = \u6bcf\u5206\u949f9\u4e2a\u8bf7\u6c42"]}),"\n",(0,i.jsxs)(n.li,{children:["\u652f\u6301\u7c7b\u578b: ",(0,i.jsx)(n.code,{children:'"percent"'}),", ",(0,i.jsx)(n.code,{children:'"rpm"'}),", ",(0,i.jsx)(n.code,{children:'"tpm"'})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"priority_reservation_settings"}),": \u5bf9\u8c61 (\u53ef\u9009)"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"default_priority (float)"}),": \u5206\u914d\u7ed9\u6ca1\u6709\u8bbe\u7f6e\u4f18\u5148\u7ea7\u5143\u6570\u636e\u7684\u5bc6\u94a5\u7684\u6743\u91cd/\u767e\u5206\u6bd4\uff080.0\u52301.0\uff0c\u9ed8\u8ba4\u4e3a0.5\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"saturation_threshold (float)"}),": \u5f00\u59cb\u4e25\u683c\u4f18\u5148\u7ea7\u63a7\u5236\u7684\u9971\u548c\u5ea6\u6c34\u5e73\uff080.0\u52301.0\uff09\u3002\u9971\u548c\u5ea6\u8ba1\u7b97\u4e3a ",(0,i.jsx)(n.code,{children:"max(current_rpm/max_rpm, current_tpm/max_tpm)"}),"\u3002\u4f4e\u4e8e\u6b64\u9608\u503c\u65f6\uff0c\u6177\u6168\u6a21\u5f0f\u5141\u8bb8\u4ece\u672a\u4f7f\u7528\u5bb9\u91cf\u4e2d\u501f\u7528\u4f18\u5148\u7ea7\u3002\u9ad8\u4e8e\u6b64\u9608\u503c\u65f6\uff0c\u4e25\u683c\u6a21\u5f0f\u5f3a\u5236\u6267\u884c\u6807\u51c6\u5316\u4f18\u5148\u7ea7\u9650\u5236\u3002","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u793a\u4f8b: \u5f53\u6a21\u578b\u4f7f\u7528\u7387\u8f83\u4f4e\u65f6\uff0c\u5bc6\u94a5\u53ef\u4ee5\u4f7f\u7528\u8d85\u8fc7\u5176\u5206\u914d\u4efd\u989d\u7684\u914d\u989d\u3002\u5f53\u6a21\u578b\u4f7f\u7528\u7387\u8f83\u9ad8\u65f6\uff0c\u5bc6\u94a5\u5c06\u88ab\u4e25\u683c\u9650\u5236\u5728\u5176\u5206\u914d\u4efd\u989d\u5185\u3002"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"saturation_check_cache_ttl (int)"}),": \u5728\u672c\u5730\u7f13\u5b58\u4e2d\u8bfb\u53d6Redis\u4e2d\u7684\u9971\u548c\u503c\u7684\u65f6\u95f4\uff08\u79d2\uff0c\u9ed8\u8ba4\u4e3a60\uff09\u3002\u5728\u591a\u8282\u70b9\u90e8\u7f72\u4e2d\uff0c\u8fd9\u63a7\u5236\u4e86\u8282\u70b9\u4f55\u65f6\u6536\u655b\u5230\u76f8\u540c\u7684\u9971\u548c\u72b6\u6001\u3002\u8f83\u4f4e\u7684\u503c\u610f\u5473\u7740\u66f4\u5feb\u7684\u6536\u655b\u4f46\u66f4\u591a\u7684Redis\u8bfb\u53d6\u3002","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u793a\u4f8b: \u8bbe\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"5"}),"\u4ee5\u5b9e\u73b0\u66f4\u5feb\u7684\u591a\u8282\u70b9\u4e00\u81f4\u6027\uff0c\u6216\u8005\u8bbe\u7f6e\u4e3a",(0,i.jsx)(n.code,{children:"0"}),"\u59cb\u7ec8\u76f4\u63a5\u4eceRedis\u8bfb\u53d6\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u542f\u52a8\u4ee3\u7406"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"litellm --config /path/to/config.yaml\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u5728\u56e2\u961f\u6216\u5bc6\u94a5\u7ea7\u522b\u8bbe\u7f6e\u4f18\u5148\u7ea7",children:"\u5728\u56e2\u961f\u6216\u5bc6\u94a5\u7ea7\u522b\u8bbe\u7f6e\u4f18\u5148\u7ea7"}),"\n",(0,i.jsxs)(n.p,{children:["\u4f18\u5148\u7ea7\u53ef\u4ee5\u5728 ",(0,i.jsx)(n.strong,{children:"\u56e2\u961f\u7ea7\u522b"})," \u6216 ",(0,i.jsx)(n.strong,{children:"\u5bc6\u94a5\u7ea7\u522b"})," \u8bbe\u7f6e\u3002\u56e2\u961f\u7ea7\u522b\u7684\u4f18\u5148\u7ea7\u4f18\u5148\u4e8e\u5bc6\u94a5\u7ea7\u522b\u7684\u4f18\u5148\u7ea7\u3002"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u9009\u9879A: \u5728\u56e2\u961f\u7ea7\u522b\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff08\u63a8\u8350\uff09"})}),"\n",(0,i.jsx)(n.p,{children:"\u6240\u6709\u5c5e\u4e8e\u8be5\u56e2\u961f\u7684\u5bc6\u94a5\u5c06\u7ee7\u627f\u56e2\u961f\u7684\u4f18\u5148\u7ea7\u3002\u5f53\u60a8\u5e0c\u671b\u7279\u5b9a\u73af\u5883\u6216\u9879\u76ee\u7684\u6240\u6709\u5bc6\u94a5\u5177\u6709\u76f8\u540c\u7684\u4f18\u5148\u7ea7\u65f6\uff0c\u8fd9\u975e\u5e38\u6709\u7528\u3002"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST \'http://0.0.0.0:4000/team/new\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-H \'Content-Type: application/json\' \\\n-d \'{\n  "team_alias": "production-team",\n  "metadata": {"priority": "prod"}\n}\'\n'})}),"\n",(0,i.jsx)(n.p,{children:"\u4e3a\u8be5\u56e2\u961f\u521b\u5efa\u5bc6\u94a5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -X POST 'http://0.0.0.0:4000/key/generate' \\\n-H 'Authorization: Bearer sk-1234' \\\n-H 'Content-Type: application/json' \\\n-d '{\n  \"team_id\": \"team-id-from-previous-response\"\n}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u9009\u9879B: \u5728\u5355\u4e2a\u5bc6\u94a5\u7ea7\u522b\u8bbe\u7f6e\u4f18\u5148\u7ea7"})}),"\n",(0,i.jsx)(n.p,{children:"\u76f4\u63a5\u5728\u5bc6\u94a5\u4e0a\u8bbe\u7f6e\u4f18\u5148\u7ea7\u3002\u5f53\u60a8\u9700\u8981\u5bf9\u6bcf\u4e2a\u5bc6\u94a5\u8fdb\u884c\u7cbe\u7ec6\u63a7\u5236\u65f6\uff0c\u8fd9\u975e\u5e38\u6709\u7528\u3002"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u751f\u4ea7\u5bc6\u94a5\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -X POST 'http://0.0.0.0:4000/key/generate' \\\n-H 'Authorization: Bearer sk-1234' \\\n-H 'Content-Type: application/json' \\\n-d '{\n  \"metadata\": {\"priority\": \"prod\"}\n}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u5f00\u53d1\u5bc6\u94a5\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -X POST 'http://0.0.0.0:4000/key/generate' \\\n-H 'Authorization: Bearer sk-1234' \\\n-H 'Content-Type: application/json' \\\n-d '{\n  \"metadata\": {\"priority\": \"dev\"}\n}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u6ca1\u6709\u4f18\u5148\u7ea7\u7684\u5bc6\u94a5\uff08\u4f7f\u7528\u9ed8\u8ba4\u4f18\u5148\u7ea7\u6743\u91cd\uff09\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"curl -X POST 'http://0.0.0.0:4000/key/generate' \\\n-H 'Authorization: Bearer sk-1234' \\\n-H 'Content-Type: application/json' \\\n-d '{}'\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u9884\u671f\u54cd\u5e94\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "key": "sk-...",\n  "metadata": {"priority": "prod"}, // \u6216\u8005"dev"\n  ...\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u4f18\u5148\u7ea7\u89e3\u6790\u987a\u5e8f\uff1a"})}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5982\u679c\u5bc6\u94a5\u5c5e\u4e8e\u5177\u6709",(0,i.jsx)(n.code,{children:"metadata.priority"}),"\u8bbe\u7f6e\u7684\u56e2\u961f \u2192 \u4f7f\u7528\u56e2\u961f\u4f18\u5148\u7ea7"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5426\u5219\u5982\u679c\u5bc6\u94a5\u5177\u6709",(0,i.jsx)(n.code,{children:"metadata.priority"}),"\u8bbe\u7f6e \u2192 \u4f7f\u7528\u5bc6\u94a5\u4f18\u5148\u7ea7"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5426\u5219 \u2192 \u4f7f\u7528\u914d\u7f6e\u4e2d\u7684",(0,i.jsx)(n.code,{children:"default_priority"})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"3-\u6d4b\u8bd5\u4f18\u5148\u7ea7\u5206\u914d",children:"3. \u6d4b\u8bd5\u4f18\u5148\u7ea7\u5206\u914d"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u6d4b\u8bd5\u751f\u4ea7\u5bc6\u94a5\uff08\u5e94\u83b7\u5f979\u4e2aRPM\uff09\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST \'http://0.0.0.0:4000/chat/completions\' \\\n  -H \'Content-Type: application/json\' \\\n  -H \'Authorization: Bearer sk-prod-key\' \\\n  -d \'{\n    "model": "gpt-3.5-turbo",\n    "messages": [{"role": "user", "content": "Hello from prod"}]\n  }\'\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u6d4b\u8bd5\u5f00\u53d1\u5bc6\u94a5\uff08\u5e94\u83b7\u5f971\u4e2aRPM\uff09\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -X POST \'http://0.0.0.0:4000/chat/completions\' \\\n  -H \'Content-Type: application/json\' \\\n  -H \'Authorization: Bearer sk-dev-key\' \\\n  -d \'{\n    "model": "gpt-3.5-turbo", \n    "messages": [{"role": "user", "content": "Hello from dev"}]\n  }\'\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u9884\u671f\u884c\u4e3a",children:"\u9884\u671f\u884c\u4e3a"}),"\n",(0,i.jsx)(n.p,{children:"\u4ee5\u4e0a\u914d\u7f6e\uff1a"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u751f\u4ea7\u5bc6\u94a5"}),"\u53ef\u4ee5\u6bcf\u5206\u949f\u6700\u591a\u53d1\u90019\u4e2a\u8bf7\u6c42\uff08\u536010 RPM\u768490%\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5f00\u53d1\u5bc6\u94a5"}),"\u53ef\u4ee5\u6bcf\u5206\u949f\u6700\u591a\u53d1\u90011\u4e2a\u8bf7\u6c42\uff08\u536010 RPM\u768410%\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u6ca1\u6709\u660e\u786e\u4f18\u5148\u7ea7\u8bbe\u7f6e\u7684\u5bc6\u94a5"}),"\u4f7f\u7528\u9ed8\u8ba4\u4f18\u5148\u7ea7\u6743\u91cd\uff080 = 0%\uff09\uff0c\u5206\u914d0\u4e2a\u8bf7\u6c42/\u5206\u949f\uff08\u536010 RPM\u76840%\uff09"]}),"\n",(0,i.jsxs)(n.li,{children:["\u547d\u540d\u7684\u4f18\u5148\u7ea7\u5728",(0,i.jsx)(n.code,{children:"priority_reservation"}),"\u548c\u5177\u6709",(0,i.jsx)(n.code,{children:"default_priority"}),"\u7684\u5bc6\u94a5\u72ec\u7acb\u64cd\u4f5c"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u901f\u7387\u9650\u5236\u9519\u8bef\u793a\u4f8b\uff1a"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "error": {\n    "message": "Key=sk-dev-... over available RPM=0. Model RPM=10, Reserved RPM for priority \'dev\'=1, Active keys=1",\n    "type": "rate_limit_exceeded",\n    "code": 429\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u6f14\u793a\u89c6\u9891",children:"\u6f14\u793a\u89c6\u9891"}),"\n",(0,i.jsx)(n.p,{children:"\u6b64\u89c6\u9891\u5c06\u4ecb\u7ecd\u5982\u4f55\u8bbe\u7f6e\u52a8\u6001\u901f\u7387\u9650\u5236\u4ee5\u53ca\u4f18\u5148\u7ea7\u9884\u7559\uff0c\u5e76\u901a\u8fc7Locust\u6d4b\u8bd5\u9a8c\u8bc1\u884c\u4e3a\u3002"}),"\n",(0,i.jsx)("iframe",{width:"840",height:"500",src:"https://www.loom.com/embed/1b54b93139ee415d959402cc0629f3f7\n",frameborder:"0",webkitallowfullscreen:!0,mozallowfullscreen:!0,allowfullscreen:!0})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},28453(e,n,r){r.d(n,{R:()=>t,x:()=>o});var s=r(96540);const i={},l=s.createContext(i);function t(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);