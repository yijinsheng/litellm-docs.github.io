"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[33332],{28453(e,n,t){t.d(n,{R:()=>a,x:()=>s});var i=t(96540);const l={},r=i.createContext(l);function a(e){const n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),i.createElement(r.Provider,{value:n},e.children)}},41441(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>h,frontMatter:()=>a,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"tutorials/gradio_integration","title":"Gradio \u804a\u5929\u673a\u5668\u4eba + LiteLLM \u6559\u7a0b","description":"\u4e00\u4e2a\u7b80\u5355\u7684\u6559\u7a0b\uff0c\u4ecb\u7ecd\u5982\u4f55\u5c06 LiteLLM \u8865\u5168\u8c03\u7528\u4e0e\u6d41\u5f0f Gradio \u804a\u5929\u673a\u5668\u4eba\u6f14\u793a\u8fdb\u884c\u96c6\u6210\u3002","source":"@site/docs/tutorials/gradio_integration.md","sourceDirName":"tutorials","slug":"/tutorials/gradio_integration","permalink":"/docs/tutorials/gradio_integration","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u6559\u7ec3","permalink":"/docs/tutorials/instructor"},"next":{"title":"CodeLlama - \u4ee3\u7801\u586b\u5145","permalink":"/docs/tutorials/huggingface_codellama"}}');var l=t(74848),r=t(28453);const a={},s="Gradio \u804a\u5929\u673a\u5668\u4eba + LiteLLM \u6559\u7a0b",o={},c=[{value:"\u5b89\u88c5\u53ca\u5bfc\u5165\u4f9d\u8d56\u9879",id:"\u5b89\u88c5\u53ca\u5bfc\u5165\u4f9d\u8d56\u9879",level:3},{value:"\u5b9a\u4e49\u63a8\u7406\u51fd\u6570",id:"\u5b9a\u4e49\u63a8\u7406\u51fd\u6570",level:3},{value:"\u5b9a\u4e49\u804a\u5929\u754c\u9762",id:"\u5b9a\u4e49\u804a\u5929\u754c\u9762",level:3},{value:"\u542f\u52a8 Gradio \u5e94\u7528",id:"\u542f\u52a8-gradio-\u5e94\u7528",level:3},{value:"\u63a8\u8350\u6269\u5c55\uff1a",id:"\u63a8\u8350\u6269\u5c55",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,r.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"gradio-\u804a\u5929\u673a\u5668\u4eba--litellm-\u6559\u7a0b",children:"Gradio \u804a\u5929\u673a\u5668\u4eba + LiteLLM \u6559\u7a0b"})}),"\n",(0,l.jsx)(n.p,{children:"\u4e00\u4e2a\u7b80\u5355\u7684\u6559\u7a0b\uff0c\u4ecb\u7ecd\u5982\u4f55\u5c06 LiteLLM \u8865\u5168\u8c03\u7528\u4e0e\u6d41\u5f0f Gradio \u804a\u5929\u673a\u5668\u4eba\u6f14\u793a\u8fdb\u884c\u96c6\u6210\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"\u5b89\u88c5\u53ca\u5bfc\u5165\u4f9d\u8d56\u9879",children:"\u5b89\u88c5\u53ca\u5bfc\u5165\u4f9d\u8d56\u9879"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:"!pip install gradio litellm\nimport gradio as gr\nimport litellm\n"})}),"\n",(0,l.jsx)(n.h3,{id:"\u5b9a\u4e49\u63a8\u7406\u51fd\u6570",children:"\u5b9a\u4e49\u63a8\u7406\u51fd\u6570"}),"\n",(0,l.jsxs)(n.p,{children:["\u8bf7\u786e\u4fdd\u5c06 ",(0,l.jsx)(n.code,{children:"model"})," \u548c ",(0,l.jsx)(n.code,{children:"api_base"})," \u8bbe\u7f6e\u4e3a\u6258\u7ba1\u60a8LLM\u7684\u670d\u52a1\u5668\u6240\u671f\u671b\u7684\u5f62\u5f0f\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'def inference(message, history):\n    try:\n        flattened_history = [item for sublist in history for item in sublist]\n        full_message = " ".join(flattened_history + [message])\n        messages_litellm = [{"role": "user", "content": full_message}]  # litellm \u6d88\u606f\u683c\u5f0f\n        partial_message = ""\n        for chunk in litellm.completion(model="huggingface/meta-llama/Llama-2-7b-chat-hf",\n                                        api_base="x.x.x.x:xxxx",\n                                        messages=messages_litellm,\n                                        max_new_tokens=512,\n                                        temperature=.7,\n                                        top_k=100,\n                                        top_p=.9,\n                                        repetition_penalty=1.18,\n                                        stream=True):\n            partial_message += chunk[\'choices\'][0][\'delta\'][\'content\']  # \u4ece\u6d41\u5f0f litellm \u5757\u4e2d\u63d0\u53d6\u6587\u672c\n            yield partial_message\n    except Exception as e:\n        print("\u9047\u5230\u5f02\u5e38:", str(e))\n        yield f"\u53d1\u751f\u9519\u8bef\uff0c\u8bf7\u70b9\u51fb \'Clear\' \u9519\u8bef\u5e76\u91cd\u65b0\u5c1d\u8bd5\u60a8\u7684\u95ee\u9898"\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u5b9a\u4e49\u804a\u5929\u754c\u9762",children:"\u5b9a\u4e49\u804a\u5929\u754c\u9762"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",children:'gr.ChatInterface(\n    inference,\n    chatbot=gr.Chatbot(height=400),\n    textbox=gr.Textbox(placeholder="\u5728\u6b64\u8f93\u5165\u6587\u672c...", container=False, scale=5),\n    description=f"""\n    \u5f53\u524d\u63d0\u793a\u6a21\u677f\uff1a{model_name}\u3002\n    \u4e0d\u6b63\u786e\u7684\u63d0\u793a\u6a21\u677f\u4f1a\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u3002\n    \u8bf7\u68c0\u67e5 API \u89c4\u8303\u4ee5\u786e\u4fdd\u6b64\u683c\u5f0f\u4e0e\u76ee\u6807 LLM \u5339\u914d.""",\n    title="\u7b80\u5355\u7684\u804a\u5929\u673a\u5668\u4eba\u6d4b\u8bd5\u5e94\u7528",\n    examples=["\u7528\u4e00\u53e5\u8bdd\u5b9a\u4e49 \'\u6df1\u5ea6\u5b66\u4e60\'\u3002"],\n    retry_btn="\u91cd\u8bd5",\n    undo_btn="\u64a4\u9500",\n    clear_btn="\u6e05\u9664",\n    theme=theme,\n).queue().launch()\n'})}),"\n",(0,l.jsx)(n.h3,{id:"\u542f\u52a8-gradio-\u5e94\u7528",children:"\u542f\u52a8 Gradio \u5e94\u7528"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u4ece\u547d\u4ee4\u884c\u8fd0\u884c\uff1a",(0,l.jsx)(n.code,{children:"python app.py"})," \u6216 ",(0,l.jsx)(n.code,{children:"gradio app.py"}),"\uff08\u540e\u8005\u542f\u7528\u5b9e\u65f6\u90e8\u7f72\u66f4\u65b0\uff09"]}),"\n",(0,l.jsx)(n.li,{children:"\u5728\u6d4f\u89c8\u5668\u4e2d\u8bbf\u95ee\u63d0\u4f9b\u7684\u8d85\u94fe\u63a5\u3002"}),"\n",(0,l.jsx)(n.li,{children:"\u4eab\u53d7\u4e0e\u8fdc\u7a0b LLM \u670d\u52a1\u5668\u7684\u63d0\u793a\u65e0\u5173\u7684\u4ea4\u4e92\u3002"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u63a8\u8350\u6269\u5c55",children:"\u63a8\u8350\u6269\u5c55\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u6dfb\u52a0\u547d\u4ee4\u884c\u53c2\u6570\u4ee5\u5b9a\u4e49\u76ee\u6807\u6a21\u578b\u53ca\u63a8\u7406\u7aef\u70b9"}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["\u6b64\u6559\u7a0b\u7531 ",(0,l.jsx)(n.a,{href:"https://x.com/ZQ_Dev",children:"ZQ"})," \u63d0\u4f9b\u3002"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(d,{...e})}):d(e)}}}]);