(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[40815],{7227(e,n,a){"use strict";a.d(n,{A:()=>r});a(96540);var s=a(18215);const t="tabItem_Ymn6";var l=a(74848);function r({children:e,hidden:n,className:a}){return(0,l.jsx)("div",{role:"tabpanel",className:(0,s.A)(t,a),hidden:n,children:e})}},23839(e,n,a){e.exports={src:Object.assign(Object.create({toString(){return this.src}}),{srcSet:a.p+"assets/ideal-img/response_cost_img.8b19a11.640.png 640w,"+a.p+"assets/ideal-img/response_cost_img.28c97ee.1920.png 1920w",images:[{path:a.p+"assets/ideal-img/response_cost_img.8b19a11.640.png",width:640,height:334},{path:a.p+"assets/ideal-img/response_cost_img.28c97ee.1920.png",width:1920,height:1003}],src:a.p+"assets/ideal-img/response_cost_img.8b19a11.640.png",placeholder:void 0,width:640,height:334}),preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAtElEQVR4nDXMPWrDQBCG4T2FcRHZmvlmf7TSilTGkcCpcgNfxKdIkaO4cAQh7oVb5zQGYVgYI4KLp3t5jQh/WZFrCGEMIVyI6B9w4dVyLLb7v8XH4dN4789tm7Rp6pxSrTFWGmNU65wKKPvmVW27GQwz/9QpaeXd3QqyPAEZ4Luz0OjtyQD4rYLXOWIinQFQCJSB7OazyGB29PL97qE91rc3KqaOV1MvNHVcTBWXNwK0LMvjAzrtQyAIA+77AAAAAElFTkSuQmCC"}},30765(e,n,a){e.exports={src:Object.assign(Object.create({toString(){return this.src}}),{srcSet:a.p+"assets/ideal-img/admin_ui_spend.1d05b4f.640.png 640w,"+a.p+"assets/ideal-img/admin_ui_spend.91da36f.1920.png 1920w",images:[{path:a.p+"assets/ideal-img/admin_ui_spend.1d05b4f.640.png",width:640,height:313},{path:a.p+"assets/ideal-img/admin_ui_spend.91da36f.1920.png",width:1920,height:939}],src:a.p+"assets/ideal-img/admin_ui_spend.1d05b4f.640.png",placeholder:void 0,width:640,height:313}),preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAYAAAB8ZH1oAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAhklEQVR4nGWNMQrCQBRE9/4nsBN7r2ChpdYKKoqiRMUiEMwmu/P/PgmCCE4z8ObBhLZpaNuIu0PhLwNPKRP685EudngpeIHyI2fxZSFLlN8VMP/0dCnWF2O4CuA8arG5GrvK2FbGK4rYG/ubcXqKlH0QYXUQo5mYLMR4Lu61IxldhpgKMngDNYrBNT3+z4gAAAAASUVORK5CYII="}},49489(e,n,a){"use strict";a.d(n,{A:()=>k});var s=a(96540),t=a(18215),l=a(24245),r=a(56347),i=a(36494),o=a(62814),d=a(45167),c=a(69900);function p(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:n,children:a}=e;return(0,s.useMemo)(()=>{const e=n??function(e){return p(e).map(({props:{value:e,label:n,attributes:a,default:s}})=>({value:e,label:n,attributes:a,default:s}))}(a);return function(e){const n=(0,d.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,a])}function u({value:e,tabValues:n}){return n.some(n=>n.value===e)}function m({queryString:e=!1,groupId:n}){const a=(0,r.W6)(),t=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,o.aZ)(t),(0,s.useCallback)(e=>{if(!t)return;const n=new URLSearchParams(a.location.search);n.set(t,e),a.replace({...a.location,search:n.toString()})},[t,a])]}function g(e){const{defaultValue:n,queryString:a=!1,groupId:t}=e,l=h(e),[r,o]=(0,s.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!u({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const a=n.find(e=>e.default)??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:n,tabValues:l})),[d,p]=m({queryString:a,groupId:t}),[g,_]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[a,t]=(0,c.Dv)(n);return[a,(0,s.useCallback)(e=>{n&&t.set(e)},[n,t])]}({groupId:t}),x=(()=>{const e=d??g;return u({value:e,tabValues:l})?e:null})();(0,i.A)(()=>{x&&o(x)},[x]);return{selectedValue:r,selectValue:(0,s.useCallback)(e=>{if(!u({value:e,tabValues:l}))throw new Error(`Can't select invalid tab value=${e}`);o(e),p(e),_(e)},[p,_,l]),tabValues:l}}var _=a(11062);const x="tabList__CuJ",j="tabItem_LNqP";var b=a(74848);function A({className:e,block:n,selectedValue:a,selectValue:s,tabValues:r}){const i=[],{blockElementScrollPositionUntilNextRender:o}=(0,l.a_)(),d=e=>{const n=e.currentTarget,t=i.indexOf(n),l=r[t].value;l!==a&&(o(n),s(l))},c=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=i.indexOf(e.currentTarget)+1;n=i[a]??i[0];break}case"ArrowLeft":{const a=i.indexOf(e.currentTarget)-1;n=i[a]??i[i.length-1];break}}n?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":n},e),children:r.map(({value:e,label:n,attributes:s})=>(0,b.jsx)("li",{role:"tab",tabIndex:a===e?0:-1,"aria-selected":a===e,ref:e=>{i.push(e)},onKeyDown:c,onClick:d,...s,className:(0,t.A)("tabs__item",j,s?.className,{"tabs__item--active":a===e}),children:n??e},e))})}function f({lazy:e,children:n,selectedValue:a}){const l=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=l.find(e=>e.props.value===a);return e?(0,s.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:l.map((e,n)=>(0,s.cloneElement)(e,{key:n,hidden:e.props.value!==a}))})}function y(e){const n=g(e);return(0,b.jsxs)("div",{className:(0,t.A)("tabs-container",x),children:[(0,b.jsx)(A,{...n,...e}),(0,b.jsx)(f,{...n,...e})]})}function k(e){const n=(0,_.A)();return(0,b.jsx)(y,{...e,children:p(e.children)},String(n))}},83990(e,n,a){e.exports={src:Object.assign(Object.create({toString(){return this.src}}),{srcSet:a.p+"assets/ideal-img/claude_cli_tag_usage.d1b28ea.640.png 640w,"+a.p+"assets/ideal-img/claude_cli_tag_usage.2b72868.1920.png 1920w",images:[{path:a.p+"assets/ideal-img/claude_cli_tag_usage.d1b28ea.640.png",width:640,height:375},{path:a.p+"assets/ideal-img/claude_cli_tag_usage.2b72868.1920.png",width:1920,height:1124}],src:a.p+"assets/ideal-img/claude_cli_tag_usage.d1b28ea.640.png",placeholder:void 0,width:640,height:375}),preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAGCAYAAAD68A/GAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAxElEQVR4nD1NUQ7BQBTcf4kLORH3IOiXuIFfPpsmJEWIM6ikIaIp3ZYE7drd916foDE/M5OZzIgsu/Xuj8K3Fl0i8gjRK4rCQ0SPiFxmngNAW7y0XvEPVPEfZVnih40xvsjzfPkxFsACIhprkYiQ+Vsy38zamVBKLaoBQ8zAzLB7auiGEjqh1KNEsTJmKgDgf43lT7jXF9c3EdfWJ2zscr5r7YskSZppmg5iKftnKZ3sljnB+eJMgqMz3h560300jOK49QbBttmzqmoC4wAAAABJRU5ErkJggg=="}},84818(e,n,a){"use strict";a.r(n),a.d(n,{assets:()=>p,contentTitle:()=>c,default:()=>m,frontMatter:()=>d,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"proxy/cost_tracking","title":"\u8d39\u7528\u8ddf\u8e2a","description":"\u8de8100+LLM\u8ddf\u8e2a\u8d39\u7528\uff0c\u5305\u62ec\u5bc6\u94a5\u3001\u7528\u6237\u548c\u56e2\u961f\u3002","source":"@site/docs/proxy/cost_tracking.md","sourceDirName":"proxy","slug":"/proxy/cost_tracking","permalink":"/docs/proxy/cost_tracking","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"[BETA] \u5f00\u653e\u8eab\u4efd\u8bc6\u522b\u534f\u8bae (OIDC)","permalink":"/docs/oidc"},"next":{"title":"\u81ea\u5b9a\u4e49LLM\u5b9a\u4ef7","permalink":"/docs/proxy/custom_pricing"}}');var t=a(74848),l=a(28453),r=a(49489),i=a(7227),o=a(90547);const d={},c="\u8d39\u7528\u8ddf\u8e2a",p={},h=[{value:"\u5982\u4f55\u4f7f\u7528 LiteLLM \u8ddf\u8e2a\u8d39\u7528",id:"\u5982\u4f55\u4f7f\u7528-litellm-\u8ddf\u8e2a\u8d39\u7528",level:3},{value:"\u5141\u8bb8\u975e\u4ee3\u7406\u7ba1\u7406\u5458\u8bbf\u95ee <code>/spend</code> \u7aef\u70b9",id:"\u5141\u8bb8\u975e\u4ee3\u7406\u7ba1\u7406\u5458\u8bbf\u95ee-spend-\u7aef\u70b9",level:3},{value:"\u521b\u5efa\u5bc6\u94a5",id:"\u521b\u5efa\u5bc6\u94a5",level:5},{value:"\u4f7f\u7528\u751f\u6210\u7684\u5bc6\u94a5\u8bbf\u95ee <code>/spend</code> \u7aef\u70b9",id:"\u4f7f\u7528\u751f\u6210\u7684\u5bc6\u94a5\u8bbf\u95ee-spend-\u7aef\u70b9",level:5},{value:"\u91cd\u7f6e\u56e2\u961f\u548c API \u5bc6\u94a5\u7684\u8d39\u7528 - \u53ea\u6709\u8d85\u7ea7\u7ba1\u7406\u5458\u5bc6\u94a5\u53ef\u4ee5\u8bbf\u95ee",id:"\u91cd\u7f6e\u56e2\u961f\u548c-api-\u5bc6\u94a5\u7684\u8d39\u7528---\u53ea\u6709\u8d85\u7ea7\u7ba1\u7406\u5458\u5bc6\u94a5\u53ef\u4ee5\u8bbf\u95ee",level:4},{value:"\u8bf7\u6c42",id:"\u8bf7\u6c42",level:5},{value:"\u9884\u671f\u54cd\u5e94",id:"\u9884\u671f\u54cd\u5e94",level:5},{value:"\u6bcf\u4e2a\u7528\u6237\u7684\u603b\u652f\u51fa",id:"\u6bcf\u4e2a\u7528\u6237\u7684\u603b\u652f\u51fa",level:2},{value:"\u6bcf\u65e5\u652f\u51fa\u660e\u7ec6 API",id:"\u6bcf\u65e5\u652f\u51fa\u660e\u7ec6-api",level:2},{value:"API \u53c2\u8003",id:"api-\u53c2\u8003",level:3},{value:"\u81ea\u5b9a\u4e49\u6807\u7b7e",id:"\u81ea\u5b9a\u4e49\u6807\u7b7e",level:2},{value:"\u5ba2\u6237\u7aef\u8d39\u7528\u6807\u7b7e",id:"\u5ba2\u6237\u7aef\u8d39\u7528\u6807\u7b7e",level:3},{value:"\u5411\u8d39\u7528\u8ddf\u8e2a\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6807\u5934",id:"\u5411\u8d39\u7528\u8ddf\u8e2a\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6807\u5934",level:3},{value:"\u7981\u7528\u7528\u6237\u4ee3\u7406\u8ddf\u8e2a",id:"\u7981\u7528\u7528\u6237\u4ee3\u7406\u8ddf\u8e2a",level:3},{value:"\u2728 (\u4f01\u4e1a\u7248) \u751f\u6210\u8d39\u7528\u62a5\u544a",id:"-\u4f01\u4e1a\u7248-\u751f\u6210\u8d39\u7528\u62a5\u544a",level:2},{value:"\u793a\u4f8b\u8bf7\u6c42",id:"\u793a\u4f8b\u8bf7\u6c42",level:4},{value:"\u793a\u4f8b\u54cd\u5e94",id:"\u793a\u4f8b\u54cd\u5e94",level:4},{value:"\u793a\u4f8b\u8bf7\u6c42",id:"\u793a\u4f8b\u8bf7\u6c42-1",level:4},{value:"\u793a\u4f8b\u54cd\u5e94",id:"\u793a\u4f8b\u54cd\u5e94-1",level:4},{value:"\u793a\u4f8b\u54cd\u5e94",id:"\u793a\u4f8b\u54cd\u5e94-2",level:4},{value:"\u793a\u4f8b\u8bf7\u6c42",id:"\u793a\u4f8b\u8bf7\u6c42-2",level:4},{value:"\u793a\u4f8b\u54cd\u5e94",id:"\u793a\u4f8b\u54cd\u5e94-3",level:4},{value:"\u67e5\u770b\u5e26\u6709\u81ea\u5b9a\u4e49\u5143\u6570\u636e\u7684\u8d39\u7528",id:"\u67e5\u770b\u5e26\u6709\u81ea\u5b9a\u4e49\u5143\u6570\u636e\u7684\u8d39\u7528",level:4},{value:"<code>/spend/logs</code> \u8bf7\u6c42\u683c\u5f0f",id:"spendlogs-\u8bf7\u6c42\u683c\u5f0f",level:4},{value:"<code>/spend/logs</code> \u54cd\u5e94\u683c\u5f0f",id:"spendlogs-\u54cd\u5e94\u683c\u5f0f",level:4}];function u(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"\u8d39\u7528\u8ddf\u8e2a",children:"\u8d39\u7528\u8ddf\u8e2a"})}),"\n",(0,t.jsx)(n.p,{children:"\u8de8100+LLM\u8ddf\u8e2a\u8d39\u7528\uff0c\u5305\u62ec\u5bc6\u94a5\u3001\u7528\u6237\u548c\u56e2\u961f\u3002"}),"\n",(0,t.jsxs)(n.p,{children:["LiteLLM \u81ea\u52a8\u8ddf\u8e2a\u6240\u6709\u5df2\u77e5\u6a21\u578b\u7684\u8d39\u7528\u3002\u8bf7\u53c2\u9605\u6211\u4eec\u7684 ",(0,t.jsx)(n.a,{href:"https://github.com/BerriAI/litellm/blob/main/model_prices_and_context_window.json",children:"\u6a21\u578b\u6210\u672c\u5730\u56fe"})]}),"\n",(0,t.jsx)(n.admonition,{title:"\u4fdd\u6301\u5b9a\u4ef7\u6570\u636e\u66f4\u65b0",type:"tip",children:(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.a,{href:"/docs/proxy/sync_models_github",children:"\u4ece GitHub \u540c\u6b65\u6a21\u578b\u5b9a\u4ef7\u6570\u636e"}),"\uff0c\u4ee5\u786e\u4fdd\u51c6\u786e\u7684\u6210\u672c\u8ddf\u8e2a\u3002"]})}),"\n",(0,t.jsx)(n.h3,{id:"\u5982\u4f55\u4f7f\u7528-litellm-\u8ddf\u8e2a\u8d39\u7528",children:"\u5982\u4f55\u4f7f\u7528 LiteLLM \u8ddf\u8e2a\u8d39\u7528"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u6b65\u9aa41"})}),"\n",(0,t.jsxs)(n.p,{children:["\ud83d\udc49 ",(0,t.jsx)(n.a,{href:"https://docs.litellm.ai/docs/proxy/virtual_keys#setup",children:"\u8bbe\u7f6e LiteLLM \u6570\u636e\u5e93"})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6b65\u9aa42"})," \u53d1\u9001 ",(0,t.jsx)(n.code,{children:"/chat/completions"})," \u8bf7\u6c42"]}),"\n",(0,t.jsxs)(r.A,{children:[(0,t.jsx)(i.A,{value:"openai",label:"OpenAI Python v1.0.0+",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="\u53d1\u9001\u8bf7\u6c42\u4ee5\u8ddf\u8e2a\u8d39\u7528" showLineNumbers',children:'import openai\nclient = openai.OpenAI(\n    api_key="sk-1234",\n    base_url="http://0.0.0.0:4000"\n)\n\nresponse = client.chat.completions.create(\n    model="llama3",\n    messages = [\n        {\n            "role": "user",\n            "content": "\u8fd9\u662f\u4e00\u4e2a\u6d4b\u8bd5\u8bf7\u6c42\uff0c\u5199\u4e00\u9996\u77ed\u8bd7"\n        }\n    ],\n    user="palantir", # \u53ef\u9009\uff1a\u4f20\u9012\u7528\u6237\u4ee5\u6309\u7528\u6237\u8ddf\u8e2a\u8d39\u7528\n    extra_body={\n        "metadata": {\n            "tags": ["jobID:214590dsff09fds", "taskName:run_page_classification"] # \u4f01\u4e1a\u7248\uff1a\u901a\u8fc7\u6807\u7b7e\u8ddf\u8e2a\u8d39\u7528\n        }\n    }\n)\n\nprint(response)\n\n\n</TabItem>\n\n<TabItem value="Curl" label="Curl \u8bf7\u6c42">\n\n\u4f20\u9012 `metadata` \u4f5c\u4e3a\u8bf7\u6c42\u4f53\u7684\u4e00\u90e8\u5206\n\n```shell title="\u5e26\u6709\u8d39\u7528\u8ddf\u8e2a\u7684 Curl \u8bf7\u6c42" showLineNumbers\ncurl --location \'http://0.0.0.0:4000/chat/completions\' \\\n    --header \'Content-Type: application/json\' \\\n    --header \'Authorization: Bearer sk-1234\' \\\n    --data \'{\n    "model": "llama3",\n    "messages": [\n        {\n        "role": "user",\n        "content": "\u4f60\u662f\u4ec0\u4e48\u7c7b\u578b\u7684LLM"\n        }\n    ],\n    "user": "palantir", # \u53ef\u9009\uff1a\u4f20\u9012\u7528\u6237\u4ee5\u6309\u7528\u6237\u8ddf\u8e2a\u8d39\u7528\n    "metadata": {\n        "tags": ["jobID:214590dsff09fds", "taskName:run_page_classification"] # \u4f01\u4e1a\u7248\uff1a\u901a\u8fc7\u6807\u7b7e\u8ddf\u8e2a\u8d39\u7528\n    }\n}\'\n'})})}),(0,t.jsx)(i.A,{value:"langchain",label:"Langchain",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",metastring:'title="\u5e26\u6709\u8d39\u7528\u8ddf\u8e2a\u7684 Langchain" showLineNumbers',children:'from langchain.chat_models import ChatOpenAI\nfrom langchain.prompts.chat import (\n    ChatPromptTemplate,\n    HumanMessagePromptTemplate,\n    SystemMessagePromptTemplate,\n)\nfrom langchain.schema import HumanMessage, SystemMessage\nimport os\n\nos.environ["OPENAI_API_KEY"] = "sk-1234"\n\nchat = ChatOpenAI(\n    openai_api_base="http://0.0.0.0:4000",\n    model = "llama3",\n    user="palantir",\n    extra_body={\n        "metadata": {\n            "tags": ["jobID:214590dsff09fds", "taskName:run_page_classification"] # \u4f01\u4e1a\u7248\uff1a\u901a\u8fc7\u6807\u7b7e\u8ddf\u8e2a\u8d39\u7528\n        }\n    }\n)\n\nmessages = [\n    SystemMessage(\n        content="\u4f60\u662f\u4e00\u4e2a\u5e2e\u52a9\u52a9\u624b\uff0c\u6211\u7528\u5b83\u6765\u53d1\u9001\u6d4b\u8bd5\u8bf7\u6c42\u3002"\n    ),\n    HumanMessage(\n        content="\u6765\u81ea litellm \u7684\u6d4b\u8bd5\u3002\u544a\u8bc9\u6211\u4e3a\u4ec0\u4e48\u5b83\u662f\u795e\u5947\u7684\uff0c\u4e00\u53e5\u8bdd\u3002"\n    ),\n]\nresponse = chat(messages)\n\nprint(response)\n'})})})]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6b65\u9aa43 - \u9a8c\u8bc1\u8d39\u7528\u8ddf\u8e2a"}),"\n\u5c31\u662f\u8fd9\u6837\u3002\u73b0\u5728\u9a8c\u8bc1\u4f60\u7684\u8d39\u7528\u662f\u5426\u88ab\u8ddf\u8e2a"]}),"\n",(0,t.jsxs)(r.A,{children:[(0,t.jsxs)(i.A,{value:"curl",label:"\u54cd\u5e94\u5934",children:[(0,t.jsxs)(n.p,{children:["\u671f\u671b\u5728\u54cd\u5e94\u5934\u4e2d\u770b\u5230 ",(0,t.jsx)(n.code,{children:"x-litellm-response-cost"}),"\uff0c\u5e26\u6709\u8ba1\u7b97\u51fa\u7684\u8d39\u7528"]}),(0,t.jsx)(o.A,{img:a(23839)})]}),(0,t.jsxs)(i.A,{value:"db",label:"\u6570\u636e\u5e93 + UI",children:[(0,t.jsxs)(n.p,{children:["\u4ee5\u4e0b\u8d39\u7528\u5c06\u5728 ",(0,t.jsx)(n.code,{children:"LiteLLM_SpendLogs"})," \u8868\u4e2d\u8ddf\u8e2a"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="\u652f\u51fa\u65e5\u5fd7\u6761\u76ee\u683c\u5f0f" showLineNumbers',children:'{\n  "api_key": "fe6b0cab4ff5a5a8df823196cc8a450*****",                            # \u4f7f\u7528\u7684 API \u5bc6\u94a5\u7684\u54c8\u5e0c\u503c\n  "user": "default_user",                                                       # \u5185\u90e8\u7528\u6237\uff08LiteLLM_UserTable\uff09\u62e5\u6709 `api_key=sk-1234`\u3002\n  "team_id": "e8d1460f-846c-45d7-9b43-55f3cc52ac32",                            # \u62e5\u6709 `api_key=sk-1234` \u7684\u56e2\u961f\uff08LiteLLM_TeamTable\uff09\n  "request_tags": ["jobID:214590dsff09fds", "taskName:run_page_classification"],# \u8bf7\u6c42\u4e2d\u53d1\u9001\u7684\u6807\u7b7e\n  "end_user": "palantir",                                                       # \u5ba2\u6237 - \u53d1\u9001\u8bf7\u6c42\u65f6\u6307\u5b9a\u7684 `user`\n  "model_group": "llama3",                                                      # "model" \u53c2\u6570\u4f20\u9012\u7ed9 LiteLLM\n  "api_base": "https://api.groq.com/openai/v1/",                                # \u4f7f\u7528 LiteLLM \u7684\u6a21\u578b\u7684 "api_base"\n  "spend": 0.000002,                                                            # \u8d39\u7528\uff08\u5355\u4f4d\uff1a\u7f8e\u5143\uff09\n  "total_tokens": 100,\n  "completion_tokens": 80,\n  "prompt_tokens": 20,\n\n}\n'})}),(0,t.jsxs)(n.p,{children:["\u5bfc\u822a\u5230 LiteLLM UI \u7684\u4f7f\u7528\u6807\u7b7e\u9875\uff08\u5728 ",(0,t.jsx)(n.a,{href:"https://your-proxy-endpoint/ui",children:"https://your-proxy-endpoint/ui"})," \u4e2d\u627e\u5230\uff09\uff0c\u5e76\u9a8c\u8bc1\u4f60\u662f\u5426\u53ef\u4ee5\u5728 ",(0,t.jsx)(n.code,{children:"Usage"})," \u4e0b\u770b\u5230\u8ddf\u8e2a\u7684\u8d39\u7528\u3002"]}),(0,t.jsx)(o.A,{img:a(30765)})]})]}),"\n",(0,t.jsxs)(n.h3,{id:"\u5141\u8bb8\u975e\u4ee3\u7406\u7ba1\u7406\u5458\u8bbf\u95ee-spend-\u7aef\u70b9",children:["\u5141\u8bb8\u975e\u4ee3\u7406\u7ba1\u7406\u5458\u8bbf\u95ee ",(0,t.jsx)(n.code,{children:"/spend"})," \u7aef\u70b9"]}),"\n",(0,t.jsxs)(n.p,{children:["\u5f53\u4f60\u5e0c\u671b\u975e\u4ee3\u7406\u7ba1\u7406\u5458\u80fd\u591f\u8bbf\u95ee ",(0,t.jsx)(n.code,{children:"/spend"})," \u7aef\u70b9\u65f6\u4f7f\u7528\u6b64\u529f\u80fd\u3002"]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["\u9884\u7ea6\u4e0e\u6211\u4eec\u8fdb\u884c ",(0,t.jsx)(n.a,{href:"https://calendly.com/d/4mp-gd3-k5k/litellm-1-1-onboarding-chat",children:"\u4f1a\u8bae\u4ee5\u83b7\u53d6\u4f01\u4e1a\u8bb8\u53ef\u8bc1"})]})}),"\n",(0,t.jsx)(n.h5,{id:"\u521b\u5efa\u5bc6\u94a5",children:"\u521b\u5efa\u5bc6\u94a5"}),"\n",(0,t.jsxs)(n.p,{children:["\u521b\u5efa\u5177\u6709 ",(0,t.jsx)(n.code,{children:'permissions={"get_spend_routes": true}'})," \u7684\u5bc6\u94a5\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",metastring:'title="\u751f\u6210\u5e26\u6709\u652f\u51fa\u8def\u7531\u6743\u9650\u7684\u5bc6\u94a5" showLineNumbers',children:"curl --location 'http://0.0.0.0:4000/key/generate' \\\n        --header 'Authorization: Bearer sk-1234' \\\n        --header 'Content-Type: application/json' \\\n        --data '{\n            \"permissions\": {\"get_spend_routes\": true}\n    }'\n"})}),"\n",(0,t.jsxs)(n.h5,{id:"\u4f7f\u7528\u751f\u6210\u7684\u5bc6\u94a5\u8bbf\u95ee-spend-\u7aef\u70b9",children:["\u4f7f\u7528\u751f\u6210\u7684\u5bc6\u94a5\u8bbf\u95ee ",(0,t.jsx)(n.code,{children:"/spend"})," \u7aef\u70b9"]}),"\n",(0,t.jsx)(n.p,{children:"\u4f7f\u7528\u65b0\u751f\u6210\u7684\u5bc6\u94a5\u8bbf\u95ee\u652f\u51fa\u8def\u7531\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl -X GET 'http://localhost:4000/global/spend/report?start_date=2024-04-01&end_date=2024-06-30' \\\n  -H 'Authorization: Bearer sk-H16BKvrSNConSsBYLGc_7A'\n"})}),"\n",(0,t.jsx)(n.h4,{id:"\u91cd\u7f6e\u56e2\u961f\u548c-api-\u5bc6\u94a5\u7684\u8d39\u7528---\u53ea\u6709\u8d85\u7ea7\u7ba1\u7406\u5458\u5bc6\u94a5\u53ef\u4ee5\u8bbf\u95ee",children:"\u91cd\u7f6e\u56e2\u961f\u548c API \u5bc6\u94a5\u7684\u8d39\u7528 - \u53ea\u6709\u8d85\u7ea7\u7ba1\u7406\u5458\u5bc6\u94a5\u53ef\u4ee5\u8bbf\u95ee"}),"\n",(0,t.jsx)(n.p,{children:"\u5982\u679c\u4f60\u60f3\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u91cd\u7f6e\u6240\u6709 API \u5bc6\u94a5\u548c\u56e2\u961f\u7684\u8d39\u7528\u3002",(0,t.jsx)(n.code,{children:"LiteLLM_TeamTable"})," \u548c ",(0,t.jsx)(n.code,{children:"LiteLLM_VerificationToken"})," \u4e2d\u7684\u6240\u6709\u56e2\u961f\u548c\u5bc6\u94a5\u7684 ",(0,t.jsx)(n.code,{children:"spend"})," \u5c06\u88ab\u8bbe\u7f6e\u4e3a ",(0,t.jsx)(n.code,{children:"spend=0"})]}),"\n",(0,t.jsxs)(n.li,{children:["LiteLLM \u5c06\u4fdd\u7559 ",(0,t.jsx)(n.code,{children:"LiteLLMSpendLogs"})," \u4e2d\u7684\u65e5\u5fd7\u4ee5\u4f9b\u5ba1\u8ba1"]}),"\n"]}),"\n",(0,t.jsx)(n.h5,{id:"\u8bf7\u6c42",children:"\u8bf7\u6c42"}),"\n",(0,t.jsxs)(n.p,{children:["\u53ea\u6709\u4f60\u8bbe\u7f6e\u7684 ",(0,t.jsx)(n.code,{children:"LITELLM_MASTER_KEY"})," \u624d\u80fd\u8bbf\u95ee\u6b64\u8def\u7531\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl -X POST \\\n  'http://localhost:4000/global/spend/reset' \\\n  -H 'Authorization: Bearer sk-1234' \\\n  -H 'Content-Type: application/json'\n"})}),"\n",(0,t.jsx)(n.h5,{id:"\u9884\u671f\u54cd\u5e94",children:"\u9884\u671f\u54cd\u5e94"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'{"message":"\u6240\u6709 API \u5bc6\u94a5\u548c\u56e2\u961f\u7684\u8d39\u7528\u5df2\u91cd\u7f6e\u6210\u529f","status":"success"}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"\u6bcf\u4e2a\u7528\u6237\u7684\u603b\u652f\u51fa",children:"\u6bcf\u4e2a\u7528\u6237\u7684\u603b\u652f\u51fa"}),"\n",(0,t.jsxs)(n.p,{children:["\u5047\u8bbe\u4f60\u5df2\u7ecf\u4e3a\u7ec8\u7aef\u7528\u6237\u53d1\u653e\u4e86\u5bc6\u94a5\uff0c\u5e76\u8bbe\u7f6e\u4e86\u4ed6\u4eec\u7684 ",(0,t.jsx)(n.code,{children:"user_id"}),"\uff0c\u4f60\u53ef\u4ee5\u68c0\u67e5\u4ed6\u4eec\u7684\u4f7f\u7528\u60c5\u51b5\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",metastring:'title="\u83b7\u53d6\u7528\u6237\u652f\u51fa - API \u8bf7\u6c42" showLineNumbers',children:"curl -L -X GET 'http://localhost:4000/user/info?user_id=jane_smith' \\\n-H 'Authorization: Bearer sk-...'\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="\u5355\u4e2a\u7528\u6237\u7684\u603b\u652f\u51fa\u54cd\u5e94" showLineNumbers',children:'{\n  "user_id": "jane_smith",\n  "user_info": {\n    "spend": 0.1\n  },\n  "keys": [\n    {\n      "token": "6e952b0efcafbb6350240db25ed534b4ec6011b3e1ba1006eb4f903461fd36f6",\n      "key_name": "sk-...KE_A",\n      "key_alias": "user-01882d6b-e090-776a-a587-21c63e502670-01983ddb-872f-71a3-8b3a-f9452c705483",\n      "soft_budget_cooldown": false,\n      "spend": 0.1,\n      "expires": "2025-07-31T19:14:13.968000+00:00",\n      "models": [],\n      "aliases": {},\n      "config": {},\n      "user_id": "01982d6b-e090-776a-a587-21c63e502660",\n      "team_id": "f2044fde-2293-482f-bf35-a8dab4e85c5f",\n      "permissions": {},\n      "max_parallel_requests": null,\n      "metadata": {},\n      "blocked": null,\n      "tpm_limit": null,\n      "rpm_limit": null,\n      "max_budget": null,\n      "budget_duration": null,\n      "budget_reset_at": null,\n      "allowed_cache_controls": [],\n      "allowed_routes": [],\n      "model_spend": {},\n      "model_max_budget": {},\n      "budget_id": null,\n      "organization_id": null,\n      "object_permission_id": null,\n      "created_at": "2025-07-24T19:14:13.970000Z",\n      "created_by": "582b168f-fc11-4e14-ad6a-cf4bb3656ddc",\n      "updated_at": "2025-07-24T19:14:13.970000Z",\n      "updated_by": "582b168f-fc11-4e14-ad6a-cf4bb3656ddc",\n      "litellm_budget_table": null,\n      "litellm_organization_table": null,\n      "object_permission": null,\n      "team_alias": null\n    }\n  ],\n  "teams": []\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u8b66\u544a"}),"\n\u7ec8\u7aef\u7528\u6237\u53ef\u4ee5\u5728\u8bf7\u6c42\u4f53\u4e2d\u63d0\u4f9b ",(0,t.jsx)(n.code,{children:"user"})," \u53c2\u6570\uff0c\u8fd9\u6837\u505a\u5c06\u901a\u8fc7 ",(0,t.jsx)(n.code,{children:"/customer/info?end_user_id=self-declared-user"})," \u589e\u52a0\u62a5\u544a\u7684\u8d39\u7528\u3002\u8fd9\u4e0e API \u4e2d\u6240\u62a5\u544a\u7684\u62e5\u6709\u5bc6\u94a5\u7684\u7528\u6237\u7684\u8d39\u7528\u4e0d\u540c\u3002\n\u8fd9\u610f\u5473\u7740\u5982\u679c\u9700\u8981\u8ddf\u8e2a\u7528\u6237\u652f\u51fa\uff0c\u5e76\u4e14\u5411\u7ec8\u7aef\u7528\u6237\u63d0\u4f9b API \u5bc6\u94a5\uff0c\u5219\u5fc5\u987b\u5728\u521b\u5efa\u5176 API \u5bc6\u94a5\u65f6\u59cb\u7ec8\u8bbe\u7f6e ",(0,t.jsx)(n.code,{children:"user_id"}),"\uff0c\u5e76\u5728\u6bcf\u6b21\u4ee3\u8868\u4ed6\u4eec\u5728\u540e\u7aef\u670d\u52a1\u4e2d\u8c03\u7528 LLM \u65f6\u4f7f\u7528\u8be5\u5bc6\u94a5\u3002\u8fd9\u5c06\u8ddf\u8e2a\u4ed6\u4eec\u7684\u652f\u51fa\u3002"]}),"\n",(0,t.jsx)(n.h2,{id:"\u6bcf\u65e5\u652f\u51fa\u660e\u7ec6-api",children:"\u6bcf\u65e5\u652f\u51fa\u660e\u7ec6 API"}),"\n",(0,t.jsx)(n.p,{children:"\u901a\u8fc7\u5355\u4e2a\u7aef\u70b9\u68c0\u7d22\u7528\u6237\u7684\u6bcf\u65e5\u8be6\u7ec6\u4f7f\u7528\u6570\u636e\uff08\u6309\u6a21\u578b\u3001\u63d0\u4f9b\u5546\u548c API \u5bc6\u94a5\u5212\u5206\uff09\u3002"}),"\n",(0,t.jsx)(n.p,{children:"\u793a\u4f8b\u8bf7\u6c42\uff1a"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",metastring:'title="\u6bcf\u65e5\u652f\u51fa\u660e\u7ec6 API" showLineNumbers',children:"curl -L -X GET 'http://localhost:4000/user/daily/activity?start_date=2025-03-20&end_date=2025-03-27' \\\n-H 'Authorization: Bearer sk-...'\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",metastring:'title="\u6bcf\u65e5\u652f\u51fa\u660e\u7ec6 API \u54cd\u5e94" showLineNumbers',children:'{\n    "results": [\n        {\n            "date": "2025-03-27",\n            "metrics": {\n                "spend": 0.0177072,\n                "prompt_tokens": 111,\n                "completion_tokens": 1711,\n                "total_tokens": 1822,\n                "api_requests": 11\n            },\n            "breakdown": {\n                "models": {\n                    "gpt-4o-mini": {\n                        "spend": 1.095e-05,\n                        "prompt_tokens": 37,\n                        "completion_tokens": 9,\n                        "total_tokens": 46,\n                        "api_requests": 1\n                },\n                "providers": { "openai": { ... }, "azure_ai": { ... } },\n                "api_keys": { "3126b6eaf1...": { ... } }\n            }\n        }\n    ],\n    "metadata": {\n        "total_spend": 0.7274667,\n        "total_prompt_tokens": 280990,\n        "total_completion_tokens": 376674,\n        "total_api_requests": 14\n    }\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"api-\u53c2\u8003",children:"API \u53c2\u8003"}),"\n",(0,t.jsxs)(n.p,{children:["\u66f4\u591a\u5173\u4e8e ",(0,t.jsx)(n.code,{children:"/user/daily/activity"})," \u7aef\u70b9\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u8bf7\u53c2\u9605\u6211\u4eec\u7684 ",(0,t.jsx)(n.a,{href:"https://litellm-api.up.railway.app/#/Budget%20%26%20Spend%20Tracking/get_user_daily_activity_user_daily_activity_get",children:"Swagger API"})]}),"\n",(0,t.jsx)(n.h2,{id:"\u81ea\u5b9a\u4e49\u6807\u7b7e",children:"\u81ea\u5b9a\u4e49\u6807\u7b7e"}),"\n",(0,t.jsx)(n.p,{children:"\u8981\u6c42\uff1a"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u865a\u62df\u5bc6\u94a5\u548c\u6570\u636e\u5e93\u5e94\u5df2\u8bbe\u7f6e\uff0c\u53c2\u89c1 ",(0,t.jsx)(n.a,{href:"https://docs.litellm.ai/docs/proxy/virtual_keys",children:"\u865a\u62df\u5bc6\u94a5"})]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"\u6ce8\u610f\uff1a"})," \u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cLiteLLM \u4f1a\u5c06 ",(0,t.jsx)(n.code,{children:"User-Agent"})," \u4f5c\u4e3a\u81ea\u5b9a\u4e49\u6807\u7b7e\u8fdb\u884c\u6210\u672c\u8ddf\u8e2a\u3002\u8fd9\u4f7f\u5f97\u80fd\u591f\u67e5\u770b\u4f7f\u7528\u5de5\u5177\u5982 Claude Code\u3001Gemini CLI \u7b49\u7684\u4f7f\u7528\u60c5\u51b5\u3002"]}),"\n",(0,t.jsx)(o.A,{img:a(83990)}),"\n",(0,t.jsx)(n.h3,{id:"\u5ba2\u6237\u7aef\u8d39\u7528\u6807\u7b7e",children:"\u5ba2\u6237\u7aef\u8d39\u7528\u6807\u7b7e"}),"\n",(0,t.jsxs)(r.A,{children:[(0,t.jsx)(i.A,{value:"key",label:"\u8bbe\u7f6e\u5728\u5bc6\u94a5\u4e0a",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -L -X POST \'http://0.0.0.0:4000/key/generate\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-H \'Content-Type: application/json\' \\\n-d \'{\n    "metadata": {\n        "tags": ["tag1", "tag2", "tag3"]\n    }\n}\n\n\'\n'})})}),(0,t.jsx)(i.A,{value:"team",label:"\u8bbe\u7f6e\u5728\u56e2\u961f\u4e0a",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -L -X POST \'http://0.0.0.0:4000/team/new\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-H \'Content-Type: application/json\' \\\n-d \'{\n    "metadata": {\n        "tags": ["tag1", "tag2", "tag3"]\n    }\n}\n\n\'\n'})})}),(0,t.jsxs)(i.A,{value:"openai",label:"OpenAI Python v1.0.0+",children:[(0,t.jsxs)(n.p,{children:["\u8bbe\u7f6e ",(0,t.jsx)(n.code,{children:'extra_body={"metadata": { }}'})," \u4e3a\u8981\u4f20\u9012\u7684 ",(0,t.jsx)(n.code,{children:"metadata"})]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import openai\nclient = openai.OpenAI(\n    api_key="anything",\n    base_url="http://0.0.0.0:4000"\n)\n\n\nresponse = client.chat.completions.create(\n    model="gpt-3.5-turbo",\n    messages = [\n        {\n            "role": "user",\n            "content": "\u8fd9\u662f\u4e00\u4e2a\u6d4b\u8bd5\u8bf7\u6c42\uff0c\u5199\u4e00\u9996\u77ed\u8bd7"\n        }\n    ],\n    extra_body={\n        "metadata": {\n            "tags": ["model-anthropic-claude-v2.1", "app-ishaan-prod"] # \ud83d\udc48 \u5173\u952e\u66f4\u6539\n        }\n    }\n)\n\nprint(response)\n'})})]}),(0,t.jsx)(i.A,{value:"openai js",label:"OpenAI JS",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'const openai = require("openai");\n\nasync function runOpenAI() {\n  const client = new openai.OpenAI({\n    apiKey: "sk-1234",\n    baseURL: "http://0.0.0.0:4000",\n  });\n\n  try {\n    const response = await client.chat.completions.create({\n      model: "gpt-3.5-turbo",\n      messages: [\n        {\n          role: "user",\n          content: "\u8fd9\u662f\u4e00\u4e2a\u6d4b\u8bd5\u8bf7\u6c42\uff0c\u5199\u4e00\u9996\u77ed\u8bd7"\n        },\n      ],\n      metadata: {\n        tags: ["model-anthropic-claude-v2.1", "app-ishaan-prod"], // \ud83d\udc48 \u5173\u952e\u66f4\u6539\n      },\n    });\n    console.log(response);\n  } catch (error) {\n    console.log("\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u6b64\u5f02\u5e38");\n    console.error(error);\n  }\n}\n\n// \u8c03\u7528\u5f02\u6b65\u51fd\u6570\nrunOpenAI();\n'})})}),(0,t.jsxs)(i.A,{value:"Curl",label:"Curl \u8bf7\u6c42",children:[(0,t.jsxs)(n.p,{children:["\u4f20\u9012 ",(0,t.jsx)(n.code,{children:"metadata"})," \u4f5c\u4e3a\u8bf7\u6c42\u4f53\u7684\u4e00\u90e8\u5206"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'curl --location \'http://0.0.0.0:4000/chat/completions\' \\\n    --header \'Content-Type: application/json\' \\\n    --data \'{\n    "model": "gpt-3.5-turbo",\n    "messages": [\n        {\n        "role": "user",\n        "content": "\u4f60\u662f\u4ec0\u4e48\u7c7b\u578b\u7684LLM"\n        }\n    ],\n    "metadata": {"tags": ["model-anthropic-claude-v2.1", "app-ishaan-prod"]}\n}\'\n'})})]}),(0,t.jsx)(i.A,{value:"langchain",label:"Langchain",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'from langchain.chat_models import ChatOpenAI\nfrom langchain.prompts.chat import (\n    ChatPromptTemplate,\n    HumanMessagePromptTemplate,\n    SystemMessagePromptTemplate,\n)\nfrom langchain.schema import HumanMessage, SystemMessage\n\nchat = ChatOpenAI(\n    openai_api_base="http://0.0.0.0:4000",\n    model = "gpt-3.5-turbo",\n    temperature=0.1,\n    extra_body={\n        "metadata": {\n            "tags": ["model-anthropic-claude-v2.1", "app-ishaan-prod"]\n        }\n    }\n)\n\nmessages = [\n    SystemMessage(\n        content="\u4f60\u662f\u4e00\u4e2a\u5e2e\u52a9\u52a9\u624b\uff0c\u6211\u7528\u5b83\u6765\u53d1\u9001\u6d4b\u8bd5\u8bf7\u6c42\u3002"\n    ),\n    HumanMessage(\n        content="\u6765\u81ea litellm \u7684\u6d4b\u8bd5\u3002\u544a\u8bc9\u6211\u4e3a\u4ec0\u4e48\u5b83\u662f\u795e\u5947\u7684\uff0c\u4e00\u53e5\u8bdd\u3002"\n    ),\n]\nresponse = chat(messages)\n\nprint(response)\n'})})})]}),"\n",(0,t.jsx)(n.h3,{id:"\u5411\u8d39\u7528\u8ddf\u8e2a\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6807\u5934",children:"\u5411\u8d39\u7528\u8ddf\u8e2a\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6807\u5934"}),"\n",(0,t.jsx)(n.p,{children:"\u4f60\u53ef\u4ee5\u5411\u8bf7\u6c42\u4e2d\u6dfb\u52a0\u81ea\u5b9a\u4e49\u6807\u5934\u4ee5\u8ddf\u8e2a\u8d39\u7528\u548c\u4f7f\u7528\u60c5\u51b5\u3002"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'litellm_settings:\n  extra_spend_tag_headers:\n    - "x-custom-header"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"\u7981\u7528\u7528\u6237\u4ee3\u7406\u8ddf\u8e2a",children:"\u7981\u7528\u7528\u6237\u4ee3\u7406\u8ddf\u8e2a"}),"\n",(0,t.jsxs)(n.p,{children:["\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e ",(0,t.jsx)(n.code,{children:"litellm_settings.disable_add_user_agent_to_request_tags"})," \u4e3a ",(0,t.jsx)(n.code,{children:"true"})," \u6765\u7981\u7528\u7528\u6237\u4ee3\u7406\u8ddf\u8e2a\u3002"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"litellm_settings:\n  disable_add_user_agent_to_request_tags: true\n"})}),"\n",(0,t.jsx)(n.h2,{id:"-\u4f01\u4e1a\u7248-\u751f\u6210\u8d39\u7528\u62a5\u544a",children:"\u2728 (\u4f01\u4e1a\u7248) \u751f\u6210\u8d39\u7528\u62a5\u544a"}),"\n",(0,t.jsx)(n.p,{children:"\u4f7f\u7528\u6b64\u529f\u80fd\u5411\u5176\u4ed6\u56e2\u961f\u3001\u5ba2\u6237\u6216\u7528\u6237\u6536\u8d39"}),"\n",(0,t.jsxs)(n.p,{children:["\u4f7f\u7528 ",(0,t.jsx)(n.code,{children:"/global/spend/report"})," \u7aef\u70b9\u83b7\u53d6\u8d39\u7528\u62a5\u544a"]}),"\n",(0,t.jsxs)(r.A,{children:[(0,t.jsxs)(i.A,{value:"per team",label:"\u6309\u56e2\u961f\u5212\u5206\u7684\u8d39\u7528",children:[(0,t.jsx)(n.h4,{id:"\u793a\u4f8b\u8bf7\u6c42",children:"\u793a\u4f8b\u8bf7\u6c42"}),(0,t.jsxs)(n.p,{children:["\ud83d\udc49 \u5173\u952e\u66f4\u6539\uff1a\u6307\u5b9a ",(0,t.jsx)(n.code,{children:"group_by=team"})]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl -X GET 'http://localhost:4000/global/spend/report?start_date=2024-04-01&end_date=2024-06-30&group_by=team' \\\n  -H 'Authorization: Bearer sk-1234'\n"})}),(0,t.jsx)(n.h4,{id:"\u793a\u4f8b\u54cd\u5e94",children:"\u793a\u4f8b\u54cd\u5e94"}),(0,t.jsxs)(r.A,{children:[(0,t.jsx)(i.A,{value:"response",label:"\u9884\u671f\u54cd\u5e94",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'[\n    {\n        "group_by_day": "2024-04-30T00:00:00+00:00",\n        "teams": [\n            {\n                "team_name": "Prod Team",\n                "total_spend": 0.0015265,\n                "metadata": [ # \u770b\u770b\u6309\u552f\u4e00\uff08key + model\uff09\u7684\u652f\u51fa\n                    {\n                        "model": "gpt-4",\n                        "spend": 0.00123,\n                        "total_tokens": 28,\n                        "api_key": "88dc28.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    },\n                    {\n                        "model": "gpt-4",\n                        "spend": 0.00123,\n                        "total_tokens": 28,\n                        "api_key": "a73dc2.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    },\n                    {\n                        "model": "chatgpt-v-2",\n                        "spend": 0.000214,\n                        "total_tokens": 122,\n                        "api_key": "898c28.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    },\n                    {\n                        "model": "gpt-3.5-turbo",\n                        "spend": 0.0000825,\n                        "total_tokens": 85,\n                        "api_key": "84dc28.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    }\n                ]\n            }\n        ]\n    }\n]\n'})})}),(0,t.jsxs)(i.A,{value:"py-script",label:"\u89e3\u6790\u54cd\u5e94\u7684\u811a\u672c\uff08Python\uff09",children:[(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-python",children:'import requests\nurl = \'http://localhost:4000/global/spend/report\'\nparams = {\n    \'start_date\': \'2023-04-01\',\n    \'end_date\': \'2024-06-30\'\n}\n\nheaders = {\n    \'Authorization\': \'Bearer sk-1234\'\n}\n\n# \u53d1\u9001 GET \u8bf7\u6c42\nresponse = requests.get(url, headers=headers, params=params)\nspend_report = response.json()\n\nfor row in spend_report:\n  date = row["group_by_day"]\n  teams = row["teams"]\n  for team in teams:\n      team_name = team["team_name"]\n      total_spend = team["total_spend"]\n      metadata = team["metadata"]\n\n      print(f"\u65e5\u671f: {date}")\n      print(f"\u56e2\u961f: {team_name}")\n      print(f"\u603b\u652f\u51fa: {total_spend}")\n      print("\u5143\u6570\u636e: ", metadata)\n      print()\n'})}),(0,t.jsx)(n.p,{children:"\u811a\u672c\u8f93\u51fa"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"# \u65e5\u671f: 2024-05-11T00:00:00+00:00\n# \u56e2\u961f: local_test_team\n# \u603b\u652f\u51fa: 0.003675099999999999\n# \u5143\u6570\u636e: [{'model': 'gpt-3.5-turbo', 'spend': 0.003675099999999999, 'api_key': 'b94d5e0bc3a71a573917fe1335dc0c14728c7016337451af9714924ff3a729db', 'total_tokens': 3105}]\n\n# \u65e5\u671f: 2024-05-13T00:00:00+00:00\n# \u56e2\u961f: Unassigned Team\n# \u603b\u652f\u51fa: 3.4e-05\n# \u5143\u6570\u636e: [{'model': 'gpt-3.5-turbo', 'spend': 3.4e-05, 'api_key': '9569d13c9777dba68096dea49b0b03e0aaf4d2b65d4030eda9e8a2733c3cd6e0', 'total_tokens': 50}]\n\n# \u65e5\u671f: 2024-05-13T00:00:00+00:00\n# \u56e2\u961f: central\n# \u603b\u652f\u51fa: 0.000684\n# \u5143\u6570\u636e: [{'model': 'gpt-3.5-turbo', 'spend': 0.000684, 'api_key': '0323facdf3af551594017b9ef162434a9b9a8ca1bbd9ccbd9d6ce173b1015605', 'total_tokens': 498}]\n\n# \u65e5\u671f: 2024-05-13T00:00:00+00:00\n# \u56e2\u961f: local_test_team\n# \u603b\u652f\u51fa: 0.0005715000000000001\n# \u5143\u6570\u636e: [{'model': 'gpt-3.5-turbo', 'spend': 0.0005715000000000001, 'api_key': 'b94d5e0bc3a71a573917fe1335dc0c14728c7016337451af9714924ff3a729db', 'total_tokens': 423}]\n"})})]})]})]}),(0,t.jsxs)(i.A,{value:"per customer",label:"\u6309\u5ba2\u6237\u5212\u5206\u7684\u8d39\u7528",children:[(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsxs)(n.p,{children:["\u5ba2\u6237 ",(0,t.jsxs)(n.a,{href:"#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-litellm-%E8%B7%9F%E8%B8%AA%E8%B4%B9%E7%94%A8",children:["\u8fd9\u662f\u4f20\u9012\u7ed9 ",(0,t.jsx)(n.code,{children:"/chat/completions"})," \u8bf7\u6c42\u4e2d\u7684 ",(0,t.jsx)(n.code,{children:"user"})," \u53c2\u6570"]})]}),(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/proxy/virtual_keys",children:"LiteLLM API \u5bc6\u94a5"})}),"\n"]})]}),(0,t.jsx)(n.h4,{id:"\u793a\u4f8b\u8bf7\u6c42-1",children:"\u793a\u4f8b\u8bf7\u6c42"}),(0,t.jsxs)(n.p,{children:["\ud83d\udc49 \u5173\u952e\u66f4\u6539\uff1a\u6307\u5b9a ",(0,t.jsx)(n.code,{children:"group_by=customer"})]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl -X GET 'http://localhost:4000/global/spend/report?start_date=2024-04-01&end_date=2024-06-30&group_by=customer' \\\n  -H 'Authorization: Bearer sk-1234'\n"})}),(0,t.jsx)(n.h4,{id:"\u793a\u4f8b\u54cd\u5e94-1",children:"\u793a\u4f8b\u54cd\u5e94"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'[\n    {\n        "group_by_day": "2024-04-30T00:00:00+00:00",\n        "customers": [\n            {\n                "customer": "palantir",\n                "total_spend": 0.0015265,\n                "metadata": [ # \u770b\u770b\u6309\u552f\u4e00\uff08key + model\uff09\u7684\u652f\u51fa\n                    {\n                        "model": "gpt-4",\n                        "spend": 0.00123,\n                        "total_tokens": 28,\n                        "api_key": "88dc28.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    },\n                    {\n                        "model": "gpt-4",\n                        "spend": 0.00123,\n                        "total_tokens": 28,\n                        "api_key": "a73dc2.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    },\n                    {\n                        "model": "chatgpt-v-2",\n                        "spend": 0.000214,\n                        "total_tokens": 122,\n                        "api_key": "898c28.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    },\n                    {\n                        "model": "gpt-3.5-turbo",\n                        "spend": 0.0000825,\n                        "total_tokens": 85,\n                        "api_key": "84dc28.." # \u88ab\u54c8\u5e0c\u5316\u7684 api key\n                    }\n                ]\n            }\n        ]\n    }\n]\n'})})]}),(0,t.jsxs)(i.A,{value:"per key",label:"\u7279\u5b9a API \u5bc6\u94a5\u7684\u8d39\u7528",children:[(0,t.jsxs)(n.p,{children:["\ud83d\udc49 \u5173\u952e\u66f4\u6539\uff1a\u6307\u5b9a ",(0,t.jsx)(n.code,{children:"api_key=sk-1234"})]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl -X GET 'http://localhost:4000/global/spend/report?start_date=2024-04-01&end_date=2024-06-30&api_key=sk-1234' \\\n  -H 'Authorization: Bearer sk-1234'\n"})}),(0,t.jsx)(n.h4,{id:"\u793a\u4f8b\u54cd\u5e94-2",children:"\u793a\u4f8b\u54cd\u5e94"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'[\n  {\n    "api_key": "example-api-key-123",\n    "total_cost": 0.3201286305151999,\n    "total_input_tokens": 36.0,\n    "total_output_tokens": 1593.0,\n    "model_details": [\n      {\n        "model": "dall-e-3",\n        "total_cost": 0.31999939051519993,\n        "total_input_tokens": 0,\n        "total_output_tokens": 0\n      },\n      {\n        "model": "llama3",\n        "total_cost": 2e-05,\n        "total_input_tokens": 46.0,\n        "total_output_tokens": 9.0\n      }\n    ]\n  }\n]\n'})})]}),(0,t.jsxs)(i.A,{value:"per user",label:"\u6309\u7528\u6237\u5212\u5206\u7684\u8d39\u7528",children:[(0,t.jsx)(n.h4,{id:"\u793a\u4f8b\u8bf7\u6c42-2",children:"\u793a\u4f8b\u8bf7\u6c42"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"curl -X GET 'http://localhost:4000/global/spend/report?user_id=jane_smith' \\\n  -H 'Authorization: Bearer sk-1234'\n"})}),(0,t.jsx)(n.h4,{id:"\u793a\u4f8b\u54cd\u5e94-3",children:"\u793a\u4f8b\u54cd\u5e94"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n    "results": [\n        {\n            "date": "2024-05-13",\n            "metrics": {\n                "spend": 0.000684,\n                "prompt_tokens": 498,\n                "completion_tokens": 97,\n                "total_tokens": 595\n            },\n            "breakdown": {\n                "models": {\n                    "gpt-3.5-turbo": {\n                        "spend": 0.000684,\n                        "prompt_tokens": 498,\n                        "completion_tokens": 97,\n                        "total_tokens": 595\n                    }\n                },\n                "api_keys": [\n                    {\n                        "api_key": "example-api-key-123",\n                        "spend": 0.000684,\n                        "prompt_tokens": 498,\n                        "completion_tokens": 97,\n                        "total_tokens": 595\n                    }\n                ]\n            },\n            "metadata": {\n                "user_id": "jane_smith",\n                "team_id": null,\n                "model_group": "gpt-3.5-turbo"\n            }\n        }\n    ],\n    "metadata": {\n        "total_spend": 0.000684\n    }\n}\n'})})]})]}),"\n",(0,t.jsx)(n.h4,{id:"\u67e5\u770b\u5e26\u6709\u81ea\u5b9a\u4e49\u5143\u6570\u636e\u7684\u8d39\u7528",children:"\u67e5\u770b\u5e26\u6709\u81ea\u5b9a\u4e49\u5143\u6570\u636e\u7684\u8d39\u7528"}),"\n",(0,t.jsxs)(n.h4,{id:"spendlogs-\u8bf7\u6c42\u683c\u5f0f",children:[(0,t.jsx)(n.code,{children:"/spend/logs"})," \u8bf7\u6c42\u683c\u5f0f"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -X GET "http://0.0.0.0:4000/spend/logs?request_id=<\u4f60\u7684\u8c03\u7528ID>" \\ # \u4f8b\u5982\uff1achatcmpl-9ZKMURhVYSi9D6r6PJ9vLcayIK0Vm\n-H "Authorization: Bearer sk-1234"\n'})}),"\n",(0,t.jsxs)(n.h4,{id:"spendlogs-\u54cd\u5e94\u683c\u5f0f",children:[(0,t.jsx)(n.code,{children:"/spend/logs"})," \u54cd\u5e94\u683c\u5f0f"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'[\n    {\n        "request_id": "chatcmpl-9ZKMURhVYSi9D6r6PJ9vLcayIK0Vm",\n        "call_type": "acompletion",\n        "metadata": {\n            "user_api_key": "example-api-key-123",\n            "user_api_key_alias": null,\n            "spend_logs_metadata": { # \ud83d\udc48 \u8bb0\u5f55\u7684\u81ea\u5b9a\u4e49\u5143\u6570\u636e\n                "hello": "world"\n            },\n            "user_api_key_team_id": null,\n            "user_api_key_user_id": "116544810872468347480",\n            "user_api_key_team_alias": null\n        }\n    }\n]\n'})})]})}function m(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}}}]);