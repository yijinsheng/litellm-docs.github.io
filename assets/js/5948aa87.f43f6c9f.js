"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[55308],{7227(e,n,s){s.d(n,{A:()=>t});s(96540);var l=s(18215);const a="tabItem_Ymn6";var r=s(74848);function t({children:e,hidden:n,className:s}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,l.A)(a,s),hidden:n,children:e})}},16620(e,n,s){s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>t,metadata:()=>l,toc:()=>o});const l=JSON.parse('{"id":"tutorials/lm_evaluation_harness","title":"\u57fa\u51c6\u8bc4\u4f30 LLM - LM Harness\uff0cFastEval\uff0cFlask","description":"LM Harness \u57fa\u51c6\u6d4b\u8bd5","source":"@site/docs/tutorials/lm_evaluation_harness.md","sourceDirName":"tutorials","slug":"/tutorials/lm_evaluation_harness","permalink":"/docs/tutorials/lm_evaluation_harness","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var a=s(74848),r=s(28453);s(49489),s(7227);const t={},i="\u57fa\u51c6\u8bc4\u4f30 LLM - LM Harness\uff0cFastEval\uff0cFlask",c={},o=[{value:"LM Harness \u57fa\u51c6\u6d4b\u8bd5",id:"lm-harness-\u57fa\u51c6\u6d4b\u8bd5",level:2},{value:"FastEval",id:"fasteval",level:2},{value:"Flask - \u7ec6\u7c92\u5ea6\u8bed\u8a00\u6a21\u578b\u8bc4\u4f30",id:"flask---\u7ec6\u7c92\u5ea6\u8bed\u8a00\u6a21\u578b\u8bc4\u4f30",level:2},{value:"\u8c03\u8bd5",id:"\u8c03\u8bd5",level:2},{value:"\u5411\u4ee3\u7406\u53d1\u9001\u6d4b\u8bd5\u8bf7\u6c42",id:"\u5411\u4ee3\u7406\u53d1\u9001\u6d4b\u8bd5\u8bf7\u6c42",level:3}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",strong:"strong",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"\u57fa\u51c6\u8bc4\u4f30-llm---lm-harnessfastevalflask",children:"\u57fa\u51c6\u8bc4\u4f30 LLM - LM Harness\uff0cFastEval\uff0cFlask"})}),"\n",(0,a.jsx)(n.h2,{id:"lm-harness-\u57fa\u51c6\u6d4b\u8bd5",children:"LM Harness \u57fa\u51c6\u6d4b\u8bd5"}),"\n",(0,a.jsxs)(n.p,{children:["\u901a\u8fc7 TGI \u4e0e litellm \u4ee3\u7406\u7684 ",(0,a.jsx)(n.code,{children:"/completions"})," \u7aef\u70b9\uff0c20\u500d\u66f4\u5feb\u5730\u8bc4\u4f30 LLM\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u672c\u6559\u7a0b\u5047\u8bbe\u4f60\u6b63\u5728\u4f7f\u7528 ",(0,a.jsx)(n.a,{href:"https://github.com/EleutherAI/lm-evaluation-harness/tree/big-refactor",children:"lm-evaluation-harness"})," \u7684 ",(0,a.jsx)(n.code,{children:"big-refactor"})," \u5206\u652f\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u6ce8\u610f\uff1aLM Harness \u672a\u66f4\u65b0\u4e3a\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"openai 1.0.0+"}),"\uff0c\u4e3a\u4e86\u5904\u7406\u6b64\u95ee\u9898\uff0c\u6211\u4eec\u5c06\u4f7f\u7528 venv \u8fd0\u884c LM Harness"]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 1: \u542f\u52a8\u672c\u5730\u4ee3\u7406"}),"\n\u67e5\u770b\u652f\u6301\u7684\u6a21\u578b ",(0,a.jsx)(n.a,{href:"https://docs.litellm.ai/docs/simple_proxy",children:"\u8fd9\u91cc"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ litellm --model huggingface/bigcode/starcoder\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u4f7f\u7528\u81ea\u5b9a\u4e49 API \u57fa\u7840 URL"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ export HUGGINGFACE_API_KEY=my-api-key #[\u53ef\u9009]\n$ litellm --model huggingface/tinyllama --api_base https://k58ory32yinf1ly0.us-east-1.aws.endpoints.huggingface.cloud\n"})}),"\n",(0,a.jsxs)(n.p,{children:["OpenAI \u517c\u5bb9\u7aef\u70b9: ",(0,a.jsx)(n.a,{href:"http://0.0.0.0:8000",children:"http://0.0.0.0:8000"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 2: \u521b\u5efa LM Harness \u7684\u865a\u62df\u73af\u5883 + \u4f7f\u7528 OpenAI 0.28.1"}),"\n\u6211\u4eec\u73b0\u5728\u5c06\u5728\u4e00\u4e2a\u65b0\u865a\u62df\u73af\u5883\u4e2d\u8fd0\u884c LM Harness\uff0c\u5176\u4e2d openai==0.28.1\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"python3 -m venv lmharness \nsource lmharness/bin/activate\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u865a\u62df\u73af\u5883\u4e2d\u5b89\u88c5 openai==0.28.01"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"pip install openai==0.28.01\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 3: \u8bbe\u7f6e OpenAI API \u57fa\u7840 URL \u548c\u5bc6\u94a5"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ export OPENAI_BASE_URL=http://0.0.0.0:8000\n"})}),"\n",(0,a.jsxs)(n.p,{children:["LM Harness \u8981\u6c42\u4f60\u8bbe\u7f6e\u4e00\u4e2a OpenAI API \u5bc6\u94a5 ",(0,a.jsx)(n.code,{children:"OPENAI_API_SECRET_KEY"})," \u6765\u8fd0\u884c\u57fa\u51c6\u6d4b\u8bd5\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"export OPENAI_API_SECRET_KEY=anything\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 4: \u8fd0\u884c LM-Eval-Harness"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"cd lm-evaluation-harness\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u5728\u865a\u62df\u73af\u5883\u4e2d\u5b89\u88c5 LM Harness \u7684\u4f9d\u8d56\u9879"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"python3 -m pip install -e .\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"python3 -m lm_eval \\\n  --model openai-completions \\\n  --model_args engine=davinci \\\n  --task crows_pairs_english_age\n\n"})}),"\n",(0,a.jsx)(n.h2,{id:"fasteval",children:"FastEval"}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 1: \u542f\u52a8\u672c\u5730\u4ee3\u7406"}),"\n\u67e5\u770b\u652f\u6301\u7684\u6a21\u578b ",(0,a.jsx)(n.a,{href:"https://docs.litellm.ai/docs/simple_proxy",children:"\u8fd9\u91cc"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ litellm --model huggingface/bigcode/starcoder\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 2: \u8bbe\u7f6e OpenAI API \u57fa\u7840 URL \u548c\u5bc6\u94a5"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ export OPENAI_BASE_URL=http://0.0.0.0:8000\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u7531\u4e8e\u4ee3\u7406\u5177\u6709\u51ed\u8bc1\uff0c\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u4efb\u610f\u503c\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"export OPENAI_API_KEY=anything\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 3: \u4f7f\u7528 FastEval \u8fd0\u884c"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u514b\u9686 FastEval"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"# \u514b\u9686\u6b64\u4ed3\u5e93\u5e76\u5c06\u5176\u4f5c\u4e3a\u5f53\u524d\u5de5\u4f5c\u76ee\u5f55\ngit clone --depth 1 https://github.com/FastEval/FastEval.git\ncd FastEval\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u5728 FastEval \u4e2d\u8bbe\u7f6e API \u57fa\u7840 URL"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5728 FastEval \u4e2d\u8fdb\u884c\u4ee5\u4e0b ",(0,a.jsx)(n.strong,{children:"\u4e24\u884c\u4ee3\u7801\u66f4\u6539"}),"\uff0c\u4ee5\u8bbe\u7f6e ",(0,a.jsx)(n.code,{children:"OPENAI_BASE_URL"}),"\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://github.com/FastEval/FastEval/pull/90/files",children:"https://github.com/FastEval/FastEval/pull/90/files"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-python",children:'try:\n    api_base = os.environ["OPENAI_BASE_URL"] # \u66f4\u6539\uff1a\u4ece .env \u6587\u4ef6\u4e2d\u8bfb\u53d6 API \u57fa\u7840 URL\n    if api_base == None:\n        api_base = "https://api.openai.com/v1"\n    response = await self.reply_two_attempts_with_different_max_new_tokens(\n        conversation=conversation,\n        api_base=api_base, # \u66f4\u6539\uff1a\u4f20\u9012 api_base\n        api_key=os.environ["OPENAI_API_KEY"],\n        temperature=temperature,\n        max_new_tokens=max_new_tokens,\n'})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.strong,{children:"\u8fd0\u884c FastEval"}),"\n\u8bbe\u7f6e ",(0,a.jsx)(n.code,{children:"-b"})," \u4e3a\u4f60\u60f3\u8981\u8fd0\u884c\u7684\u57fa\u51c6\u6d4b\u8bd5\u3002\u53ef\u80fd\u7684\u503c\u4e3a ",(0,a.jsx)(n.code,{children:"mt-bench"}),", ",(0,a.jsx)(n.code,{children:"human-eval-plus"}),", ",(0,a.jsx)(n.code,{children:"ds1000"}),", ",(0,a.jsx)(n.code,{children:"cot"}),", ",(0,a.jsx)(n.code,{children:"cot/gsm8k"}),", ",(0,a.jsx)(n.code,{children:"cot/math"}),", ",(0,a.jsx)(n.code,{children:"cot/bbh"}),", ",(0,a.jsx)(n.code,{children:"cot/mmlu"})," \u548c ",(0,a.jsx)(n.code,{children:"custom-test-data"})]}),"\n",(0,a.jsxs)(n.p,{children:["\u7531\u4e8e LiteLLM \u63d0\u4f9b\u4e86\u4e00\u4e2a OpenAI \u517c\u5bb9\u4ee3\u7406\uff0c",(0,a.jsx)(n.code,{children:"-t"})," \u548c ",(0,a.jsx)(n.code,{children:"-m"})," \u4e0d\u9700\u8981\u66f4\u6539\u3002\n",(0,a.jsx)(n.code,{children:"-t"})," \u4fdd\u6301\u4e3a openai\n",(0,a.jsx)(n.code,{children:"-m"})," \u4fdd\u6301\u4e3a gpt-3.5-turbo"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"./fasteval -b human-eval-plus -t openai -m gpt-3.5-turbo\n"})}),"\n",(0,a.jsx)(n.h2,{id:"flask---\u7ec6\u7c92\u5ea6\u8bed\u8a00\u6a21\u578b\u8bc4\u4f30",children:"Flask - \u7ec6\u7c92\u5ea6\u8bed\u8a00\u6a21\u578b\u8bc4\u4f30"}),"\n",(0,a.jsxs)(n.p,{children:["\u4f7f\u7528 litellm \u5728 Flask ",(0,a.jsx)(n.a,{href:"https://github.com/kaistAI/FLASK",children:"https://github.com/kaistAI/FLASK"})," \u4e0a\u8bc4\u4f30\u4efb\u4f55 LLM\u3002"]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 1: \u542f\u52a8\u672c\u5730\u4ee3\u7406"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ litellm --model huggingface/bigcode/starcoder\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 2: \u8bbe\u7f6e OpenAI API \u57fa\u7840 URL \u548c\u5bc6\u94a5"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"$ export OPENAI_BASE_URL=http://0.0.0.0:8000\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u6b65\u9aa4 3: \u4f7f\u7528 Flask \u8fd0\u884c\u8bc4\u4f30"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"git clone https://github.com/kaistAI/FLASK\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"cd FLASK/gpt_review\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u8fd0\u884c\u8bc4\u4f30"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"python gpt4_eval.py -q '../evaluation_set/flask_evaluation.jsonl'\n"})}),"\n",(0,a.jsx)(n.h2,{id:"\u8c03\u8bd5",children:"\u8c03\u8bd5"}),"\n",(0,a.jsx)(n.h3,{id:"\u5411\u4ee3\u7406\u53d1\u9001\u6d4b\u8bd5\u8bf7\u6c42",children:"\u5411\u4ee3\u7406\u53d1\u9001\u6d4b\u8bd5\u8bf7\u6c42"}),"\n",(0,a.jsx)(n.p,{children:"\u6b64\u547d\u4ee4\u5411\u4f60\u7684\u4ee3\u7406\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2a\u6d4b\u8bd5 Completion\u3001ChatCompletion \u8bf7\u6c42\u3002"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"litellm --test\n"})})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},28453(e,n,s){s.d(n,{R:()=>t,x:()=>i});var l=s(96540);const a={},r=l.createContext(a);function t(e){const n=l.useContext(r);return l.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),l.createElement(r.Provider,{value:n},e.children)}},49489(e,n,s){s.d(n,{A:()=>E});var l=s(96540),a=s(18215),r=s(24245),t=s(56347),i=s(36494),c=s(62814),o=s(45167),d=s(69900);function h(e){return l.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,l.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function u(e){const{values:n,children:s}=e;return(0,l.useMemo)(()=>{const e=n??function(e){return h(e).map(({props:{value:e,label:n,attributes:s,default:l}})=>({value:e,label:n,attributes:s,default:l}))}(s);return function(e){const n=(0,o.XI)(e,(e,n)=>e.value===n.value);if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[n,s])}function p({value:e,tabValues:n}){return n.some(n=>n.value===e)}function x({queryString:e=!1,groupId:n}){const s=(0,t.W6)(),a=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,c.aZ)(a),(0,l.useCallback)(e=>{if(!a)return;const n=new URLSearchParams(s.location.search);n.set(a,e),s.replace({...s.location,search:n.toString()})},[a,s])]}function m(e){const{defaultValue:n,queryString:s=!1,groupId:a}=e,r=u(e),[t,c]=(0,l.useState)(()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find(e=>e.default)??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r})),[o,h]=x({queryString:s,groupId:a}),[m,g]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,a]=(0,d.Dv)(n);return[s,(0,l.useCallback)(e=>{n&&a.set(e)},[n,a])]}({groupId:a}),j=(()=>{const e=o??m;return p({value:e,tabValues:r})?e:null})();(0,i.A)(()=>{j&&c(j)},[j]);return{selectedValue:t,selectValue:(0,l.useCallback)(e=>{if(!p({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);c(e),h(e),g(e)},[h,g,r]),tabValues:r}}var g=s(11062);const j="tabList__CuJ",v="tabItem_LNqP";var f=s(74848);function b({className:e,block:n,selectedValue:s,selectValue:l,tabValues:t}){const i=[],{blockElementScrollPositionUntilNextRender:c}=(0,r.a_)(),o=e=>{const n=e.currentTarget,a=i.indexOf(n),r=t[a].value;r!==s&&(c(n),l(r))},d=e=>{let n=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const s=i.indexOf(e.currentTarget)+1;n=i[s]??i[0];break}case"ArrowLeft":{const s=i.indexOf(e.currentTarget)-1;n=i[s]??i[i.length-1];break}}n?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,a.A)("tabs",{"tabs--block":n},e),children:t.map(({value:e,label:n,attributes:l})=>(0,f.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{i.push(e)},onKeyDown:d,onClick:o,...l,className:(0,a.A)("tabs__item",v,l?.className,{"tabs__item--active":s===e}),children:n??e},e))})}function _({lazy:e,children:n,selectedValue:s}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find(e=>e.props.value===s);return e?(0,l.cloneElement)(e,{className:(0,a.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:r.map((e,n)=>(0,l.cloneElement)(e,{key:n,hidden:e.props.value!==s}))})}function A(e){const n=m(e);return(0,f.jsxs)("div",{className:(0,a.A)("tabs-container",j),children:[(0,f.jsx)(b,{...n,...e}),(0,f.jsx)(_,{...n,...e})]})}function E(e){const n=(0,g.A)();return(0,f.jsx)(A,{...e,children:h(e.children)},String(n))}}}]);