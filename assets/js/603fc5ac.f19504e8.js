"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[43122],{28453(e,n,l){l.d(n,{R:()=>r,x:()=>h});var s=l(96540);const i={},d=s.createContext(i);function r(e){const n=s.useContext(d);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function h(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),s.createElement(d.Provider,{value:n},e.children)}},90243(e,n,l){l.r(n),l.d(n,{assets:()=>c,contentTitle:()=>h,default:()=>o,frontMatter:()=>r,metadata:()=>s,toc:()=>a});const s=JSON.parse('{"id":"proxy/shared_health_check","title":"shared_health_check","description":"general_settings:","source":"@site/docs/proxy/shared_health_check.md","sourceDirName":"proxy","slug":"/proxy/shared_health_check","permalink":"/docs/proxy/shared_health_check","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{}}');var i=l(74848),d=l(28453);const r={},h=void 0,c={},a=[{value:"\u73af\u5883\u53d8\u91cf",id:"\u73af\u5883\u53d8\u91cf",level:3},{value:"\u8981\u6c42",id:"\u8981\u6c42",level:2},{value:"API\u7aef\u70b9",id:"api\u7aef\u70b9",level:2},{value:"\u68c0\u67e5\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001",id:"\u68c0\u67e5\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001",level:3},{value:"\u76d1\u63a7",id:"\u76d1\u63a7",level:2},{value:"\u5065\u5eb7\u68c0\u67e5\u72b6\u6001",id:"\u5065\u5eb7\u68c0\u67e5\u72b6\u6001",level:3},{value:"\u65e5\u5fd7",id:"\u65e5\u5fd7",level:3},{value:"\u6545\u969c\u6392\u9664",id:"\u6545\u969c\u6392\u9664",level:2},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:3},{value:"1. \u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u672a\u751f\u6548",id:"1-\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u672a\u751f\u6548",level:4},{value:"2. Redis\u8fde\u63a5\u95ee\u9898",id:"2-redis\u8fde\u63a5\u95ee\u9898",level:4},{value:"3. \u9501\u672a\u91ca\u653e",id:"3-\u9501\u672a\u91ca\u653e",level:4},{value:"\u8c03\u8bd5\u6a21\u5f0f",id:"\u8c03\u8bd5\u6a21\u5f0f",level:3},{value:"\u6027\u80fd\u5f71\u54cd",id:"\u6027\u80fd\u5f71\u54cd",level:2},{value:"\u4f18\u70b9",id:"\u4f18\u70b9",level:3},{value:"\u5f00\u9500",id:"\u5f00\u9500",level:3},{value:"\u6700\u4f73\u5b9e\u8df5",id:"\u6700\u4f73\u5b9e\u8df5",level:2},{value:"1. Redis\u914d\u7f6e",id:"1-redis\u914d\u7f6e",level:3},{value:"2. TTL\u8bbe\u7f6e",id:"2-ttl\u8bbe\u7f6e",level:3},{value:"3. \u76d1\u63a7",id:"3-\u76d1\u63a7",level:3},{value:"4. \u6269\u5c55\u6027",id:"4-\u6269\u5c55\u6027",level:3},{value:"\u793a\u4f8b\u914d\u7f6e",id:"\u793a\u4f8b\u914d\u7f6e",level:2},{value:"\u5b8c\u6574\u793a\u4f8b",id:"\u5b8c\u6574\u793a\u4f8b",level:3},{value:"Kubernetes\u793a\u4f8b",id:"kubernetes\u793a\u4f8b",level:3},{value:"\u8fc1\u79fb",id:"\u8fc1\u79fb",level:2},{value:"\u4ece\u72ec\u7acb\u5065\u5eb7\u68c0\u67e5",id:"\u4ece\u72ec\u7acb\u5065\u5eb7\u68c0\u67e5",level:3},{value:"\u56de\u6eda",id:"\u56de\u6eda",level:3},{value:"\u76f8\u5173\u529f\u80fd",id:"\u76f8\u5173\u529f\u80fd",level:2}];function t(e){const n={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,d.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-markdown",children:"# \u5171\u4eabPod\u95f4\u5065\u5eb7\u68c0\u67e5\u72b6\u6001\n\n\u6b64\u529f\u80fd\u4f7f\u591a\u4e2aLiteLLM\u4ee3\u7406pod\u4e4b\u95f4\u7684\u5065\u5eb7\u68c0\u67e5\u534f\u8c03\uff0c\u907f\u514d\u91cd\u590d\u7684\u5065\u5eb7\u68c0\u67e5\u5e76\u51cf\u5c11\u6210\u672c\u3002\n\n## \u6982\u8ff0\n\n\u5728Kubernetes\u4e2d\u8fd0\u884c\u591a\u4e2aLiteLLM\u4ee3\u7406pod\u65f6\uff08\u4f8b\u5982\uff09\uff0c\u6bcf\u4e2apod\u901a\u5e38\u90fd\u4f1a\u72ec\u7acb\u5730\u5bf9\u6bcf\u4e2a\u6a21\u578b\u8fdb\u884c\u4e00\u6b21\u5065\u5eb7\u68c0\u67e5\u3002\u8fd9\u53ef\u80fd\u5bfc\u81f4\u4ee5\u4e0b\u95ee\u9898\uff1a\n\n- **\u91cd\u590d\u7684\u5065\u5eb7\u68c0\u67e5**\u8de8pod\n- **\u589e\u52a0\u6602\u8d35\u6a21\u578b\u7684\u6210\u672c**\uff08\u4f8b\u5982\uff0cGemini 2.5-pro\uff09\n- **\u5197\u4f59\u7684\u76d1\u63a7/\u65e5\u5fd7\u566a\u58f0**\n- **\u8d44\u6e90\u4f7f\u7528\u6548\u7387\u4f4e\u4e0b**\n\n\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001\u529f\u80fd\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u89e3\u51b3\u4e86\u8fd9\u4e9b\u95ee\u9898\uff1a\n\n- \u4f7f\u7528Redis\u8fdb\u884cpod\u95f4\u5065\u5eb7\u68c0\u67e5\u534f\u8c03\n- \u914d\u7f6e\u7f13\u5b58\u7ed3\u679c\u5e76\u8bbe\u7f6eTTL\n- \u4f7f\u7528\u5206\u5e03\u5f0f\u9501\u4ee5\u786e\u4fdd\u4e00\u6b21\u53ea\u6709\u4e00\u4e2apod\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5\n- \u5141\u8bb8\u5176\u4ed6pod\u8bfb\u53d6\u7f13\u5b58\u7684\u7ed3\u679c\uff0c\u800c\u4e0d\u662f\u8fd0\u884c\u5197\u4f59\u7684\u68c0\u67e5\n\n## \u5de5\u4f5c\u539f\u7406\n\n### 1. \u9501\u83b7\u53d6\n\u5f53\u4e00\u4e2apod\u9700\u8981\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5\u65f6\uff1a\n- \u5c1d\u8bd5\u83b7\u53d6Redis\u9501\n- \u5982\u679c\u6210\u529f\uff0c\u5219\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5\n- \u5982\u679c\u5931\u8d25\uff0c\u5219\u7a0d\u540e\u7b49\u5f85\u5e76\u68c0\u67e5\u7f13\u5b58\u7ed3\u679c\n\n### 2. \u7ed3\u679c\u7f13\u5b58\n\u5728\u8fd0\u884c\u5b8c\u5065\u5eb7\u68c0\u67e5\u4e4b\u540e\uff1a\n- \u7ed3\u679c\u5c06\u5e26\u6709\u53ef\u914d\u7f6e\u7684TTL\u7f13\u5b58\u5728Redis\u4e2d\n- \u5176\u4ed6pod\u53ef\u4ee5\u8bfb\u53d6\u8fd9\u4e9b\u7f13\u5b58\u7684\u7ed3\u679c\n- \u7f13\u5b58\u5305\u62ec\u65f6\u95f4\u6233\u548cpod ID\uff0c\u7528\u4e8e\u8ddf\u8e2a\n\n### 3. \u5907\u7528\u884c\u4e3a\n\u5982\u679cRedis\u4e0d\u53ef\u7528\u6216\u7f13\u5b58\u8fc7\u671f\uff1a\n- pod\u5c06\u56de\u9000\u5230\u672c\u5730\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5\n- \u7cfb\u7edf\u7ee7\u7eed\u6b63\u5e38\u5de5\u4f5c\n\n## \u914d\u7f6e\n\n### \u542f\u7528\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\n\n\u5728`proxy_config.yaml`\u4e2d\u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\uff1a\n\n```yaml\ngeneral_settings:\n  # \u542f\u7528\u540e\u53f0\u5065\u5eb7\u68c0\u67e5\uff08\u5fc5\u9700\uff09\n  background_health_checks: true\n  \n  # \u5728pod\u4e4b\u95f4\u542f\u7528\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001\n  use_shared_health_check: true\n  \n  # \u5065\u5eb7\u68c0\u67e5\u95f4\u9694\uff08\u79d2\uff09\n  health_check_interval: 300  # 5\u5206\u949f\n\n# Redis\u914d\u7f6e\uff08\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u6240\u9700\u7684\u914d\u7f6e\uff09\nlitellm_settings:\n  cache: true\n  cache_params:\n    type: redis\n    host: your-redis-host\n    port: 6379\n    password: your-redis-password\n"})}),"\n",(0,i.jsx)(n.h3,{id:"\u73af\u5883\u53d8\u91cf",children:"\u73af\u5883\u53d8\u91cf"}),"\n",(0,i.jsx)(n.p,{children:"\u60a8\u4e5f\u53ef\u4ee5\u4f7f\u7528\u73af\u5883\u53d8\u91cf\u8fdb\u884c\u914d\u7f6e\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# \u542f\u7528\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\nexport USE_SHARED_HEALTH_CHECK=true\n\n# \u5065\u5eb7\u68c0\u67e5TTL\uff08\u79d2\uff09\nexport DEFAULT_SHARED_HEALTH_CHECK_TTL=300\n\n# \u9501TTL\uff08\u79d2\uff09\nexport DEFAULT_SHARED_HEALTH_CHECK_LOCK_TTL=60\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u8981\u6c42",children:"\u8981\u6c42"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Redis"}),"\uff1a\u7528\u4e8e\u5171\u4eab\u72b6\u6001\u534f\u8c03"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u540e\u53f0\u5065\u5eb7\u68c0\u67e5"}),"\uff1a\u5fc5\u987b\u542f\u7528 (",(0,i.jsx)(n.code,{children:"background_health_checks: true"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u591a\u4e2apod"}),"\uff1a\u6700\u53d7\u76ca\u4e8e2+\u4e2a\u4ee3\u7406\u5b9e\u4f8b"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"api\u7aef\u70b9",children:"API\u7aef\u70b9"}),"\n",(0,i.jsx)(n.h3,{id:"\u68c0\u67e5\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001",children:"\u68c0\u67e5\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"GET /health/shared-status\n"})}),"\n",(0,i.jsx)(n.p,{children:"\u8fd4\u56de\u5173\u4e8e\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u534f\u8c03\u7684\u4fe1\u606f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "shared_health_check_enabled": true,\n  "status": {\n    "pod_id": "pod_1703123456789",\n    "redis_available": true,\n    "lock_ttl": 60,\n    "cache_ttl": 300,\n    "lock_owner": "pod_1703123456788",\n    "lock_in_progress": true,\n    "cache_available": true,\n    "cache_age_seconds": 45.2,\n    "last_checked_by": "pod_1703123456788"\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u76d1\u63a7",children:"\u76d1\u63a7"}),"\n",(0,i.jsx)(n.h3,{id:"\u5065\u5eb7\u68c0\u67e5\u72b6\u6001",children:"\u5065\u5eb7\u68c0\u67e5\u72b6\u6001"}),"\n",(0,i.jsx)(n.p,{children:"\u76d1\u63a7\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001\u4ee5\u786e\u4fdd\u534f\u8c03\u6b63\u786e\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:'curl -H "Authorization: Bearer your-api-key" \\\n  http://your-proxy-host/health/shared-status\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u65e5\u5fd7",children:"\u65e5\u5fd7"}),"\n",(0,i.jsx)(n.p,{children:"\u67e5\u627e\u4ee5\u4e0b\u65e5\u5fd7\u6d88\u606f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"INFO: \u521d\u59cb\u5316\u4e86\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u7ba1\u7406\u5668\nINFO: Pod pod_123 \u83b7\u53d6\u4e86\u5065\u5eb7\u68c0\u67e5\u9501\nINFO: Pod pod_123 \u91ca\u653e\u4e86\u5065\u5eb7\u68c0\u67e5\u9501\nINFO: \u7f13\u5b58\u4e865\u4e2a\u5065\u5eb7\u7684\u548c0\u4e2a\u4e0d\u5065\u5eb7\u7684\u7aef\u70b9\u7684\u5065\u5eb7\u68c0\u67e5\u7ed3\u679c\nDEBUG: \u4f7f\u7528\u7f13\u5b58\u7684\u5065\u5eb7\u68c0\u67e5\u7ed3\u679c\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6545\u969c\u6392\u9664",children:"\u6545\u969c\u6392\u9664"}),"\n",(0,i.jsx)(n.h3,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,i.jsx)(n.h4,{id:"1-\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u672a\u751f\u6548",children:"1. \u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u672a\u751f\u6548"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u75c7\u72b6"}),"\uff1a\u6bcf\u4e2apod\u4ecd\u7136\u72ec\u7acb\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9a8c\u8bc1Redis\u5df2\u914d\u7f6e\u5e76\u53ef\u8bbf\u95ee"}),"\n",(0,i.jsxs)(n.li,{children:["\u786e\u4fdd ",(0,i.jsx)(n.code,{children:"use_shared_health_check: true"})," \u8bbe\u7f6e\u6b63\u786e"]}),"\n",(0,i.jsxs)(n.li,{children:["\u786e\u8ba4 ",(0,i.jsx)(n.code,{children:"background_health_checks: true"})," \u5df2\u542f\u7528"]}),"\n",(0,i.jsx)(n.li,{children:"\u68c0\u67e5\u65e5\u5fd7\u4e2d\u7684Redis\u8fde\u63a5\u60c5\u51b5"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"2-redis\u8fde\u63a5\u95ee\u9898",children:"2. Redis\u8fde\u63a5\u95ee\u9898"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u75c7\u72b6"}),"\uff1a\u5065\u5eb7\u68c0\u67e5\u56de\u9000\u5230\u672c\u5730\u6267\u884c"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9a8c\u8bc1Redis\u4e3b\u673a\u3001\u7aef\u53e3\u548c\u51ed\u636e"}),"\n",(0,i.jsx)(n.li,{children:"\u68c0\u67e5pod\u4e0eRedis\u4e4b\u95f4\u7684\u7f51\u7edc\u8fde\u901a\u6027"}),"\n",(0,i.jsx)(n.li,{children:"\u76d1\u63a7Redis\u670d\u52a1\u5668\u65e5\u5fd7\u4ee5\u67e5\u627e\u9519\u8bef"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"3-\u9501\u672a\u91ca\u653e",children:"3. \u9501\u672a\u91ca\u653e"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u75c7\u72b6"}),"\uff1a\u4e00\u4e2apod\u65e0\u9650\u671f\u6301\u6709\u9501"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\u89e3\u51b3\u65b9\u6848"}),"\uff1a"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u9501\u5177\u6709\u81ea\u52a8TTL\uff08\u9ed8\u8ba460\u79d2\uff09"}),"\n",(0,i.jsx)(n.li,{children:"\u68c0\u67e5pod\u65e5\u5fd7\u4e2d\u7684\u9501\u91ca\u653e\u6d88\u606f"}),"\n",(0,i.jsx)(n.li,{children:"\u9a8c\u8bc1Redis TTL\u8bbe\u7f6e"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u8c03\u8bd5\u6a21\u5f0f",children:"\u8c03\u8bd5\u6a21\u5f0f"}),"\n",(0,i.jsx)(n.p,{children:"\u542f\u7528\u8c03\u8bd5\u65e5\u5fd7\u4ee5\u67e5\u770b\u8be6\u7ec6\u7684\u534f\u8c03\u4fe1\u606f\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"general_settings:\n  set_verbose: true\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u6027\u80fd\u5f71\u54cd",children:"\u6027\u80fd\u5f71\u54cd"}),"\n",(0,i.jsx)(n.h3,{id:"\u4f18\u70b9",children:"\u4f18\u70b9"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u51cf\u5c11API\u8c03\u7528"}),"\uff1a\u6bcf\u4e2a\u95f4\u9694\u4ec5\u6709\u4e00\u4e2apod\u8fd0\u884c\u5065\u5eb7\u68c0\u67e5"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u964d\u4f4e\u6210\u672c"}),"\uff1a\u7279\u522b\u662f\u5bf9\u4e8e\u6602\u8d35\u7684\u6a21\u578b\u800c\u8a00\u66f4\u4e3a\u663e\u8457"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u66f4\u597d\u7684\u8d44\u6e90\u5229\u7528\u7387"}),"\uff1a\u51cf\u5c11\u4e86pod\u95f4\u7684\u5197\u4f59\u5de5\u4f5c"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u66f4\u5e72\u51c0\u7684\u76d1\u63a7"}),"\uff1a\u51cf\u5c11\u4e86\u65e5\u5fd7\u548c\u6307\u6807\u4e2d\u7684\u566a\u58f0"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u5f00\u9500",children:"\u5f00\u9500"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Redis\u64cd\u4f5c"}),"\uff1a\u9501/\u7f13\u5b58\u64cd\u4f5c\u7684\u6700\u5c0f\u5f00\u9500"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u7f51\u7edc\u5ef6\u8fdf"}),"\uff1a\u4e0eRedis\u901a\u4fe1\u7684\u5c0f\u5ef6\u8fdf"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u5185\u5b58\u4f7f\u7528\u91cf"}),"\uff1a\u51e0\u4e4e\u65e0\u989d\u5916\u5185\u5b58\u4f7f\u7528"]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u6700\u4f73\u5b9e\u8df5",children:"\u6700\u4f73\u5b9e\u8df5"}),"\n",(0,i.jsx)(n.h3,{id:"1-redis\u914d\u7f6e",children:"1. Redis\u914d\u7f6e"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4f7f\u7528\u542f\u7528\u4e86\u6301\u4e45\u5316\u7684Redis"}),"\n",(0,i.jsx)(n.li,{children:"\u914d\u7f6e\u9002\u5f53\u7684\u5185\u5b58\u9650\u5236"}),"\n",(0,i.jsx)(n.li,{children:"\u8bbe\u7f6eRedis\u76d1\u63a7\u548c\u8b66\u62a5"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"2-ttl\u8bbe\u7f6e",children:"2. TTL\u8bbe\u7f6e"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5c06 ",(0,i.jsx)(n.code,{children:"health_check_interval"})," \u8bbe\u7f6e\u4e3a\u6240\u9700\u7684\u68c0\u67e5\u9891\u7387"]}),"\n",(0,i.jsx)(n.li,{children:"\u9664\u975e\u6709\u7279\u5b9a\u8981\u6c42\uff0c\u5426\u5219\u4f7f\u7528\u9ed8\u8ba4TTL\u503c"}),"\n",(0,i.jsx)(n.li,{children:"\u8003\u8651\u6602\u8d35\u6a21\u578b\u7684\u7279\u5b9a\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"3-\u76d1\u63a7",children:"3. \u76d1\u63a7"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u76d1\u63a7\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u72b6\u6001\u7aef\u70b9"}),"\n",(0,i.jsx)(n.li,{children:"\u8bbe\u7f6eRedis\u8fde\u63a5\u95ee\u9898\u7684\u8b66\u62a5"}),"\n",(0,i.jsx)(n.li,{children:"\u8ddf\u8e2a\u5065\u5eb7\u68c0\u67e5\u6210\u672c\u548c\u9891\u7387"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"4-\u6269\u5c55\u6027",children:"4. \u6269\u5c55\u6027"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u529f\u80fd\u9002\u7528\u4e8e\u4efb\u610f\u6570\u91cf\u7684pod"}),"\n",(0,i.jsx)(n.li,{children:"pod\u8d8a\u591a=\u534f\u8c03\u6536\u76ca\u8d8a\u5927"}),"\n",(0,i.jsx)(n.li,{children:"\u8003\u8651\u4f7f\u7528Redis\u96c6\u7fa4\u4ee5\u63d0\u9ad8\u53ef\u7528\u6027"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"\u793a\u4f8b\u914d\u7f6e",children:"\u793a\u4f8b\u914d\u7f6e"}),"\n",(0,i.jsx)(n.h3,{id:"\u5b8c\u6574\u793a\u4f8b",children:"\u5b8c\u6574\u793a\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"# proxy_config.yaml\nmodel_list:\n  - model_name: gpt-4\n    litellm_params:\n      model: gpt-4\n      api_key: os.environ/OPENAI_API_KEY\n    model_info:\n      health_check_timeout: 30  # 30\u79d2\u5065\u5eb7\u68c0\u67e5\u8d85\u65f6\n\ngeneral_settings:\n  # \u542f\u7528\u540e\u53f0\u5065\u5eb7\u68c0\u67e5\n  background_health_checks: true\n  \n  # \u542f\u7528\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\u534f\u8c03\n  use_shared_health_check: true\n  \n  # \u5065\u5eb7\u68c0\u67e5\u95f4\u9694\uff085\u5206\u949f\uff09\n  health_check_interval: 300\n  \n  # \u5065\u5eb7\u68c0\u67e5\u8be6\u7ec6\u4fe1\u606f\n  health_check_details: true\n\nlitellm_settings:\n  # Redis\u914d\u7f6e\n  cache: true\n  cache_params:\n    type: redis\n    host: redis-cluster.example.com\n    port: 6379\n    password: os.environ/REDIS_PASSWORD\n    ssl: true\n"})}),"\n",(0,i.jsx)(n.h3,{id:"kubernetes\u793a\u4f8b",children:"Kubernetes\u793a\u4f8b"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'# deployment.yaml\napiVersion: apps/v1\nkind: Deployment\nmetadata:\n  name: litellm-proxy\nspec:\n  replicas: 3  # \u591a\u4e2apod\u4ee5\u8fdb\u884c\u534f\u8c03\n  template:\n    spec:\n      containers:\n      - name: litellm-proxy\n        image: docker.litellm.ai/berriai/litellm:latest\n        env:\n        - name: USE_SHARED_HEALTH_CHECK\n          value: "true"\n        - name: REDIS_HOST\n          value: "redis-service"\n        - name: REDIS_PASSWORD\n          valueFrom:\n            secretKeyRef:\n              name: redis-secret\n              key: password\n'})}),"\n",(0,i.jsx)(n.h2,{id:"\u8fc1\u79fb",children:"\u8fc1\u79fb"}),"\n",(0,i.jsx)(n.h3,{id:"\u4ece\u72ec\u7acb\u5065\u5eb7\u68c0\u67e5",children:"\u4ece\u72ec\u7acb\u5065\u5eb7\u68c0\u67e5"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u542f\u7528Redis"}),"\uff1a\u786e\u4fdd\u5df2\u914d\u7f6e\u5e76\u53ef\u8bbf\u95eeRedis"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u542f\u7528\u540e\u53f0\u5065\u5eb7\u68c0\u67e5"}),"\uff1a\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"background_health_checks: true"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u542f\u7528\u5171\u4eab\u5065\u5eb7\u68c0\u67e5"}),"\uff1a\u8bbe\u7f6e ",(0,i.jsx)(n.code,{children:"use_shared_health_check: true"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u90e8\u7f72"}),"\uff1a\u66f4\u65b0\u4ee3\u7406\u914d\u7f6e"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"\u76d1\u63a7"}),"\uff1a\u68c0\u67e5 ",(0,i.jsx)(n.code,{children:"/health/shared-status"})," \u7aef\u70b9"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"\u56de\u6eda",children:"\u56de\u6eda"}),"\n",(0,i.jsx)(n.p,{children:"\u8981\u7981\u7528\u5171\u4eab\u5065\u5eb7\u68c0\u67e5\uff1a"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"general_settings:\n  use_shared_health_check: false\n  # background_health_checks \u53ef\u4ee5\u4fdd\u6301\u4e3a\u72ec\u7acb\u68c0\u67e5\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u76f8\u5173\u529f\u80fd",children:"\u76f8\u5173\u529f\u80fd"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/proxy/health#background-health-checks",children:"\u540e\u53f0\u5065\u5eb7\u68c0\u67e5"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/proxy/caching",children:"Redis\u7f13\u5b58"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/proxy/db_deadlocks",children:"\u9ad8\u53ef\u7528\u6027\u8bbe\u7f6e"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"/docs/proxy/health#health-endpoints",children:"\u5065\u5eb7\u68c0\u67e5\u7aef\u70b9"})}),"\n"]})]})}function o(e={}){const{wrapper:n}={...(0,d.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(t,{...e})}):t(e)}}}]);