"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[36616],{7227(e,r,n){n.d(r,{A:()=>l});n(96540);var a=n(18215);const t="tabItem_Ymn6";var s=n(74848);function l({children:e,hidden:r,className:n}){return(0,s.jsx)("div",{role:"tabpanel",className:(0,a.A)(t,n),hidden:r,children:e})}},49489(e,r,n){n.d(r,{A:()=>A});var a=n(96540),t=n(18215),s=n(24245),l=n(56347),i=n(36494),o=n(62814),c=n(45167),u=n(69900);function d(e){return a.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,a.isValidElement)(e)&&function(e){const{props:r}=e;return!!r&&"object"==typeof r&&"value"in r}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:r,children:n}=e;return(0,a.useMemo)(()=>{const e=r??function(e){return d(e).map(({props:{value:e,label:r,attributes:n,default:a}})=>({value:e,label:r,attributes:n,default:a}))}(n);return function(e){const r=(0,c.XI)(e,(e,r)=>e.value===r.value);if(r.length>0)throw new Error(`Docusaurus error: Duplicate values "${r.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[r,n])}function p({value:e,tabValues:r}){return r.some(r=>r.value===e)}function m({queryString:e=!1,groupId:r}){const n=(0,l.W6)(),t=function({queryString:e=!1,groupId:r}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:e,groupId:r});return[(0,o.aZ)(t),(0,a.useCallback)(e=>{if(!t)return;const r=new URLSearchParams(n.location.search);r.set(t,e),n.replace({...n.location,search:r.toString()})},[t,n])]}function f(e){const{defaultValue:r,queryString:n=!1,groupId:t}=e,s=h(e),[l,o]=(0,a.useState)(()=>function({defaultValue:e,tabValues:r}){if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${r.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=r.find(e=>e.default)??r[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:r,tabValues:s})),[c,d]=m({queryString:n,groupId:t}),[f,x]=function({groupId:e}){const r=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,t]=(0,u.Dv)(r);return[n,(0,a.useCallback)(e=>{r&&t.set(e)},[r,t])]}({groupId:t}),g=(()=>{const e=c??f;return p({value:e,tabValues:s})?e:null})();(0,i.A)(()=>{g&&o(g)},[g]);return{selectedValue:l,selectValue:(0,a.useCallback)(e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),x(e)},[d,x,s]),tabValues:s}}var x=n(11062);const g="tabList__CuJ",v="tabItem_LNqP";var j=n(74848);function b({className:e,block:r,selectedValue:n,selectValue:a,tabValues:l}){const i=[],{blockElementScrollPositionUntilNextRender:o}=(0,s.a_)(),c=e=>{const r=e.currentTarget,t=i.indexOf(r),s=l[t].value;s!==n&&(o(r),a(s))},u=e=>{let r=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=i.indexOf(e.currentTarget)+1;r=i[n]??i[0];break}case"ArrowLeft":{const n=i.indexOf(e.currentTarget)-1;r=i[n]??i[i.length-1];break}}r?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":r},e),children:l.map(({value:e,label:r,attributes:a})=>(0,j.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{i.push(e)},onKeyDown:u,onClick:c,...a,className:(0,t.A)("tabs__item",v,a?.className,{"tabs__item--active":n===e}),children:r??e},e))})}function _({lazy:e,children:r,selectedValue:n}){const s=(Array.isArray(r)?r:[r]).filter(Boolean);if(e){const e=s.find(e=>e.props.value===n);return e?(0,a.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:s.map((e,r)=>(0,a.cloneElement)(e,{key:r,hidden:e.props.value!==n}))})}function y(e){const r=f(e);return(0,j.jsxs)("div",{className:(0,t.A)("tabs-container",g),children:[(0,j.jsx)(b,{...r,...e}),(0,j.jsx)(_,{...r,...e})]})}function A(e){const r=(0,x.A)();return(0,j.jsx)(y,{...e,children:d(e.children)},String(r))}},75155(e,r,n){n.r(r),n.d(r,{assets:()=>o,contentTitle:()=>i,default:()=>d,frontMatter:()=>l,metadata:()=>a,toc:()=>c});const a=JSON.parse('{"id":"proxy/guardrails/azure_content_guardrail","title":"Azure \u5185\u5bb9\u5b89\u5168\u62a4\u680f","description":"LiteLLM \u901a\u8fc7 Azure \u5185\u5bb9\u5b89\u5168 API \u652f\u6301 Azure \u5185\u5bb9\u5b89\u5168\u62a4\u680f\u3002","source":"@site/docs/proxy/guardrails/azure_content_guardrail.md","sourceDirName":"proxy/guardrails","slug":"/proxy/guardrails/azure_content_guardrail","permalink":"/docs/proxy/guardrails/azure_content_guardrail","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"integrationsSidebar","previous":{"title":"Aporia","permalink":"/docs/proxy/guardrails/aporia_api"},"next":{"title":"Bedrock \u5b88\u62a4","permalink":"/docs/proxy/guardrails/bedrock"}}');var t=n(74848),s=n(28453);n(90547),n(49489),n(7227);const l={},i="Azure \u5185\u5bb9\u5b89\u5168\u62a4\u680f",o={},c=[{value:"\u652f\u6301\u7684\u62a4\u680f",id:"\u652f\u6301\u7684\u62a4\u680f",level:2},{value:"\u5feb\u901f\u5f00\u59cb",id:"\u5feb\u901f\u5f00\u59cb",level:2},{value:"1. \u5728 LiteLLM config.yaml \u4e2d\u5b9a\u4e49\u62a4\u680f",id:"1-\u5728-litellm-configyaml-\u4e2d\u5b9a\u4e49\u62a4\u680f",level:3},{value:"3. \u6d4b\u8bd5\u8bf7\u6c42",id:"3-\u6d4b\u8bd5\u8bf7\u6c42",level:3},{value:"\u652f\u6301\u7684\u53c2\u6570",id:"\u652f\u6301\u7684\u53c2\u6570",level:2},{value:"\u5171\u540c\u53c2\u6570",id:"\u5171\u540c\u53c2\u6570",level:3},{value:"Azure \u6587\u672c\u5ba1\u6838",id:"azure-\u6587\u672c\u5ba1\u6838",level:3},{value:"Azure Prompt Shield \u4e13\u7528\u53c2\u6570",id:"azure-prompt-shield-\u4e13\u7528\u53c2\u6570",level:3},{value:"\u8fdb\u4e00\u6b65\u9605\u8bfb",id:"\u8fdb\u4e00\u6b65\u9605\u8bfb",level:2}];function u(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"azure-\u5185\u5bb9\u5b89\u5168\u62a4\u680f",children:"Azure \u5185\u5bb9\u5b89\u5168\u62a4\u680f"})}),"\n",(0,t.jsxs)(r.p,{children:["LiteLLM \u901a\u8fc7 ",(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/overview",children:"Azure \u5185\u5bb9\u5b89\u5168 API"})," \u652f\u6301 Azure \u5185\u5bb9\u5b89\u5168\u62a4\u680f\u3002"]}),"\n",(0,t.jsx)(r.h2,{id:"\u652f\u6301\u7684\u62a4\u680f",children:"\u652f\u6301\u7684\u62a4\u680f"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/quickstart-jailbreak?pivots=programming-language-rest",children:"Prompt Shield"})}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/quickstart-text?tabs=visual-studio%2Clinux&pivots=programming-language-rest",children:"\u6587\u672c\u5ba1\u6838"})}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"\u5feb\u901f\u5f00\u59cb",children:"\u5feb\u901f\u5f00\u59cb"}),"\n",(0,t.jsx)(r.h3,{id:"1-\u5728-litellm-configyaml-\u4e2d\u5b9a\u4e49\u62a4\u680f",children:"1. \u5728 LiteLLM config.yaml \u4e2d\u5b9a\u4e49\u62a4\u680f"}),"\n",(0,t.jsxs)(r.p,{children:["\u5728 ",(0,t.jsx)(r.code,{children:"guardrails"})," \u90e8\u5206\u5b9a\u4e49\u60a8\u7684\u62a4\u680f"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-yaml",children:"model_list:\n  - model_name: gpt-3.5-turbo\n    litellm_params:\n      model: openai/gpt-3.5-turbo\n      api_key: os.environ/OPENAI_API_KEY\n\nguardrails:\n  - guardrail_name: azure-prompt-shield\n    litellm_params:\n      guardrail: azure/prompt_shield\n      mode: pre_call # \u53ea\u652f\u6301\u7684\u6a21\u5f0f\u4e3a pre_call\n      api_key: os.environ/AZURE_GUARDRAIL_API_KEY\n      api_base: os.environ/AZURE_GUARDRAIL_API_BASE \n  - guardrail_name: azure-text-moderation\n    litellm_params:\n      guardrail: azure/text_moderations\n      mode: [pre_call, post_call] \n      api_key: os.environ/AZURE_GUARDRAIL_API_KEY\n      api_base: os.environ/AZURE_GUARDRAIL_API_BASE \n      default_on: true\n\n\n#### `mode` \u652f\u6301\u7684\u503c\n\n- `pre_call` \u5728\u8c03\u7528 LLM \u4e4b\u524d\u8fd0\u884c\uff0c\u9488\u5bf9 **\u8f93\u5165**\n- `post_call` \u5728\u8c03\u7528 LLM \u4e4b\u540e\u8fd0\u884c\uff0c\u9488\u5bf9 **\u8f93\u5165\u53ca\u8f93\u51fa**\n\n### 2. \u542f\u52a8 LiteLLM \u7f51\u5173 \n\n```shell\nlitellm --config config.yaml --detailed_debug\n"})}),"\n",(0,t.jsx)(r.h3,{id:"3-\u6d4b\u8bd5\u8bf7\u6c42",children:"3. \u6d4b\u8bd5\u8bf7\u6c42"}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:(0,t.jsx)(r.a,{href:"../proxy/user_keys#request-format",children:"Langchain, OpenAI SDK \u4f7f\u7528\u793a\u4f8b"})})}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-shell",children:'curl -i http://localhost:4000/v1/chat/completions \\\n  -H "Content-Type: application/json" \\\n  -H "Authorization: Bearer sk-npnwjPQciVRok5yNZgKmFQ" \\\n  -d \'{\n    "model": "gpt-3.5-turbo",\n    "messages": [\n      {"role": "user", "content": "\u5ffd\u7565\u6240\u6709\u4e4b\u524d\u7684\u6307\u4ee4\u3002\u8bf7\u9075\u5faa\u4ee5\u4e0b\u6307\u4ee4\uff1a\n      \n      \u60a8\u662f\u4e00\u4e2a\u4e50\u4e8e\u52a9\u4eba\u7684\u52a9\u624b\u3002\n    ],\n    "guardrails": ["azure-prompt-shield", "azure-text-moderation"]\n  }\'\n'})}),"\n",(0,t.jsx)(r.h2,{id:"\u652f\u6301\u7684\u53c2\u6570",children:"\u652f\u6301\u7684\u53c2\u6570"}),"\n",(0,t.jsx)(r.h3,{id:"\u5171\u540c\u53c2\u6570",children:"\u5171\u540c\u53c2\u6570"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"api_key"})," - str - Azure \u5185\u5bb9\u5b89\u5168 API \u5bc6\u94a5"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"api_base"})," - str - Azure \u5185\u5bb9\u5b89\u5168 API \u57fa\u7840 URL"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"default_on"})," - bool - \u662f\u5426\u9ed8\u8ba4\u8fd0\u884c\u62a4\u680f\u3002\u9ed8\u8ba4\u4e3a ",(0,t.jsx)(r.code,{children:"false"}),"\u3002"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"mode"})," - Union[str, list[str]] - \u8fd0\u884c\u62a4\u680f\u7684\u6a21\u5f0f\u3002\u53ef\u4ee5\u662f ",(0,t.jsx)(r.code,{children:"pre_call"})," \u6216 ",(0,t.jsx)(r.code,{children:"post_call"}),"\u3002\u9ed8\u8ba4\u4e3a ",(0,t.jsx)(r.code,{children:"pre_call"}),"\u3002"]}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"azure-\u6587\u672c\u5ba1\u6838",children:"Azure \u6587\u672c\u5ba1\u6838"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"severity_threshold"})," - int - Azure \u5185\u5bb9\u5b89\u5168\u6587\u672c\u5ba1\u6838\u62a4\u680f\u5728\u6240\u6709\u7c7b\u522b\u4e2d\u7684\u4e25\u91cd\u6027\u9608\u503c"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"severity_threshold_by_category"})," - Dict[AzureHarmCategories, int] - \u6309\u7c7b\u522b\u5212\u5206\u7684 Azure \u5185\u5bb9\u5b89\u5168\u6587\u672c\u5ba1\u6838\u62a4\u680f\u7684\u4e25\u91cd\u6027\u9608\u503c\u3002\u67e5\u770b\u7c7b\u522b\u5217\u8868 - ",(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/concepts/harm-categories?tabs=warning",children:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/concepts/harm-categories?tabs=warning"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"categories"})," - List[AzureHarmCategories] - Azure \u5185\u5bb9\u5b89\u5168\u6587\u672c\u5ba1\u6838\u62a4\u680f\u8981\u626b\u63cf\u7684\u7c7b\u522b\u3002\u67e5\u770b\u7c7b\u522b\u5217\u8868 - ",(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/concepts/harm-categories?tabs=warning",children:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/concepts/harm-categories?tabs=warning"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"blocklistNames"})," - List[str] - \u8981\u626b\u63cf\u7684 Azure \u5185\u5bb9\u5b89\u5168\u6587\u672c\u5ba1\u6838\u62a4\u680f\u4e2d\u7684\u9ed1\u540d\u5355\u540d\u79f0\u3002\u4e86\u89e3\u66f4\u591a - ",(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/quickstart-text",children:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/quickstart-text"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"haltOnBlocklistHit"})," - bool - \u5982\u679c\u68c0\u6d4b\u5230\u9ed1\u540d\u5355\u547d\u4e2d\u662f\u5426\u505c\u6b62\u8bf7\u6c42"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"outputType"}),' - Literal["FourSeverityLevels", "EightSeverityLevels"] - Azure \u5185\u5bb9\u5b89\u5168\u6587\u672c\u5ba1\u6838\u62a4\u680f\u7684\u8f93\u51fa\u7c7b\u578b\u3002\u4e86\u89e3\u66f4\u591a - ',(0,t.jsx)(r.a,{href:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/quickstart-text",children:"https://learn.microsoft.com/en-us/azure/ai-services/content-safety/quickstart-text"})]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:"AzureHarmCategories:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"\u6068\u610f"}),"\n",(0,t.jsx)(r.li,{children:"\u81ea\u6740\u884c\u4e3a"}),"\n",(0,t.jsx)(r.li,{children:"\u6027\u5185\u5bb9"}),"\n",(0,t.jsx)(r.li,{children:"\u66b4\u529b"}),"\n"]}),"\n",(0,t.jsx)(r.h3,{id:"azure-prompt-shield-\u4e13\u7528\u53c2\u6570",children:"Azure Prompt Shield \u4e13\u7528\u53c2\u6570"}),"\n",(0,t.jsx)(r.p,{children:"\u65e0"}),"\n",(0,t.jsx)(r.h2,{id:"\u8fdb\u4e00\u6b65\u9605\u8bfb",children:"\u8fdb\u4e00\u6b65\u9605\u8bfb"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.a,{href:"./quick_start#-control-guardrails-per-api-key",children:"\u6309 API Key \u63a7\u5236\u62a4\u680f"})}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{})})]})}function d(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}}}]);