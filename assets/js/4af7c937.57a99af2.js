"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[19097],{28453(e,n,i){i.d(n,{R:()=>r,x:()=>o});var t=i(96540);const l={},s=t.createContext(l);function r(e){const n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),t.createElement(s.Provider,{value:n},e.children)}},59396(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>r,metadata:()=>t,toc:()=>a});const t=JSON.parse('{"id":"proxy/managed_finetuning","title":"\u2728 [BETA] LiteLLM \u7ba1\u7406\u6587\u4ef6\u4e0e\u5fae\u8c03","description":"\u8fd9\u662f\u4e00\u4e2a\u514d\u8d39\u7684 LiteLLM \u4f01\u4e1a\u529f\u80fd\u3002","source":"@site/docs/proxy/managed_finetuning.md","sourceDirName":"proxy","slug":"/proxy/managed_finetuning","permalink":"/docs/proxy/managed_finetuning","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"/fine_tuning","permalink":"/docs/fine_tuning"},"next":{"title":"/generateContent","permalink":"/docs/generateContent"}}');var l=i(74848),s=i(28453);const r={},o="\u2728 [BETA] LiteLLM \u7ba1\u7406\u6587\u4ef6\u4e0e\u5fae\u8c03",d={},a=[{value:"\u6982\u89c8",id:"\u6982\u89c8",level:2},{value:"(\u4ee3\u7406\u7ba1\u7406\u5458) \u4f7f\u7528\u65b9\u6cd5",id:"\u4ee3\u7406\u7ba1\u7406\u5458-\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"1. \u914d\u7f6e config.yaml",id:"1-\u914d\u7f6e-configyaml",level:3},{value:"2. \u521b\u5efa\u865a\u62df\u5bc6\u94a5",id:"2-\u521b\u5efa\u865a\u62df\u5bc6\u94a5",level:3},{value:"(\u5f00\u53d1\u8005) \u4f7f\u7528\u65b9\u6cd5",id:"\u5f00\u53d1\u8005-\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"1. \u521b\u5efa request.jsonl",id:"1-\u521b\u5efa-requestjsonl",level:3},{value:"2. \u4e0a\u4f20\u6587\u4ef6",id:"2-\u4e0a\u4f20\u6587\u4ef6",level:3},{value:"3. \u521b\u5efa\u5fae\u8c03\u4f5c\u4e1a",id:"3-\u521b\u5efa\u5fae\u8c03\u4f5c\u4e1a",level:3},{value:"4. \u83b7\u53d6\u5fae\u8c03\u4f5c\u4e1a",id:"4-\u83b7\u53d6\u5fae\u8c03\u4f5c\u4e1a",level:3},{value:"5. \u5217\u51fa\u5fae\u8c03\u4f5c\u4e1a",id:"5-\u5217\u51fa\u5fae\u8c03\u4f5c\u4e1a",level:3},{value:"6. \u53d6\u6d88\u4e00\u4e2a\u5fae\u8c03\u4f5c\u4e1a",id:"6-\u53d6\u6d88\u4e00\u4e2a\u5fae\u8c03\u4f5c\u4e1a",level:3},{value:"\u5b8c\u6574\u793a\u4f8b",id:"\u5b8c\u6574\u793a\u4f8b",level:2},{value:"\u5e38\u89c1\u95ee\u9898",id:"\u5e38\u89c1\u95ee\u9898",level:2},{value:"\u6211\u7684\u6587\u4ef6\u5199\u5728\u54ea\u91cc\uff1f",id:"\u6211\u7684\u6587\u4ef6\u5199\u5728\u54ea\u91cc",level:3}];function c(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"-beta-litellm-\u7ba1\u7406\u6587\u4ef6\u4e0e\u5fae\u8c03",children:"\u2728 [BETA] LiteLLM \u7ba1\u7406\u6587\u4ef6\u4e0e\u5fae\u8c03"})}),"\n",(0,l.jsxs)(n.admonition,{type:"info",children:[(0,l.jsx)(n.p,{children:"\u8fd9\u662f\u4e00\u4e2a\u514d\u8d39\u7684 LiteLLM \u4f01\u4e1a\u529f\u80fd\u3002"}),(0,l.jsxs)(n.p,{children:["\u53ef\u901a\u8fc7 ",(0,l.jsx)(n.code,{children:"litellm[proxy]"})," \u5305\u6216\u4efb\u4f55 ",(0,l.jsx)(n.code,{children:"litellm"})," Docker \u955c\u50cf\u8bbf\u95ee\u3002"]})]}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"\u5c5e\u6027"}),(0,l.jsx)(n.th,{children:"\u503c"}),(0,l.jsx)(n.th,{children:"\u5907\u6ce8"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u4ee3\u7406"}),(0,l.jsx)(n.td,{children:"\u2705"}),(0,l.jsx)(n.td,{})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"SDK"}),(0,l.jsx)(n.td,{children:"\u274c"}),(0,l.jsx)(n.td,{children:"\u9700\u8981\u4f7f\u7528 postgres \u6570\u636e\u5e93\u5b58\u50a8\u6587\u4ef6 ID\u3002"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsxs)(n.td,{children:["\u5728\u6240\u6709 ",(0,l.jsx)(n.a,{href:"../batches#%E6%94%AF%E6%8C%81%E7%9A%84%E6%8F%90%E4%BE%9B%E8%80%85",children:"\u6279\u5904\u7406\u63d0\u4f9b\u8005"})," \u4e2d\u53ef\u7528"]}),(0,l.jsx)(n.td,{children:"\u2705"}),(0,l.jsx)(n.td,{})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"\u652f\u6301\u7684\u7aef\u70b9"}),(0,l.jsx)(n.td,{children:(0,l.jsx)(n.code,{children:"/fine_tuning/jobs"})}),(0,l.jsx)(n.td,{})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"\u6982\u89c8",children:"\u6982\u89c8"}),"\n",(0,l.jsx)(n.p,{children:"\u4f7f\u7528\u6b64\u529f\u80fd\u53ef\u4ee5\uff1a"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5728 OpenAI/Azure/Vertex AI \u4e2d\u521b\u5efa\u7b26\u5408 OpenAI \u683c\u5f0f\u7684\u5fae\u8c03\u4f5c\u4e1a\uff08\u65e0\u9700\u989d\u5916\u7684 ",(0,l.jsx)(n.code,{children:"custom_llm_provider"})," \u53c2\u6570\uff09\u3002"]}),"\n",(0,l.jsx)(n.li,{children:"\u901a\u8fc7\u5bc6\u94a5/\u7528\u6237/\u56e2\u961f\u63a7\u5236\u5fae\u8c03\u6a21\u578b\u8bbf\u95ee\u6743\u9650\uff08\u4e0e\u804a\u5929\u8865\u5168\u6a21\u578b\u76f8\u540c\uff09"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"\u4ee3\u7406\u7ba1\u7406\u5458-\u4f7f\u7528\u65b9\u6cd5",children:"(\u4ee3\u7406\u7ba1\u7406\u5458) \u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u662f\u7ed9\u5f00\u53d1\u4eba\u5458\u63d0\u4f9b\u5bf9\u60a8\u7684\u5fae\u8c03\u6a21\u578b\u8bbf\u95ee\u6743\u9650\u7684\u65b9\u6cd5\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u914d\u7f6e-configyaml",children:"1. \u914d\u7f6e config.yaml"}),"\n",(0,l.jsxs)(n.p,{children:["\u5c06 ",(0,l.jsx)(n.code,{children:"/fine_tuning"})," \u5305\u542b\u5728 ",(0,l.jsx)(n.code,{children:"supported_endpoints"})," \u5217\u8868\u4e2d\u3002\u544a\u8bc9\u5f00\u53d1\u8005\u6b64\u6a21\u578b\u652f\u6301 ",(0,l.jsx)(n.code,{children:"/fine_tuning"})," \u7aef\u70b9\u3002"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",metastring:'showLineNumbers title="litellm_config.yaml"',children:'model_list:\n  - model_name: "gpt-4.1-openai"\n    litellm_params:\n      model: gpt-4.1\n      api_key: os.environ/OPENAI_API_KEY\n    model_info:\n      supported_endpoints: ["/chat/completions", "/fine_tuning"]\n'})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u521b\u5efa\u865a\u62df\u5bc6\u94a5",children:"2. \u521b\u5efa\u865a\u62df\u5bc6\u94a5"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",metastring:'showLineNumbers title="create_virtual_key.sh"',children:"curl -L -X POST 'https://{PROXY_BASE_URL}/key/generate' \\\n-H 'Authorization: Bearer ${PROXY_API_KEY}' \\\n-H 'Content-Type: application/json' \\\n-d '{\"models\": [\"gpt-4.1-openai\"]}'\n"})}),"\n",(0,l.jsx)(n.p,{children:"\u73b0\u5728\u53ef\u4ee5\u4f7f\u7528\u865a\u62df\u5bc6\u94a5\u8bbf\u95ee\u5fae\u8c03\u6a21\u578b\uff08\u53c2\u89c1\u5f00\u53d1\u4eba\u5458\u6d41\u7a0b\uff09\u3002"}),"\n",(0,l.jsx)(n.h2,{id:"\u5f00\u53d1\u8005-\u4f7f\u7528\u65b9\u6cd5",children:"(\u5f00\u53d1\u8005) \u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,l.jsx)(n.p,{children:"\u8fd9\u91cc\u662f\u521b\u5efa LiteLLM \u7ba1\u7406\u6587\u4ef6\u5e76\u6267\u884c\u4e0e\u6587\u4ef6\u76f8\u5173\u7684\u5fae\u8c03 CRUD \u64cd\u4f5c\u7684\u65b9\u6cd5\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"1-\u521b\u5efa-requestjsonl",children:"1. \u521b\u5efa request.jsonl"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-json",metastring:'showLineNumbers title="request.jsonl"',children:'{"messages": [{"role": "system", "content": "Clippy \u662f\u4e00\u4e2a\u4e8b\u5b9e\u6027\u804a\u5929\u673a\u5668\u4eba\uff0c\u540c\u65f6\u4e5f\u5e26\u6709\u4e00\u4e1d\u8bbd\u523a\u610f\u5473\u3002"}, {"role": "user", "content": "\u6cd5\u56fd\u7684\u9996\u90fd\u662f\u54ea\u91cc\uff1f"}, {"role": "assistant", "\u5185\u5bb9": "\u5df4\u9ece\uff0c\u597d\u50cf\u6bcf\u4e2a\u4eba\u90fd\u77e5\u9053\u8fd9\u4e00\u70b9\u3002"}]}\n{"messages": [{"role": "system", "content": "Clippy \u662f\u4e00\u4e2a\u4e8b\u5b9e\u6027\u804a\u5929\u673a\u5668\u4eba\uff0c\u540c\u65f6\u4e5f\u5e26\u6709\u4e00\u4e1d\u8bbd\u523a\u610f\u5473\u3002"}, {"role": "user", "content": "\u300a\u7f57\u5bc6\u6b27\u4e0e\u6731\u4e3d\u53f6\u300b\u662f\u8c01\u5199\u7684\uff1f"}, {"role": "assistant", "\u5185\u5bb9": "\u54e6\uff0c\u53ea\u662f\u4e00\u4e2a\u540d\u53eb\u5a01\u5ec9\xb7\u838e\u58eb\u6bd4\u4e9a\u7684\u5bb6\u4f19\u3002\u4f60\u542c\u8bf4\u8fc7\u4ed6\u5417\uff1f"}]}\n'})}),"\n",(0,l.jsx)(n.h3,{id:"2-\u4e0a\u4f20\u6587\u4ef6",children:"2. \u4e0a\u4f20\u6587\u4ef6"}),"\n",(0,l.jsxs)(n.p,{children:["\u6307\u5b9a ",(0,l.jsx)(n.code,{children:'target_model_names: "<model-name>"'})," \u4ee5\u542f\u7528 LiteLLM \u7ba1\u7406\u6587\u4ef6\u5e76\u8bf7\u6c42\u9a8c\u8bc1\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"model-name \u5e94\u4e0e request.jsonl \u4e2d\u7684 model-name \u76f8\u540c\u3002"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",metastring:'showLineNumbers title="create_finetuning_job.py"',children:'from openai import OpenAI\n\nclient = OpenAI(\n    base_url="http://0.0.0.0:4000",\n    api_key="sk-1234",\n)\n\n# \u4e0a\u4f20\u6587\u4ef6\nfinetuning_input_file = client.files.create(\n    file=open("./request.jsonl", "rb"),\n    purpose="fine-tune",\n    extra_body={"target_model_names": "gpt-4.1-openai"}\n)\nprint(finetuning_input_file)\n\n'})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"\u6587\u4ef6\u5199\u5165\u4f4d\u7f6e\u5728\u54ea\u91cc\uff1f"})}),"\n",(0,l.jsx)(n.p,{children:"\u6240\u6709 gpt-4.1-openai \u90e8\u7f72\u90fd\u5c06\u88ab\u5199\u5165\u3002\u8fd9\u5728\u7b2c 3 \u6b65\u521b\u5efa\u4f5c\u4e1a\u65f6\u542f\u7528\u8de8\u6240\u6709 gpt-4.1-openai \u90e8\u7f72\u7684\u8d1f\u8f7d\u5747\u8861\u3002\u4e00\u65e6\u521b\u5efa\u4e86\u4f5c\u4e1a\uff0c\u4efb\u4f55\u68c0\u7d22/\u5217\u8868/\u53d6\u6d88\u64cd\u4f5c\u5c06\u8def\u7531\u5230\u8be5\u90e8\u7f72\u3002"}),"\n",(0,l.jsx)(n.h3,{id:"3-\u521b\u5efa\u5fae\u8c03\u4f5c\u4e1a",children:"3. \u521b\u5efa\u5fae\u8c03\u4f5c\u4e1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",metastring:'showLineNumbers title="create_finetuning_job.py"',children:'... # \u7b2c2\u6b65\nfile_id = finetuning_input_file.id\n\n# \u521b\u5efa\u5fae\u8c03\u4f5c\u4e1a\nft_job = client.fine_tuning.jobs.create(\n    model="gpt-4.1-openai",  # \u60a8\u8981\u5fae\u8c03\u7684 LiteLLM \u516c\u5171\u6a21\u578b\u540d\u79f0                  \n    training_file=file_id,\n)\n'})}),"\n",(0,l.jsx)(n.h3,{id:"4-\u83b7\u53d6\u5fae\u8c03\u4f5c\u4e1a",children:"4. \u83b7\u53d6\u5fae\u8c03\u4f5c\u4e1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",metastring:'showLineNumbers title="create_finetuning_job.py"',children:"... # \u7b2c3\u6b65\nresponse = client.fine_tuning.jobs.retrieve(ft_job.id)\nprint(response)\n"})}),"\n",(0,l.jsx)(n.h3,{id:"5-\u5217\u51fa\u5fae\u8c03\u4f5c\u4e1a",children:"5. \u5217\u51fa\u5fae\u8c03\u4f5c\u4e1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",metastring:'showLineNumbers title="create_finetuning_job.py"',children:'...\n\nclient.fine_tuning.jobs.list(extra_body={"target_model_names": "gpt-4.1-openai"})\n'})}),"\n",(0,l.jsx)(n.h3,{id:"6-\u53d6\u6d88\u4e00\u4e2a\u5fae\u8c03\u4f5c\u4e1a",children:"6. \u53d6\u6d88\u4e00\u4e2a\u5fae\u8c03\u4f5c\u4e1a"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",metastring:'showLineNumbers title="create_finetuning_job.py"',children:"...\n\ncancel_ft_job = client.fine_tuning.jobs.cancel(\n    fine_tuning_job_id=ft_job.id,                          # \u5fae\u8c03\u4f5c\u4e1a ID\n)\n"})}),"\n",(0,l.jsx)(n.h2,{id:"\u5b8c\u6574\u793a\u4f8b",children:"\u5b8c\u6574\u793a\u4f8b"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-python",metastring:'showLineNumbers title="create_finetuning_job.py"',children:'from openai import OpenAI\n\nclient = OpenAI(\n    base_url="http://0.0.0.0:4000",\n    api_key="sk-...",\n    max_retries=0\n)\n\n\n# \u4e0a\u4f20\u6587\u4ef6\nfinetuning_input_file = client.files.create(\n    file=open("./fine_tuning.jsonl", "rb"), # {"model": "azure-gpt-4o"} <-> {"model": "gpt-4o-my-special-deployment"}\n    purpose="fine-tune",\n    extra_body={"target_model_names": "gpt-4.1-openai"} # \ud83d\udc48 \u544a\u8bc9 litellm \u5728\u54ea\u4e9b\u533a\u57df/\u9879\u76ee\u4e2d\u5199\u5165\u6587\u4ef6\u3002\n)\nprint(finetuning_input_file) # file.id = "litellm_proxy/..." = {"model_name": {"deployment_id": "deployment_file_id"}}\n\nfile_id = finetuning_input_file.id\n# # file_id = "bGl0ZWxs..."\n\n# ## \u521b\u5efa\u5fae\u8c03\u4f5c\u4e1a \nft_job = client.fine_tuning.jobs.create(\n    model="gpt-4.1-openai",  # \u60a8\u8981\u5fae\u8c03\u7684 LiteLLM \u6a21\u578b\u540d\u79f0                  \n    training_file=file_id,\n)\n\nprint(f"ft_job: {ft_job}")\n\nft_job_id = ft_job.id\n## \u53d6\u6d88\u5fae\u8c03\u4f5c\u4e1a \ncancel_ft_job = client.fine_tuning.jobs.cancel(\n    fine_tuning_job_id=ft_job_id,                          # \u5fae\u8c03\u4f5c\u4e1a ID\n)\n\nprint("response from cancel ft job={}".format(cancel_ft_job))\n# \u5217\u51fa\u5fae\u8c03\u4f5c\u4e1a \nlist_ft_jobs = client.fine_tuning.jobs.list(\n    extra_query={"target_model_names": "gpt-4.1-openai"}   # \u544a\u8bc9 litellm \u4ee3\u7406\u4f7f\u7528\u54ea\u4e2a\u63d0\u4f9b\u8005\n)\n\nprint("\u5fae\u8c03\u4f5c\u4e1a\u5217\u8868={}".format(list_ft_jobs))\n\n# \u83b7\u53d6\u5fae\u8c03\u4f5c\u4e1a \nresponse = client.fine_tuning.jobs.retrieve(ft_job.id)\nprint(response)\n'})}),"\n",(0,l.jsx)(n.h2,{id:"\u5e38\u89c1\u95ee\u9898",children:"\u5e38\u89c1\u95ee\u9898"}),"\n",(0,l.jsx)(n.h3,{id:"\u6211\u7684\u6587\u4ef6\u5199\u5728\u54ea\u91cc",children:"\u6211\u7684\u6587\u4ef6\u5199\u5728\u54ea\u91cc\uff1f"}),"\n",(0,l.jsxs)(n.p,{children:["\u5f53\u6307\u5b9a\u4e86 ",(0,l.jsx)(n.code,{children:"target_model_names"})," \u65f6\uff0c\u6587\u4ef6\u5c06\u88ab\u5199\u5165\u5339\u914d ",(0,l.jsx)(n.code,{children:"target_model_names"})," \u7684\u6240\u6709\u90e8\u7f72\u4e2d\u3002"]}),"\n",(0,l.jsx)(n.p,{children:"\u65e0\u9700\u989d\u5916\u7684\u57fa\u7840\u67b6\u6784\u3002"})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(c,{...e})}):c(e)}}}]);