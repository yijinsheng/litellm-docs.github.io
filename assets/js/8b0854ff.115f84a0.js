(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[95150],{7227(e,t,n){"use strict";n.d(t,{A:()=>l});n(96540);var s=n(18215);const r="tabItem_Ymn6";var a=n(74848);function l({children:e,hidden:t,className:n}){return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(r,n),hidden:t,children:e})}},36425(e,t,n){"use strict";n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>c,default:()=>m,frontMatter:()=>u,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"proxy/customers","title":"Customers / End-User Budgets","description":"Track spend, set budgets for your customers.","source":"@site/docs/proxy/customers.md","sourceDirName":"proxy","slug":"/proxy/customers","permalink":"/docs/proxy/customers","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"\u8bbe\u7f6e\u6807\u7b7e\u9884\u7b97","permalink":"/docs/proxy/tag_budgets"},"next":{"title":"\u5ba2\u6237\u4f7f\u7528\u60c5\u51b5","permalink":"/docs/proxy/customer_usage"}}');var r=n(74848),a=n(28453),l=n(90547),i=n(49489),o=n(7227);const u={},c="Customers / End-User Budgets",d={},h=[{value:"Tracking Customer Spend",id:"tracking-customer-spend",level:2},{value:"1. Make LLM API call w/ Customer ID",id:"1-make-llm-api-call-w-customer-id",level:3},{value:"2. Get Customer Spend",id:"2-get-customer-spend",level:3},{value:"Setting Customer Budgets",id:"setting-customer-budgets",level:2},{value:"Default Budget for All Customers",id:"default-budget-for-all-customers",level:3},{value:"Quick Start",id:"quick-start",level:3},{value:"Assign Pricing Tiers",id:"assign-pricing-tiers",level:3},{value:"1. Create a budget",id:"1-create-a-budget",level:4},{value:"2. Assign Budget to Customer",id:"2-assign-budget-to-customer",level:4},{value:"3. Test it!",id:"3-test-it",level:4}];function p(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"customers--end-user-budgets",children:"Customers / End-User Budgets"})}),"\n",(0,r.jsx)(t.p,{children:"Track spend, set budgets for your customers."}),"\n",(0,r.jsx)(t.h2,{id:"tracking-customer-spend",children:"Tracking Customer Spend"}),"\n",(0,r.jsx)(t.h3,{id:"1-make-llm-api-call-w-customer-id",children:"1. Make LLM API call w/ Customer ID"}),"\n",(0,r.jsx)(t.p,{children:"Make a /chat/completions call, pass 'user' - First call Works"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Make request with customer ID"',children:'curl -X POST \'http://0.0.0.0:4000/chat/completions\' \\\n        --header \'Content-Type: application/json\' \\\n        --header \'Authorization: Bearer sk-1234\' \\ # \ud83d\udc48 YOUR PROXY KEY\n        --data \' {\n        "model": "azure-gpt-3.5",\n        "user": "ishaan3", # \ud83d\udc48 CUSTOMER ID\n        "messages": [\n            {\n            "role": "user",\n            "content": "what time is it"\n            }\n        ]\n        }\'\n'})}),"\n",(0,r.jsx)(t.p,{children:"The customer_id will be upserted into the DB with the new spend."}),"\n",(0,r.jsx)(t.p,{children:"If the customer_id already exists, spend will be incremented."}),"\n",(0,r.jsx)(t.h3,{id:"2-get-customer-spend",children:"2. Get Customer Spend"}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsxs)(o.A,{value:"all-up",label:"All-up spend",children:[(0,r.jsxs)(t.p,{children:["Call ",(0,r.jsx)(t.code,{children:"/customer/info"})," to get a customer's all up spend"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Get customer spend"',children:"curl -X GET 'http://0.0.0.0:4000/customer/info?end_user_id=ishaan3' \\ # \ud83d\udc48 CUSTOMER ID\n        -H 'Authorization: Bearer sk-1234' \\ # \ud83d\udc48 YOUR PROXY KEY\n"})}),(0,r.jsx)(t.p,{children:"Expected Response:"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",metastring:'showLineNumbers title="Response"',children:'{\n    "user_id": "ishaan3",\n    "blocked": false,\n    "alias": null,\n    "spend": 0.001413,\n    "allowed_model_region": null,\n    "default_model": null,\n    "litellm_budget_table": null\n}\n'})})]}),(0,r.jsxs)(o.A,{value:"event-webhook",label:"Event Webhook",children:[(0,r.jsx)(t.p,{children:"To update spend in your client-side DB, point the proxy to your webhook."}),(0,r.jsxs)(t.p,{children:["E.g. if your server is ",(0,r.jsx)(t.code,{children:"https://webhook.site"})," and your listening on ",(0,r.jsx)(t.code,{children:"6ab090e8-c55f-4a23-b075-3209f5c57906"})]}),(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Add webhook url to your proxy environment:"}),"\n"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Set webhook URL"',children:'export WEBHOOK_URL="https://webhook.site/6ab090e8-c55f-4a23-b075-3209f5c57906"\n'})}),(0,r.jsxs)(t.ol,{start:"2",children:["\n",(0,r.jsx)(t.li,{children:"Add 'webhook' to config.yaml"}),"\n"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'showLineNumbers title="config.yaml"',children:'general_settings: \n  alerting: ["webhook"] # \ud83d\udc48 KEY CHANGE\n'})}),(0,r.jsxs)(t.ol,{start:"3",children:["\n",(0,r.jsx)(t.li,{children:"Test it!"}),"\n"]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Test webhook"',children:'curl -X POST \'http://localhost:4000/chat/completions\' \\\n-H \'Content-Type: application/json\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-D \'{\n    "model": "mistral",\n    "messages": [\n        {\n        "role": "user",\n        "content": "What\'s the weather like in Boston today?"\n        }\n    ],\n    "user": "krrish12"\n}\n\'\n'})}),(0,r.jsx)(t.p,{children:"Expected Response"}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",metastring:'showLineNumbers title="Webhook event payload"',children:'{\n  "spend": 0.0011120000000000001, # \ud83d\udc48 SPEND\n  "max_budget": null,\n  "token": "example-api-key-123",\n  "customer_id": "krrish12",  # \ud83d\udc48 CUSTOMER ID\n  "user_id": null,\n  "team_id": null,\n  "user_email": null,\n  "key_alias": null,\n  "projected_exceeded_date": null,\n  "projected_spend": null,\n  "event": "spend_tracked",\n  "event_group": "customer",\n  "event_message": "Customer spend tracked. Customer=krrish12, spend=0.0011120000000000001"\n}\n'})}),(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"/docs/proxy/alerting#api-spec-for-webhook-event",children:"See Webhook Spec"})})]})]}),"\n",(0,r.jsx)(t.h2,{id:"setting-customer-budgets",children:"Setting Customer Budgets"}),"\n",(0,r.jsx)(t.p,{children:"Set customer budgets (e.g. monthly budgets, tpm/rpm limits) on LiteLLM Proxy"}),"\n",(0,r.jsx)(t.h3,{id:"default-budget-for-all-customers",children:"Default Budget for All Customers"}),"\n",(0,r.jsx)(t.p,{children:"Apply budget limits to all customers without explicit budgets. This is useful for rate limiting and spending controls across all end users."}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Step 1: Create a default budget"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Create default budget"',children:"curl -X POST 'http://localhost:4000/budget/new' \\\n-H 'Content-Type: application/json' \\\n-H 'Authorization: Bearer sk-1234' \\\n-d '{\n    \"max_budget\": 10,\n    \"rpm_limit\": 2,\n    \"tpm_limit\": 1000\n}'\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Step 2: Configure the default budget ID"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-yaml",metastring:'showLineNumbers title="config.yaml"',children:'litellm_settings:\n  max_end_user_budget_id: "budget_id_from_step_1"\n'})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Step 3: Test it"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Make request with customer ID"',children:'curl -X POST \'http://localhost:4000/chat/completions\' \\\n-H \'Content-Type: application/json\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-d \'{\n    "model": "gpt-3.5-turbo",\n    "messages": [{"role": "user", "content": "Hello"}],\n    "user": "my-customer-id"\n}\'\n'})}),"\n",(0,r.jsx)(t.p,{children:"The customer will be subject to the default budget limits (RPM, TPM, and $ budget). Customers with explicit budgets are unaffected."}),"\n",(0,r.jsx)(t.h3,{id:"quick-start",children:"Quick Start"}),"\n",(0,r.jsx)(t.p,{children:"Create / Update a customer with budget"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Create New Customer w/ budget"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Create customer with budget"',children:"curl -X POST 'http://0.0.0.0:4000/customer/new'         \n    -H 'Authorization: Bearer sk-1234'         \n    -H 'Content-Type: application/json'         \n    -d '{\n        \"user_id\" : \"my-customer-id\",\n        \"max_budget\": \"0\", # \ud83d\udc48 CAN BE FLOAT\n    }'\n"})}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.strong,{children:"Test it!"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Test customer budget"',children:'curl -X POST \'http://localhost:4000/chat/completions\' \\\n-H \'Content-Type: application/json\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-D \'{\n    "model": "mistral",\n    "messages": [\n        {\n        "role": "user",\n        "content": "What\'\\\'\'s the weather like in Boston today?"\n        }\n    ],\n    "user": "ishaan-jaff-48"\n}\n'})}),"\n",(0,r.jsx)(t.h3,{id:"assign-pricing-tiers",children:"Assign Pricing Tiers"}),"\n",(0,r.jsx)(t.p,{children:"Create and assign customers to pricing tiers."}),"\n",(0,r.jsx)(t.h4,{id:"1-create-a-budget",children:"1. Create a budget"}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsxs)(o.A,{value:"ui",label:"UI",children:[(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsx)(t.li,{children:"Go to the 'Budgets' tab on the UI."}),"\n",(0,r.jsx)(t.li,{children:"Click on '+ Create Budget'."}),"\n",(0,r.jsx)(t.li,{children:"Create your pricing tier (e.g. 'my-free-tier' with budget $4). This means each user on this pricing tier will have a max budget of $4."}),"\n"]}),(0,r.jsx)(l.A,{img:n(98494)})]}),(0,r.jsxs)(o.A,{value:"api",label:"API",children:[(0,r.jsxs)(t.p,{children:["Use the ",(0,r.jsx)(t.code,{children:"/budget/new"})," endpoint for creating a new budget. ",(0,r.jsx)(t.a,{href:"https://litellm-api.up.railway.app/#/budget%20management/new_budget_budget_new_post",children:"API Reference"})]}),(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Create budget via API"',children:"curl -X POST 'http://localhost:4000/budget/new' \\\n-H 'Content-Type: application/json' \\\n-H 'Authorization: Bearer sk-1234' \\\n-D '{\n    \"budget_id\": \"my-free-tier\", \n    \"max_budget\": 4 \n}\n"})})]})]}),"\n",(0,r.jsx)(t.h4,{id:"2-assign-budget-to-customer",children:"2. Assign Budget to Customer"}),"\n",(0,r.jsx)(t.p,{children:"In your application code, assign budget when creating a new customer."}),"\n",(0,r.jsxs)(t.p,{children:["Just use the ",(0,r.jsx)(t.code,{children:"budget_id"})," used when creating the budget. In our example, this is ",(0,r.jsx)(t.code,{children:"my-free-tier"}),"."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Assign budget to customer"',children:'curl -X POST \'http://localhost:4000/customer/new\' \\\n-H \'Content-Type: application/json\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-D \'{\n    "user_id": "my-customer-id",\n    "budget_id": "my-free-tier" # \ud83d\udc48 KEY CHANGE\n}\n'})}),"\n",(0,r.jsx)(t.h4,{id:"3-test-it",children:"3. Test it!"}),"\n",(0,r.jsxs)(i.A,{children:[(0,r.jsx)(o.A,{value:"curl",label:"curl",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-bash",metastring:'showLineNumbers title="Test with curl"',children:'curl -X POST \'http://localhost:4000/customer/new\' \\\n-H \'Content-Type: application/json\' \\\n-H \'Authorization: Bearer sk-1234\' \\\n-D \'{\n    "user_id": "my-customer-id",\n    "budget_id": "my-free-tier" # \ud83d\udc48 KEY CHANGE\n}\n'})})}),(0,r.jsx)(o.A,{value:"openai",label:"OpenAI",children:(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-python",metastring:'showLineNumbers title="Test with OpenAI SDK"',children:'from openai import OpenAI\nclient = OpenAI(\n  base_url="<your_proxy_base_url>",\n  api_key="<your_proxy_key>"\n)\n\ncompletion = client.chat.completions.create(\n  model="gpt-3.5-turbo",\n  messages=[\n    {"role": "system", "content": "You are a helpful assistant."},\n    {"role": "user", "content": "Hello!"}\n  ],\n  user="my-customer-id"\n)\n\nprint(completion.choices[0].message)\n'})})})]})]})}function m(e={}){const{wrapper:t}={...(0,a.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(p,{...e})}):p(e)}},49489(e,t,n){"use strict";n.d(t,{A:()=>v});var s=n(96540),r=n(18215),a=n(24245),l=n(56347),i=n(36494),o=n(62814),u=n(45167),c=n(69900);function d(e){return s.Children.toArray(e).filter(e=>"\n"!==e).map(e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)})?.filter(Boolean)??[]}function h(e){const{values:t,children:n}=e;return(0,s.useMemo)(()=>{const e=t??function(e){return d(e).map(({props:{value:e,label:t,attributes:n,default:s}})=>({value:e,label:t,attributes:n,default:s}))}(n);return function(e){const t=(0,u.XI)(e,(e,t)=>e.value===t.value);if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map(e=>e.value).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e},[t,n])}function p({value:e,tabValues:t}){return t.some(t=>t.value===e)}function m({queryString:e=!1,groupId:t}){const n=(0,l.W6)(),r=function({queryString:e=!1,groupId:t}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!t)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return t??null}({queryString:e,groupId:t});return[(0,o.aZ)(r),(0,s.useCallback)(e=>{if(!r)return;const t=new URLSearchParams(n.location.search);t.set(r,e),n.replace({...n.location,search:t.toString()})},[r,n])]}function g(e){const{defaultValue:t,queryString:n=!1,groupId:r}=e,a=h(e),[l,o]=(0,s.useState)(()=>function({defaultValue:e,tabValues:t}){if(0===t.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!p({value:e,tabValues:t}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${t.map(e=>e.value).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const n=t.find(e=>e.default)??t[0];if(!n)throw new Error("Unexpected error: 0 tabValues");return n.value}({defaultValue:t,tabValues:a})),[u,d]=m({queryString:n,groupId:r}),[g,b]=function({groupId:e}){const t=function(e){return e?`docusaurus.tab.${e}`:null}(e),[n,r]=(0,c.Dv)(t);return[n,(0,s.useCallback)(e=>{t&&r.set(e)},[t,r])]}({groupId:r}),x=(()=>{const e=u??g;return p({value:e,tabValues:a})?e:null})();(0,i.A)(()=>{x&&o(x)},[x]);return{selectedValue:l,selectValue:(0,s.useCallback)(e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),b(e)},[d,b,a]),tabValues:a}}var b=n(11062);const x="tabList__CuJ",j="tabItem_LNqP";var f=n(74848);function w({className:e,block:t,selectedValue:n,selectValue:s,tabValues:l}){const i=[],{blockElementScrollPositionUntilNextRender:o}=(0,a.a_)(),u=e=>{const t=e.currentTarget,r=i.indexOf(t),a=l[r].value;a!==n&&(o(t),s(a))},c=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const n=i.indexOf(e.currentTarget)+1;t=i[n]??i[0];break}case"ArrowLeft":{const n=i.indexOf(e.currentTarget)-1;t=i[n]??i[i.length-1];break}}t?.focus()};return(0,f.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,r.A)("tabs",{"tabs--block":t},e),children:l.map(({value:e,label:t,attributes:s})=>(0,f.jsx)("li",{role:"tab",tabIndex:n===e?0:-1,"aria-selected":n===e,ref:e=>{i.push(e)},onKeyDown:c,onClick:u,...s,className:(0,r.A)("tabs__item",j,s?.className,{"tabs__item--active":n===e}),children:t??e},e))})}function A({lazy:e,children:t,selectedValue:n}){const a=(Array.isArray(t)?t:[t]).filter(Boolean);if(e){const e=a.find(e=>e.props.value===n);return e?(0,s.cloneElement)(e,{className:(0,r.A)("margin-top--md",e.props.className)}):null}return(0,f.jsx)("div",{className:"margin-top--md",children:a.map((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==n}))})}function y(e){const t=g(e);return(0,f.jsxs)("div",{className:(0,r.A)("tabs-container",x),children:[(0,f.jsx)(w,{...t,...e}),(0,f.jsx)(A,{...t,...e})]})}function v(e){const t=(0,b.A)();return(0,f.jsx)(y,{...e,children:d(e.children)},String(t))}},98494(e,t,n){e.exports={src:Object.assign(Object.create({toString(){return this.src}}),{srcSet:n.p+"assets/ideal-img/create_budget_modal.0d6851c.640.png 640w,"+n.p+"assets/ideal-img/create_budget_modal.67b661f.1920.png 1920w",images:[{path:n.p+"assets/ideal-img/create_budget_modal.0d6851c.640.png",width:640,height:421},{path:n.p+"assets/ideal-img/create_budget_modal.67b661f.1920.png",width:1920,height:1263}],src:n.p+"assets/ideal-img/create_budget_modal.0d6851c.640.png",placeholder:void 0,width:640,height:421}),preSrc:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAYAAAAxrNxjAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA8ElEQVR4nF2NvWqEQBSF54lS5RmSIk2SBxArSy2yk0LYjYyQLIKFb2CTGH0EFYRsYYKNb5CF3cU/BEuzc2duGKuQCx8HPjjnEs/z7uI4fs6ybJ2m6ZMiz/Mli6JYh2H4whi7JUEQJE3ToJQSpJQopER1QggVUNc1uq4bke3We2/bVskfzjnM86wKIIQA5aqqQtu2Xwljm+RwPCAHAA6gclnlnC+LZVkipauIuO4mPp2OSp7Vx3+cvz5LfFw9vBHf95Pv/R6naYK+73EYhoWu63AcR9jtPtBxnIiYpnlhGMaNpmlXuq5f/0U5y7LuKaWXv3Bv1bY8PXexAAAAAElFTkSuQmCC"}}}]);