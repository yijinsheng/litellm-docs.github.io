"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[1705],{21824(e,n,t){t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>r,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"proxy/custom_auth","title":"\u81ea\u5b9a\u4e49\u8ba4\u8bc1","description":"\u73b0\u5728\u53ef\u4ee5\u8986\u76d6\u9ed8\u8ba4\u7684API\u5bc6\u94a5\u8ba4\u8bc1\u3002","source":"@site/docs/proxy/custom_auth.md","sourceDirName":"proxy","slug":"/proxy/custom_auth","permalink":"/docs/proxy/custom_auth","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"CLI \u8ba4\u8bc1","permalink":"/docs/proxy/cli_sso"},"next":{"title":"IP \u5730\u5740\u8fc7\u6ee4","permalink":"/docs/proxy/ip_address"}}');var s=t(74848),l=t(28453);const r={},a="\u81ea\u5b9a\u4e49\u8ba4\u8bc1",o={},d=[{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5",level:2},{value:"1. \u521b\u5efa\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u6587\u4ef6\u3002",id:"1-\u521b\u5efa\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u6587\u4ef6",level:4},{value:"UserAPIKeyAuth \u5b57\u6bb5\u53c2\u8003",id:"userapikeyauth-\u5b57\u6bb5\u53c2\u8003",level:2},{value:"\u6838\u5fc3\u8ba4\u8bc1\u5b57\u6bb5",id:"\u6838\u5fc3\u8ba4\u8bc1\u5b57\u6bb5",level:3},{value:"\u9884\u7b97\u548c\u652f\u51fa\u8ddf\u8e2a",id:"\u9884\u7b97\u548c\u652f\u51fa\u8ddf\u8e2a",level:3},{value:"\u6d41\u901f\u9650\u5236",id:"\u6d41\u901f\u9650\u5236",level:3},{value:"\u7ec8\u7aef\u7528\u6237\u8ddf\u8e2a",id:"\u7ec8\u7aef\u7528\u6237\u8ddf\u8e2a",level:3},{value:"\u6a21\u578b\u548c\u8def\u7531\u8bbf\u95ee\u63a7\u5236",id:"\u6a21\u578b\u548c\u8def\u7531\u8bbf\u95ee\u63a7\u5236",level:3},{value:"\u5bf9\u8c61\u6743\u9650\u793a\u4f8b\uff08MCP\u3001\u4ee3\u7406\u7b49\uff09",id:"\u5bf9\u8c61\u6743\u9650\u793a\u4f8bmcp\u4ee3\u7406\u7b49",level:3},{value:"\u9ad8\u7ea7\u914d\u7f6e",id:"\u9ad8\u7ea7\u914d\u7f6e",level:3},{value:"\u5b8c\u6574\u793a\u4f8b",id:"\u5b8c\u6574\u793a\u4f8b",level:3},{value:"2. \u4f20\u9012\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff08\u76f8\u5bf9\u4e8econfig.yaml\uff09",id:"2-\u4f20\u9012\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u76f8\u5bf9\u4e8econfigyaml",level:4},{value:"3. \u542f\u52a8\u4ee3\u7406",id:"3-\u542f\u52a8\u4ee3\u7406",level:4},{value:"\u2728 \u652f\u6301 LiteLLM \u865a\u62df\u5bc6\u94a5 + \u81ea\u5b9a\u4e49\u8ba4\u8bc1",id:"-\u652f\u6301-litellm-\u865a\u62df\u5bc6\u94a5--\u81ea\u5b9a\u4e49\u8ba4\u8bc1",level:2},{value:"\u4f7f\u7528\u65b9\u6cd5",id:"\u4f7f\u7528\u65b9\u6cd5-1",level:3},{value:"\u629b\u51fa\u81ea\u5b9a\u4e49\u5f02\u5e38",id:"\u629b\u51fa\u81ea\u5b9a\u4e49\u5f02\u5e38",level:4}];function m(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",mdxAdmonitionTitle:"mdxAdmonitionTitle",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"\u81ea\u5b9a\u4e49\u8ba4\u8bc1",children:"\u81ea\u5b9a\u4e49\u8ba4\u8bc1"})}),"\n",(0,s.jsx)(n.p,{children:"\u73b0\u5728\u53ef\u4ee5\u8986\u76d6\u9ed8\u8ba4\u7684API\u5bc6\u94a5\u8ba4\u8bc1\u3002"}),"\n",(0,s.jsx)(n.h2,{id:"\u4f7f\u7528\u65b9\u6cd5",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,s.jsx)(n.h4,{id:"1-\u521b\u5efa\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u6587\u4ef6",children:"1. \u521b\u5efa\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u6587\u4ef6\u3002"}),"\n",(0,s.jsxs)(n.p,{children:["\u786e\u4fdd\u54cd\u5e94\u7c7b\u578b\u9075\u5faa ",(0,s.jsx)(n.code,{children:"UserAPIKeyAuth"})," Pydantic \u5bf9\u8c61\u3002\u8fd9\u7528\u4e8e\u8bb0\u5f55\u4e0e\u8be5\u7528\u6237\u5bc6\u94a5\u76f8\u5173\u7684\u7279\u5b9a\u4f7f\u7528\u60c5\u51b5\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from fastapi import Request\nfrom litellm.proxy._types import UserAPIKeyAuth\n\nasync def user_api_key_auth(request: Request, api_key: str) -> UserAPIKeyAuth: \n    try: \n        modified_master_key = "sk-my-master-key"\n        if api_key == modified_master_key:\n            return UserAPIKeyAuth(api_key=api_key)\n        raise Exception\n    except: \n        raise Exception\n'})}),"\n",(0,s.jsx)(n.h2,{id:"userapikeyauth-\u5b57\u6bb5\u53c2\u8003",children:"UserAPIKeyAuth \u5b57\u6bb5\u53c2\u8003"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"UserAPIKeyAuth"})," \u5bf9\u8c61\u652f\u6301\u4ee5\u4e0b\u5b57\u6bb5\u4ee5\u8fdb\u884c\u5168\u9762\u7684\u8ba4\u8bc1\u914d\u7f6e\uff1a"]}),"\n",(0,s.jsx)(n.h3,{id:"\u6838\u5fc3\u8ba4\u8bc1\u5b57\u6bb5",children:"\u6838\u5fc3\u8ba4\u8bc1\u5b57\u6bb5"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"UserAPIKeyAuth(\n    # \u57fa\u672c\u8ba4\u8bc1\u5b57\u6bb5\n    api_key: Optional[str] = None,                    # API\u5bc6\u94a5\uff08\u5c06\u81ea\u52a8\u8fdb\u884c\u54c8\u5e0c\u5904\u7406\uff09\n    token: Optional[str] = None,                      # \u5185\u90e8\u4f7f\u7528\u7684\u54c8\u5e0c\u4ee4\u724c\n    key_name: Optional[str] = None,                   # \u4eba\u53ef\u8bfb\u7684\u952e\u540d\n    key_alias: Optional[str] = None,                  # \u7528\u4e8e\u8bc6\u522b\u7684\u5bc6\u94a5\u522b\u540d\n    \n    # \u7528\u6237\u6807\u8bc6\n    user_id: Optional[str] = None,                    # \u552f\u4e00\u7528\u6237\u6807\u8bc6\u7b26\n    user_email: Optional[str] = None,                 # \u7528\u6237\u7535\u5b50\u90ae\u4ef6\u5730\u5740\n    user_role: Optional[LitellmUserRoles] = None,     # \u7528\u6237\u89d2\u8272\uff08PROXY_ADMIN\u3001INTERNAL_USER\u7b49\uff09\n    \n    # \u56e2\u961f/\u7ec4\u7ec7\n    team_id: Optional[str] = None,                    # \u56e2\u961f\u6807\u8bc6\u7b26\n    team_alias: Optional[str] = None,                 # \u56e2\u961f\u663e\u793a\u540d\u79f0\n    org_id: Optional[str] = None,                     # \u7ec4\u7ec7\u6807\u8bc6\u7b26\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u9884\u7b97\u548c\u652f\u51fa\u8ddf\u8e2a",children:"\u9884\u7b97\u548c\u652f\u51fa\u8ddf\u8e2a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"UserAPIKeyAuth(\n    # \u7528\u6237\u9884\u7b97\n    max_budget: Optional[float] = None,               # \u5bc6\u94a5\u7684\u6700\u5927\u9884\u7b97\n    spend: float = 0.0,                              # \u5f53\u524d\u652f\u51fa\u91d1\u989d\n    soft_budget: Optional[float] = None,              # \u8f6f\u9884\u7b97\u9650\u5236\uff08\u8b66\u544a\uff09\n    model_max_budget: Dict = {},                      # \u6a21\u578b\u7684\u9884\u7b97\u9650\u5236\n    model_spend: Dict = {},                           # \u6a21\u578b\u7684\u652f\u51fa\u8ddf\u8e2a\n    \n    # \u56e2\u961f\u9884\u7b97\n    team_max_budget: Optional[float] = None,          # \u56e2\u961f\u7684\u6700\u5927\u9884\u7b97\n    team_spend: Optional[float] = None,               # \u56e2\u961f\u5f53\u524d\u652f\u51fa\n    team_member_spend: Optional[float] = None,        # \u8be5\u7528\u6237\u5728\u56e2\u961f\u4e2d\u7684\u652f\u51fa\n    \n    # \u9884\u7b97\u65f6\u95f4\n    budget_duration: Optional[str] = None,            # \u9884\u7b97\u91cd\u7f6e\u5468\u671f\n    budget_reset_at: Optional[datetime] = None,       # \u5f53\u9884\u7b97\u91cd\u7f6e\u65f6\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6d41\u901f\u9650\u5236",children:"\u6d41\u901f\u9650\u5236"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"UserAPIKeyAuth(\n    # \u7528\u6237\u9650\u6d41\n    tpm_limit: Optional[int] = None,                  # \u6bcf\u5206\u949f\u4ee4\u724c\u6570\u9650\u5236\n    rpm_limit: Optional[int] = None,                  # \u6bcf\u5206\u949f\u8bf7\u6c42\u6570\u9650\u5236\n    user_tpm_limit: Optional[int] = None,             # \u7528\u6237\u7279\u5b9a\u7684TPM\u9650\u5236\n    user_rpm_limit: Optional[int] = None,             # \u7528\u6237\u7279\u5b9a\u7684RPM\u9650\u5236\n    \n    # \u56e2\u961f\u9650\u6d41\n    team_tpm_limit: Optional[int] = None,             # \u56e2\u961fTPM\u9650\u5236\n    team_rpm_limit: Optional[int] = None,             # \u56e2\u961fRPM\u9650\u5236\n    team_member_tpm_limit: Optional[int] = None,      # \u6bcf\u4e2a\u6210\u5458\u7684TPM\u9650\u5236\n    team_member_rpm_limit: Optional[int] = None,      # \u6bcf\u4e2a\u6210\u5458\u7684RPM\u9650\u5236\n    \n    # \u6a21\u578b\u9650\u6d41\n    rpm_limit_per_model: Optional[Dict[str, int]] = None,  # \u6309\u6a21\u578b\u7684RPM\u9650\u5236\n    tpm_limit_per_model: Optional[Dict[str, int]] = None,  # \u6309\u6a21\u578b\u7684TPM\u9650\u5236\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u7ec8\u7aef\u7528\u6237\u8ddf\u8e2a",children:"\u7ec8\u7aef\u7528\u6237\u8ddf\u8e2a"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"UserAPIKeyAuth(\n    # \u7ec8\u7aef\u7528\u6237\u6807\u8bc6\u548c\u9650\u6d41\n    end_user_id: Optional[str] = None,                # \u7ec8\u7aef\u7528\u6237\u6807\u8bc6\u7b26\n    end_user_tpm_limit: Optional[int] = None,         # \u7ec8\u7aef\u7528\u6237\u7684TPM\u9650\u5236\n    end_user_rpm_limit: Optional[int] = None,         # \u7ec8\u7aef\u7528\u6237\u7684RPM\u9650\u5236\n    end_user_max_budget: Optional[float] = None,      # \u7ec8\u7aef\u7528\u6237\u9884\u7b97\u9650\u5236\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u6a21\u578b\u548c\u8def\u7531\u8bbf\u95ee\u63a7\u5236",children:"\u6a21\u578b\u548c\u8def\u7531\u8bbf\u95ee\u63a7\u5236"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"UserAPIKeyAuth(\n    # \u6a21\u578b\u8bbf\u95ee\u63a7\u5236\n    models: List = [],                                # \u5141\u8bb8\u7684\u6a21\u578b\u5217\u8868\n    team_models: List = [],                           # \u56e2\u961f\u5141\u8bb8\u7684\u6a21\u578b\n    aliases: Dict = {},                               # \u6a21\u578b\u522b\u540d\n    \n    # \u8def\u7531\u6743\u9650\n    allowed_routes: Optional[list] = [],              # \u5141\u8bb8\u7684API\u8def\u7531\n    allowed_cache_controls: Optional[list] = [],      # \u7f13\u5b58\u63a7\u5236\u6743\u9650\n    permissions: Dict = {},                           # \u901a\u7528\u6743\u9650\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5bf9\u8c61\u6743\u9650\u793a\u4f8bmcp\u4ee3\u7406\u7b49",children:"\u5bf9\u8c61\u6743\u9650\u793a\u4f8b\uff08MCP\u3001\u4ee3\u7406\u7b49\uff09"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from litellm.proxy._experimental.mcp_server.mcp_server_manager import (\n    global_mcp_server_manager,\n)\n\ndef _server_id(name: str) -> str:\n    server = global_mcp_server_manager.get_mcp_server_by_name(name)\n    if not server:\n        raise ValueError(f"\u672a\u77e5\u7684MCP\u670d\u52a1\u5668\'{name}\'")\n    return server.server_id\n\nobject_permission = LiteLLM_ObjectPermissionTable(\n    mcp_servers=[_server_id("deepwiki"), _server_id("everything")], # \u8be5\u5bc6\u94a5\u5141\u8bb8\u4f7f\u7528\u7684MCP\u670d\u52a1\u5668\n    mcp_tool_permissions={"deepwiki": ["search", "read_doc"]},      # \u6bcf\u4e2a\u670d\u52a1\u5668\u7684\u5de5\u5177\u6743\u9650\u5217\u8868\uff08\u53ef\u9009\uff09\n)\n\nUserAPIKeyAuth(\n    object_permission=object_permission,\n)\n'})}),"\n",(0,s.jsx)(n.h3,{id:"\u9ad8\u7ea7\u914d\u7f6e",children:"\u9ad8\u7ea7\u914d\u7f6e"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:"UserAPIKeyAuth(\n    # \u8bf7\u6c42\u5904\u7406\n    max_parallel_requests: Optional[int] = None,      # \u5e76\u53d1\u8bf7\u6c42\u6570\u9650\u5236\n    allowed_model_region: Optional[AllowedModelRegion] = None,  # \u5730\u7406\u4f4d\u7f6e\u9650\u5236\n    \n    # \u8fc7\u671f\u548c\u72b6\u6001\n    expires: Optional[Union[str, datetime]] = None,   # \u5bc6\u94a5\u8fc7\u671f\u65f6\u95f4\n    blocked: Optional[bool] = None,                   # \u662f\u5426\u88ab\u5c01\u9501\n    \n    # \u5143\u6570\u636e\u548c\u914d\u7f6e\n    metadata: Dict = {},                              # \u81ea\u5b9a\u4e49\u5143\u6570\u636e\n    config: Dict = {},                               # \u914d\u7f6e\u8bbe\u7f6e\n    team_metadata: Optional[Dict] = None,             # \u56e2\u961f\u5143\u6570\u636e\n    \n    # \u5185\u90e8\u8ddf\u8e2a\n    request_route: Optional[str] = None,              # \u5f53\u524d\u8bf7\u6c42\u8def\u7531\n    last_refreshed_at: Optional[float] = None,        # \u7f13\u5b58\u5237\u65b0\u65f6\u95f4\u6233\n)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"\u5b8c\u6574\u793a\u4f8b",children:"\u5b8c\u6574\u793a\u4f8b"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'from fastapi import Request\nfrom datetime import datetime, timedelta\nfrom litellm.proxy._types import UserAPIKeyAuth, LitellmUserRoles\n\nasync def user_api_key_auth(request: Request, api_key: str) -> UserAPIKeyAuth:\n    try:\n        # \u793a\u4f8b\uff1a\u5168\u9762\u7684\u8ba4\u8bc1\u914d\u7f6e\n        if api_key.startswith("sk-admin-"):\n            return UserAPIKeyAuth(\n                api_key=api_key,\n                user_id="admin_user_123",\n                user_email="admin@company.com",\n                user_role=LitellmUserRoles.PROXY_ADMIN,\n                team_id="admin_team",\n                team_alias="Administrative Team",\n                max_budget=1000.0,\n                soft_budget=800.0,\n                tpm_limit=10000,\n                rpm_limit=100,\n                models=["gpt-4", "claude-3-sonnet", "gpt-3.5-turbo"],\n                allowed_routes=["/chat/completions", "/embeddings"],\n                expires=datetime.now() + timedelta(days=30),\n                metadata={"department": "engineering", "cost_center": "ai_ops"}\n            )\n        elif api_key.startswith("sk-team-"):\n            return UserAPIKeyAuth(\n                api_key=api_key,\n                user_id="team_user_456",\n                user_email="user@company.com",\n                user_role=LitellmUserRoles.INTERNAL_USER,\n                team_id="dev_team",\n                team_alias="Development Team",\n                max_budget=100.0,\n                tpm_limit=1000,\n                rpm_limit=20,\n                models=["gpt-3.5-turbo", "claude-3-haiku"],\n                team_member_tpm_limit=500,  # \u56e2\u961f\u5185\u6210\u5458\u7684TPM\u9650\u5236\n                end_user_tpm_limit=100,     # \u6bcf\u4e2a\u7ec8\u7aef\u7528\u6237\u7684TPM\u9650\u5236\n                metadata={"project": "chatbot_v2"}\n            )\n        else:\n            raise Exception("\u65e0\u6548\u7684API\u5bc6\u94a5")\n    except Exception:\n        raise Exception("\u8ba4\u8bc1\u5931\u8d25")\n'})}),"\n",(0,s.jsx)(n.h4,{id:"2-\u4f20\u9012\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u76f8\u5bf9\u4e8econfigyaml",children:"2. \u4f20\u9012\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\uff08\u76f8\u5bf9\u4e8econfig.yaml\uff09"}),"\n",(0,s.jsx)(n.p,{children:"\u5c06\u914d\u7f6e\u6587\u4ef6\u8def\u5f84\u4f20\u9012\u7ed9config.yaml"}),"\n",(0,s.jsxs)(n.p,{children:["\u4f8b\u5982\uff0c\u5982\u679c\u5b83\u4eec\u5728\u540c\u4e00\u76ee\u5f55\u4e2d - ",(0,s.jsx)(n.code,{children:"./config.yaml"})," \u548c ",(0,s.jsx)(n.code,{children:"./custom_auth.py"}),"\uff0c\u8fd9\u770b\u8d77\u6765\u5982\u4e0b\uff1a"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:'model_list: \n  - model_name: "openai-model"\n    litellm_params: \n      model: "gpt-3.5-turbo"\n\nlitellm_settings:\n  drop_params: True\n  set_verbose: True\n\ngeneral_settings:\n  custom_auth: custom_auth.user_api_key_auth\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://github.com/BerriAI/litellm/blob/caf2a6b279ddbe89ebd1d8f4499f65715d684851/litellm/proxy/utils.py#L122",children:(0,s.jsx)(n.strong,{children:"\u5b9e\u73b0\u4ee3\u7801"})})}),"\n",(0,s.jsx)(n.h4,{id:"3-\u542f\u52a8\u4ee3\u7406",children:"3. \u542f\u52a8\u4ee3\u7406"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"$ litellm --config /path/to/config.yaml \n"})}),"\n",(0,s.jsx)(n.h2,{id:"-\u652f\u6301-litellm-\u865a\u62df\u5bc6\u94a5--\u81ea\u5b9a\u4e49\u8ba4\u8bc1",children:"\u2728 \u652f\u6301 LiteLLM \u865a\u62df\u5bc6\u94a5 + \u81ea\u5b9a\u4e49\u8ba4\u8bc1"}),"\n",(0,s.jsx)(n.p,{children:"\u4ecev1.72.2+\u7248\u672c\u8d77\u652f\u6301\u3002"}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsx)(n.mdxAdmonitionTitle,{}),(0,s.jsx)(n.p,{children:"\u2728 \u652f\u6301\u81ea\u5b9a\u4e49\u8ba4\u8bc1 + LiteLLM \u865a\u62df\u5bc6\u94a5\u4ec5\u5728LiteLLM\u4f01\u4e1a\u7248\u4e2d\u63d0\u4f9b\u3002"}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.litellm.ai/#pricing",children:"\u4f01\u4e1a\u5b9a\u4ef7"})}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{href:"https://www.litellm.ai/enterprise#trial",children:"\u83b7\u53d6\u514d\u8d397\u5929\u8bd5\u7528\u5bc6\u94a5"})})]}),"\n",(0,s.jsx)(n.h3,{id:"\u4f7f\u7528\u65b9\u6cd5-1",children:"\u4f7f\u7528\u65b9\u6cd5"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"\u8bbe\u7f6e\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u6587\u4ef6"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'"""\n\u793a\u4f8b\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570\u3002\n\n\u8fd9\u5c06\u5141\u8bb8\u6240\u6709\u4ee5"my-custom-key"\u5f00\u5934\u7684\u5bc6\u94a5\u901a\u8fc7\u3002\n"""\nfrom typing import Union\n\nfrom fastapi import Request\n\nfrom litellm.proxy._types import UserAPIKeyAuth\n\n\nasync def user_api_key_auth(\n    request: Request, api_key: str\n) -> Union[UserAPIKeyAuth, str]:\n    try:\n        if api_key.startswith("my-custom-key"):\n            return "sk-P1zJMdsqCPNN54alZd_ETw"\n        else:\n            raise Exception("\u65e0\u6548\u7684API\u5bc6\u94a5")\n    except Exception:\n        raise Exception("\u65e0\u6548\u7684API\u5bc6\u94a5")\n\n'})}),"\n",(0,s.jsxs)(n.ol,{start:"2",children:["\n",(0,s.jsx)(n.li,{children:"\u8bbe\u7f6econfig.yaml"}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u66f4\u6539\u8bbe\u7f6e ",(0,s.jsx)(n.code,{children:"mode: auto"}),"\u3002\u8fd9\u5c06\u68c0\u67e5 LiteLLM API\u5bc6\u94a5\u8ba4\u8bc1 + \u81ea\u5b9a\u4e49\u8ba4\u8bc1\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-yaml",children:"model_list: \n  - model_name: \"openai-model\"\n    litellm_params: \n      model: \"gpt-3.5-turbo\"\n      api_key: os.environ/OPENAI_API_KEY\n\ngeneral_settings:\n  custom_auth: custom_auth_auto.user_api_key_auth\n  custom_auth_settings:\n    mode: \"auto\" # \u53ef\u4ee5\u662f'on', 'off', 'auto' - 'auto'\u68c0\u67e5LiteLLM API\u5bc6\u94a5\u8ba4\u8bc1 + \u81ea\u5b9a\u4e49\u8ba4\u8bc1\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u6d41\u7a0b\uff1a"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u9996\u5148\u68c0\u67e5\u81ea\u5b9a\u4e49\u8ba4\u8bc1"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u5931\u8d25\uff0c\u5219\u68c0\u67e5 LiteLLM API\u5bc6\u94a5\u8ba4\u8bc1"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u5982\u679c\u4e24\u8005\u90fd\u5931\u8d25\uff0c\u8fd4\u56de401"}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsx)(n.p,{children:"\u6d4b\u8bd5\u5b83\uff01"}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'curl -L -X POST \'http://0.0.0.0:4000/v1/chat/completions\' \\\n-H \'Content-Type: application/json\' \\\n-H \'Authorization: Bearer sk-P1zJMdsqCPNN54alZd_ETw\' \\\n-d \'{\n    "model": "openai-model",\n    "messages": [\n          {\n            "role": "user",\n            "content": "\u563f\uff01\u6211\u7684\u540d\u5b57\u662f\u7ea6\u7ff0"\n          }\n        ]\n}\'\n'})}),"\n",(0,s.jsx)(n.h4,{id:"\u629b\u51fa\u81ea\u5b9a\u4e49\u5f02\u5e38",children:"\u629b\u51fa\u81ea\u5b9a\u4e49\u5f02\u5e38"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679c\u4f60\u60f3\u629b\u51fa\u81ea\u5b9a\u4e49\u5f02\u5e38\uff0c\u53ef\u4ee5\u901a\u8fc7\u629b\u51fa ",(0,s.jsx)(n.code,{children:"ProxyException"})," \u6765\u5b9e\u73b0\u3002"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-python",children:'"""\n\u793a\u4f8b\u81ea\u5b9a\u4e49\u8ba4\u8bc1\u51fd\u6570\u3002\n\n\u8fd9\u5c06\u5141\u8bb8\u6240\u6709\u4ee5"my-custom-key"\u5f00\u5934\u7684\u5bc6\u94a5\u901a\u8fc7\u3002\n"""\n\nfrom typing import Union\n\nfrom fastapi import Request\n\nfrom litellm.proxy._types import UserAPIKeyAuth, ProxyException\n\n\nasync def user_api_key_auth(\n    request: Request, api_key: str\n) -> Union[UserAPIKeyAuth, str]:\n    try:\n        if api_key.startswith("my-custom-key"):\n            return "sk-P1zJMdsqCPNN54alZd_ETw"\n        if api_key == "invalid-api-key":\n            # \u5411\u5ba2\u6237\u7aef\u629b\u51fa\u81ea\u5b9a\u4e49\u5f02\u5e38\n            raise ProxyException(\n                message="\u65e0\u6548\u7684API\u5bc6\u94a5",\n                type="invalid_request_error",\n                param="api_key",\n                code=401,\n            )\n        else:\n            raise Exception("\u65e0\u6548\u7684API\u5bc6\u94a5")\n    except Exception:\n        raise Exception("\u65e0\u6548\u7684API\u5bc6\u94a5")\n\n'})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(m,{...e})}):m(e)}},28453(e,n,t){t.d(n,{R:()=>r,x:()=>a});var i=t(96540);const s={},l=i.createContext(s);function r(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);